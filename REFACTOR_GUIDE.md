REFACTOR_GUIDE.md: 微信小程序架构重构与工程化准则致 AI 工程师：你现在的角色是资深系统架构师。你的目标是：在不破坏现有功能的前提下，通过“渐进式重构”将项目代码从混乱状态提升至企业级标准。🛡️ 第一章：核心操作底线 (The Red Lines)逻辑等价性：禁止修改任何业务逻辑判断（如 if 条件、数值计算）。重构仅限于位置迁移和抽象解耦。非破坏性修改：修改路径或重命名函数后，必须立即全局搜索并修复所有调用点（References）。单一出口原则：严禁在 utils/request.js 以外的任何地方调用 wx.request 或 wx.uploadFile。禁止幻觉：如果代码逻辑模糊不清，必须先询问用户（Developer），严禁自行推测补全逻辑。📂 第二章：标准目录结构 (System Architecture)重构后的目标结构必须严格遵守以下定义：目录职责描述约束条件/api后端接口定义层仅允许 import request.js；按功能模块拆分文件。/services复杂业务逻辑/数据加工层处理多接口组合、复杂数组过滤、状态转换。/componentsUI 组件库遵循原子化设计，不包含特定页面的私有逻辑。/utils纯工具函数必须是无副作用的纯函数（如时间格式化、正则校验）。/constants常量与配置存储 ErrorCode、枚举值（Enum）、静态配置项。/assets静态资源图片、图标分类存放，大图建议使用 CDN 链接。🛠️ 第三章：分阶段重构执行计划 (Execution Roadmap)阶段 1：通讯层标准化 (Communication Layer)任务：部署 utils/request.js 底座。规则：提取所有硬编码的 https://api.domain.com 到 ENV_CONFIG。实现全局 Loading 控制、Token 自动注入、401 自动跳转登录逻辑。通过标准：pages/ 目录下不再出现 url: 'https://...' 字符串。阶段 2：API 模块化解耦 (API Decoupling)任务：将 pages/*.js 中的请求逻辑搬迁至 /api/*.js。规则：函数命名模版：export const [动作][对象] = (data) => request({ ... });例如：export const getOrderList = (data) => ...必须添加 JSDoc 注释，说明入参意义和后端对应接口文档。3. 阶段 3：数据预处理提取 (Service Layering)任务：清理 this.setData 之前的繁杂逻辑。规则：如果一个接口返回的数据需要循环 3 次或进行复杂的 map/filter 才能给 UI 使用，必须将该逻辑提取到 /services。通过标准：Page 里的代码只负责“调用 Service -> 拿到结果 -> setData”。4. 阶段 4：配置与常量收拢 (Constants)任务：消除“魔法数字”。规则：严禁出现 if (res.status === 1)。必须改为 import { ORDER_STATUS } from '../../constants/index';。if (res.status === ORDER_STATUS.PAID)。🧪 第四章：验收与测试标准 (Definition of Done)每次完成一个小模块的重构，必须自检以下清单：[ ] 静态检查：在微信开发者工具中按 Ctrl+B 编译，控制台 0 错误，0 警告。[ ] 路径追溯：使用全局搜索确认旧代码块已被物理删除，没有冗余残留。[ ] 异步安全：确保所有异步操作（Promise/async-await）都有 .catch 或 try-catch 处理。[ ] 性能检查：重构后单次 setData 的数据量不得超过 1MB，避免不必要的全局数据刷新。✍️ 第五章：AI 交互 Prompt 模版 (Operational Prompts)当你要求 AI 执行具体任务时，请使用以下指令：指令：[执行阶段名称]目标文件：pages/xxx/xxx.js参考规范：REFACTOR_GUIDE.md具体要求：请分析目标文件中的网络请求，将其迁移至 api/xxx.js。在迁移过程中，请检查是否有可以提取到 constants/ 的硬编码数值。反馈要求：请先列出你要移动的代码片段和新旧路径对比，待我确认后再执行写入。