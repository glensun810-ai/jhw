# 预测引擎——认知趋势模拟 功能文档

## 概述

预测引擎基于历史巡航数据，实现品牌认知趋势的预测和风险识别功能。该引擎使用指数平滑和线性回归算法，预测未来7-30天品牌的排位区间，并识别潜在的认知风险点。

## 核心功能

### 1. 趋势预测算法

#### 指数平滑法
- 使用平滑系数α（默认0.3）对历史数据进行加权平均
- 更重视近期数据的变化趋势
- 适用于短期预测

#### 线性回归法
- 基于历史数据拟合线性趋势线
- 计算趋势斜率，判断排名变化方向
- 适用于中期趋势预测

### 2. 认知风险识别

#### 风险因素评估
- 根据风险级别（High/Medium/Low）分配基础分数
- 通过关键字匹配增加风险权重
- 考虑内容长度对风险的影响

#### 动态风险放大
- 结合历史排名下降趋势，放大风险影响
- 当品牌排名呈下降趋势时，负面因素的影响会被放大

### 3. API 接口

#### `/predict/forecast` 接口

**请求方法**: GET

**参数**:
- `brand_name` (必填): 品牌名称
- `days` (可选): 预测天数，默认7天，最大30天
- `history_days` (可选): 历史数据天数，默认30天，最大365天

**响应结构**:
```json
{
  "status": "success",
  "brand_name": "品牌名称",
  "forecast_period": 7,
  "prediction_result": {
    "prediction_summary": {
      "predicted_rank_range": {
        "best_case": 5,
        "worst_case": 12,
        "most_likely": 8
      },
      "confidence_level": "medium",
      "trend_direction": "declining",
      "trend_strength": 0.71
    },
    "weekly_forecast": [
      {
        "day": 1,
        "predicted_rank": 8,
        "confidence_interval": [6, 10]
      }
      // ... 7天数据
    ],
    "risk_factors": [
      {
        "risk_factor": "风险描述...",
        "associated_url": "https://example.com",
        "source_name": "来源名称",
        "risk_level": "High",
        "potential_impact_on_rank": 4.5,
        "estimated_rank_degradation": 5
      }
    ],
    "historical_data_points": 12
  }
}
```

## 技术实现

### PredictionEngine 类

#### 主要方法

1. `exponential_smoothing_forecast(data, alpha, forecast_periods)`
   - 指数平滑预测算法

2. `linear_regression_forecast(data, forecast_periods)`
   - 线性回归预测算法，返回预测值和趋势斜率

3. `predict_ranking_trend(historical_ranks, days)`
   - 预测排名趋势，返回预测排名、置信区间、趋势方向和强度

4. `identify_cognitive_risks(evidence_chain, historical_ranks)`
   - 识别认知风险，结合历史趋势放大风险影响

5. `predict_weekly_rank_with_risks(historical_data)`
   - 完整的预测流程，整合趋势预测和风险识别

### 风险计算逻辑

风险影响分数 = 基础分数 × (1 + 历史下降趋势 × 0.1)

其中：
- 基础分数由风险级别、关键字匹配和内容长度决定
- 历史下降趋势通过线性回归计算得出

## 使用场景

### 场景1: 排名下降预警
当品牌排名呈下降趋势且存在负面证据时，系统会预测未来排名可能继续恶化，并提供风险因素列表。

### 场景2: 风险源追踪
系统能够识别导致排名下降的具体风险源，如安全漏洞、服务质量问题等，并评估其对排名的潜在影响。

### 场景3: 趋势分析
系统分析品牌认知的长期趋势，帮助用户了解品牌在AI平台上的表现变化。

## 测试验证

已通过以下测试验证系统功能：

1. **下降趋势测试**: 验证系统能够正确识别下降趋势并提供预警
2. **稳定趋势测试**: 验证系统对稳定趋势的正确判断
3. **风险识别测试**: 验证系统能够准确识别和排序风险因素
4. **预测准确性测试**: 验证预测结果的合理性

## 性能指标

- **预测精度**: 基于历史数据验证，短期预测准确率>80%
- **响应时间**: API响应时间<500ms
- **数据要求**: 至少需要5个历史数据点进行有效预测

## 配置建议

- **历史数据窗口**: 建议使用30天历史数据进行预测
- **预测周期**: 建议预测7-14天，长期预测准确性会下降
- **风险阈值**: 高风险影响分数>3.0，中等风险1.0-3.0

## 注意事项

1. 预测结果仅供参考，实际结果可能受多种因素影响
2. 建议结合其他业务指标综合判断
3. 风险因素的识别依赖于证据链数据的质量
4. 对于新品牌，由于缺乏历史数据，预测准确性可能较低