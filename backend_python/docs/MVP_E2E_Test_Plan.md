# MVP功能全流程闭环测试 (基于真实 DeepSeek 结果)

## 1. 测试目标

验证一个新用户从启动小程序到完成一次包含 DeepSeek 平台的诊断，并能成功查看历史报告的完整流程，确保 DeepSeek 平台能够返回真实结果。

## 2. 前置条件

1.  后端服务已启动 (`main.py`)。
2.  项目根目录下的 `.env` 文件中已配置 `DEEPSEEK_API_KEY="sk-..."`。
3.  `config_manager.py` 已更新以识别 `deepseek`。
4.  `wechat_backend/ai_adapters/deepseek_adapter.py` 已实现，并能正确调用 DeepSeek API。
5.  `wechat_backend/test_engine/scheduler.py` 中的 `_simulate_ai_call` 已被替换为实际的 AI 调用逻辑。
6.  `wechat_backend/ai_utils.py` 中的 `get_ai_client` 能够正确实例化 DeepSeek 客户端。

## 3. 测试场景

*   **角色**: 一位汽车行业的市场经理。
*   **目标**: 想要了解自家品牌“**蔚来**”与竞品“**特斯拉**”和“**理想汽车**”在 DeepSeek 平台上的认知情况。
*   **操作**:
    1.  **启动小程序**: 打开微信开发者工具，启动小程序。
    2.  **登录**: 模拟用户登录（如果需要）。
    3.  **输入品牌**: 在首页主输入框中输入“**蔚来**”。
    4.  **高级设置**:
        *   点击“高级设置”展开。
        *   **添加竞品**: 在“竞争格局分析”中，添加“**特斯拉**”和“**理想汽车**”。
        *   **自定义问题**: 在“自定义诊断问题”中，输入：
            *   “蔚来汽车的核心竞争力是什么？”
            *   “蔚来汽车在新能源汽车市场中的定位如何？”
        *   **AI模型选择**:
            *   在“国内AI平台”中，**确保“DeepSeek”被选中**。
            *   取消选择其他所有AI模型，以确保本次测试仅针对 DeepSeek。
    5.  **启动诊断**: 点击“**立即诊断**”按钮。
    6.  **观察进度**: 监控进度条和动态文本，确保诊断过程顺利进行。
    7.  **验证结果页**:
        *   **自动导航**: 确认页面自动导航到“品牌AI洞察报告”（结果页）。
        *   **高管摘要**: 检查“战况大盘”和“核心洞察摘要”是否已填充数据。
        *   **多维分析**:
            *   **“按平台分析”Tab**: 切换到此Tab。验证“DeepSeek”平台下，显示了“蔚来”、“特斯拉”、“理想汽车”的诊断结果。
            *   **“按品牌分析”Tab**: 切换到此Tab。验证“蔚来”、“特斯拉”、“理想汽车”各自的诊断结果（包括DeepSeek）。
            *   **“问题诊断”Tab**: 切换到此Tab。检查是否识别出“蔚来”的任何问题。
        *   **GEO智能洞察卡片**: 展开“蔚来”在 DeepSeek 平台下的卡片。
            *   **关键**: 验证“🤖 AI 原声”部分显示的是**真实 DeepSeek 生成的回答**，而不是模拟文本。
            *   验证“🩺 深度诊断”部分显示了5维评分（权威度、可见度、好感度、纯净度、一致性）。
    8.  **验证历史记录**:
        *   **返回首页**: 点击结果页底部的“返回首页”按钮。
        *   **查看历史**: 点击首页底部的“查看历史诊断报告”链接。
        *   **历史列表**: 验证列表中包含刚刚完成的“蔚来”诊断报告。
        *   **历史详情**: 点击该报告进入详情页。确认详情页加载并显示了与之前结果页完全一致的报告内容。

## 4. 预期结果

*   诊断过程顺利完成，进度条达到100%。
*   页面自动跳转到结果页。
*   结果页中的 DeepSeek 平台诊断结果，特别是“AI 原声”，是真实 DeepSeek API 返回的内容。
*   各项评分和分析数据基于真实结果生成。
*   历史记录功能正常，能够准确复现报告。