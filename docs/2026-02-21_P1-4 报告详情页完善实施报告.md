# P1-4 æŠ¥å‘Šè¯¦æƒ…é¡µå®Œå–„å®æ–½æŠ¥å‘Š

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-21  
**å®æ–½çŠ¶æ€**: âœ… å·²å®Œæˆ  

---

## æ‰§è¡Œæ‘˜è¦

### é—®é¢˜æè¿°

å¤šä¸ªæŠ¥å‘Šè¯¦æƒ…é¡µé¢çŠ¶æ€ä¸º"éƒ¨åˆ†å®ç°"ï¼ŒåŒ…æ‹¬ï¼š
- pages/report/dashboard/index - æˆ˜ç•¥ä»ªè¡¨ç›˜
- pages/report/roi-detail/roi-detail - ROI è¯¦æƒ…
- pages/report/source-graph/detail - ä¿¡æºå›¾è°±
- pages/history-detail/history-detail - å†å²è¯¦æƒ…

### å®æ–½å†…å®¹

æœ¬æ¬¡å®æ–½å®Œæˆäº† 4 ä¸ªæŠ¥å‘Šè¯¦æƒ…é¡µé¢çš„å®Œå–„ï¼š
1. âœ… ä¿¡æºå›¾è°±è¯¦æƒ…é¡µï¼ˆå®Œæ•´å®ç°ï¼‰
2. âœ… å†å²è¯¦æƒ…é¡µï¼ˆå¢å¼ºå®ç°ï¼‰
3. âœ… ROI è¯¦æƒ…é¡µï¼ˆå·²æœ‰åŸºç¡€ï¼Œä¼˜åŒ–æ•°æ®ç»‘å®šï¼‰
4. âœ… æˆ˜ç•¥ä»ªè¡¨ç›˜ï¼ˆå·²æœ‰åŸºç¡€ï¼Œä¼˜åŒ–æ•°æ®æµï¼‰

### æ–°å¢/å®Œå–„é¡µé¢

| é¡µé¢ | çŠ¶æ€ | ä¸»è¦åŠŸèƒ½ |
|------|------|----------|
| `/pages/report/source-graph/detail` | âœ… æ–°å¢ | ä¿¡æºå¼•ç”¨æ’åã€ç±»å‹åˆ†å¸ƒã€å¯ä¿¡åº¦åˆ†æ |
| `/pages/history-detail/history-detail` | âœ… å¢å¼º | å†å²è®°å½•è¯¦æƒ…ã€PDF å¯¼å‡º |
| `/pages/report/roi-detail/roi-detail` | âœ… ä¼˜åŒ– | ROI æŒ‡æ ‡è¯¦æƒ…ã€å½±å“åŠ›è¯„åˆ† |
| `/pages/report/dashboard/index` | âœ… ä¼˜åŒ– | æˆ˜ç•¥ä»ªè¡¨ç›˜ã€é—®é¢˜è¯Šæ–­ |

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šä¿¡æºå›¾è°±è¯¦æƒ…é¡µï¼ˆæ–°å¢ï¼‰

### 1.1 é¡µé¢åŠŸèƒ½

**æ–‡ä»¶**: `pages/report/source-graph/detail.*`

**å±•ç¤ºå†…å®¹**:
- ä¿¡æºæ¦‚è§ˆï¼ˆæ€»ä¿¡æºæ•°ã€è¢«å¼•ç”¨ä¿¡æºã€å¼•ç”¨ç‡ï¼‰
- ä¿¡æºå¼•ç”¨æ’å Top 10
- ä¿¡æºç±»å‹åˆ†å¸ƒ
- å¯ä¿¡åº¦åˆ†æï¼ˆé«˜/ä¸­/ä½ï¼‰

### 1.2 æ•°æ®ç»“æ„

```javascript
{
  // ä¿¡æºæ¦‚è§ˆ
  totalSources: 50,        // æ€»ä¿¡æºæ•°
  citedSources: 35,        // è¢«å¼•ç”¨ä¿¡æº
  citationRate: 70,        // å¼•ç”¨ç‡ 70%
  
  // ä¿¡æºæ’å
  sourceRanking: [
    {
      rank: 1,
      name: 'æ–°åç½‘',
      domain: 'xinhuanet.com',
      citations: 15,
      percentage: 30
    }
  ],
  
  // ç±»å‹åˆ†å¸ƒ
  sourceTypes: [
    { type: 'æ–°é—»åª’ä½“', count: 20, percentage: 40 },
    { type: 'è¡Œä¸šæŠ¥å‘Š', count: 15, percentage: 30 }
  ],
  
  // å¯ä¿¡åº¦
  credibilityData: {
    high: 25,    // é«˜å¯ä¿¡åº¦
    medium: 20,  // ä¸­å¯ä¿¡åº¦
    low: 5       // ä½å¯ä¿¡åº¦
  }
}
```

### 1.3 API æ•°æ®æº

```javascript
// ä»æœåŠ¡å™¨è·å–
GET /api/source-intelligence/{executionId}

// æˆ–ä»æœ¬åœ°å­˜å‚¨è·å–
wx.getStorageSync('source_intelligence_data')
```

### 1.4 UI ç‰¹æ€§

- âœ… æ¸å˜æ’ååœ†åœˆï¼ˆ1-3 åç‰¹æ®Šæ ·å¼ï¼‰
- âœ… è¿›åº¦æ¡å±•ç¤ºç±»å‹åˆ†å¸ƒ
- âœ… é¢œè‰²ç¼–ç å¯ä¿¡åº¦ï¼ˆç»¿/é»„/çº¢ï¼‰
- âœ… å“åº”å¼ç½‘æ ¼å¸ƒå±€

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå†å²è¯¦æƒ…é¡µï¼ˆå¢å¼ºï¼‰

### 2.1 é¡µé¢åŠŸèƒ½

**æ–‡ä»¶**: `pages/history-detail/history-detail.*`

**å±•ç¤ºå†…å®¹**:
- æ€»ä½“è¯„åˆ†ï¼ˆåˆ†æ•° + ç­‰çº§ + è¯„ä»·ï¼‰
- è¯„åˆ†ç»´åº¦ï¼ˆæƒå¨åº¦ã€å¯è§åº¦ã€çº¯å‡€åº¦ã€ä¸€è‡´æ€§ï¼‰
- æµ‹è¯•ä¿¡æ¯ï¼ˆAI æ¨¡å‹æ•°ã€é—®é¢˜æ•°ã€ç«å“æ•°ï¼‰
- è¯¦ç»†æµ‹è¯•ç»“æœåˆ—è¡¨
- åº•éƒ¨æ“ä½œæ ï¼ˆè¿”å›é¦–é¡µã€æŸ¥çœ‹å†å²ã€å¯¼å‡ºæŠ¥å‘Šï¼‰

### 2.2 å¢å¼ºåŠŸèƒ½

**æ•°æ®åŠ è½½ä¼˜åŒ–**:
```javascript
// 1. ä¼˜å…ˆä»æœåŠ¡å™¨åŠ è½½
loadFromServer(executionId);

// 2. é™çº§åˆ°æœ¬åœ°å­˜å‚¨
loadHistoryRecord(recordId);

// 3. æ•°æ®å¤„ç†æ ‡å‡†åŒ–
processHistoryData(record);
```

**PDF å¯¼å‡ºé›†æˆ**:
```javascript
// å¯¼å‡ºæŠ¥å‘Š
const { exportPdfReport } = require('../../api/export');

exportPdfReport({
  executionId: this.data.executionId
})
.then(() => {
  wx.showToast({ title: 'æŠ¥å‘Šå·²ä¿å­˜', icon: 'success' });
});
```

### 2.3 è¯„åˆ†ç­‰çº§è®¡ç®—

```javascript
calculateGrade(score) {
  if (score >= 90) return 'A';
  if (score >= 80) return 'B';
  if (score >= 70) return 'C';
  if (score >= 60) return 'D';
  return 'E';
}
```

### 2.4 UI ç‰¹æ€§

- âœ… æ¸å˜èƒŒæ™¯è¯„åˆ†å¡ç‰‡
- âœ… å½©è‰²è¿›åº¦æ¡ï¼ˆ4 ä¸ªç»´åº¦ä¸åŒé¢œè‰²ï¼‰
- âœ… ä¿¡æ¯ç½‘æ ¼å±•ç¤º
- âœ… å¯æŠ˜å ç»“æœåˆ—è¡¨
- âœ… åº•éƒ¨å›ºå®šæ“ä½œæ 

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šROI è¯¦æƒ…é¡µï¼ˆä¼˜åŒ–ï¼‰

### 3.1 ç°æœ‰åŠŸèƒ½ä¼˜åŒ–

**æ–‡ä»¶**: `pages/report/roi-detail/roi-detail.*`

**ä¼˜åŒ–å†…å®¹**:
1. æ•°æ®ç»‘å®šä¼˜åŒ–
2. è¡Œä¸šåŸºå‡†å¯¹æ¯”
3. å½±å“åŠ›è¯„åˆ†å¯è§†åŒ–
4. é¥¼å›¾å±•ç¤ºå½±å“åŠ›æ„æˆ

### 3.2 æ ¸å¿ƒæŒ‡æ ‡

```javascript
{
  // ROI æŒ‡æ ‡
  exposure_roi: 3.5,          // æ›å…‰ ROI
  sentiment_roi: 0.8,         // æƒ…æ„Ÿ ROI
  ranking_roi: 75,            // æ’å ROI
  estimated_value: 50000,     // ä¼°ç®—ä»·å€¼
  
  // è¡Œä¸šåŸºå‡†
  benchmarks: {
    exposure_roi_industry_avg: 2.5,
    sentiment_roi_industry_avg: 0.6,
    ranking_roi_industry_avg: 50
  },
  
  // å½±å“åŠ›è¯„åˆ†
  impactScores: {
    authority_impact: 80,
    visibility_impact: 90,
    purity_impact: 85,
    consistency_impact: 78
  }
}
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šæˆ˜ç•¥ä»ªè¡¨ç›˜ï¼ˆä¼˜åŒ–ï¼‰

### 4.1 ç°æœ‰åŠŸèƒ½ä¼˜åŒ–

**æ–‡ä»¶**: `pages/report/dashboard/index.*`

**ä¼˜åŒ–å†…å®¹**:
1. éº¦è‚¯é”¡ä¸‰æ®µå¼å¸ƒå±€
2. ROI æŒ‡æ ‡å±•ç¤º
3. å·¥ä½œæµåˆ†æå‘ç°
4. è¯¦æƒ…æŠ½å±‰

### 4.2 é¡µé¢ç»“æ„

```
1. æ¦‚è§ˆè¯„åˆ†ï¼ˆå¥åº·åº¦ã€å£°é‡å æ¯”ã€æƒ…æ„Ÿå‡å€¼ï¼‰
2. æ ¸å¿ƒé—®é¢˜è¯Šæ–­åˆ†æï¼ˆé—®é¢˜å¢™ï¼‰
3. é«˜é£é™©è´Ÿé¢ä¿¡æºï¼ˆå½’å› åˆ—è¡¨ï¼‰
```

### 4.3 æ•°æ®æµä¼˜åŒ–

```javascript
// ä¼˜å…ˆä»æœåŠ¡å™¨è·å–
fetchDataFromServer(executionId);

// é™çº§åˆ°æœ¬åœ°ç¼“å­˜
const lastReport = wx.getStorageSync('lastReport');

// æ¯æ¬¡æ˜¾ç¤ºæ—¶åˆ·æ–°
onShow() {
  if (!this.data.dashboardData) {
    this.loadDashboardData();
  }
}
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæŠ€æœ¯å®ç°

### 5.1 é€šç”¨æ•°æ®åŠ è½½æ¨¡å¼

```javascript
// æ ‡å‡†æ•°æ®åŠ è½½æµç¨‹
loadData() {
  try {
    this.setData({ loading: true, error: null });
    
    const executionId = this.data.executionId;
    
    if (executionId) {
      // ä»æœåŠ¡å™¨è·å–
      this.fetchFromServer(executionId);
    } else {
      // ä»æœ¬åœ°è·å–
      this.loadFromLocal();
    }
  } catch (error) {
    this.setData({ loading: false, error: 'åŠ è½½å¤±è´¥' });
  }
}

// æœåŠ¡å™¨è¯·æ±‚
fetchFromServer(executionId) {
  const token = wx.getStorageSync('token');
  
  wx.request({
    url: `${app.globalData.serverUrl}/api/xxx/${executionId}`,
    header: {
      'Authorization': token ? `Bearer ${token}` : ''
    },
    success: (res) => {
      if (res.statusCode === 200) {
        this.processData(res.data);
      } else {
        this.loadFromLocal(); // é™çº§
      }
    },
    fail: () => {
      this.loadFromLocal(); // é™çº§
    }
  });
}
```

### 5.2 æ•°æ®å¤„ç†æ ‡å‡†åŒ–

```javascript
// ç»Ÿä¸€æ•°æ®å¤„ç†
processData(rawData) {
  // 1. æå–æ ¸å¿ƒæ•°æ®
  const data = rawData.data || rawData;
  
  // 2. è®¡ç®—è¡ç”ŸæŒ‡æ ‡
  const metrics = this.calculateMetrics(data);
  
  // 3. æ ¼å¼åŒ–å±•ç¤ºæ•°æ®
  const formatted = this.formatForDisplay(data);
  
  // 4. æ›´æ–°é¡µé¢çŠ¶æ€
  this.setData({
    loading: false,
    ...formatted
  });
}
```

### 5.3 é”™è¯¯å¤„ç†

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
handleError(error) {
  logger.error('åŠ è½½å¤±è´¥', error);
  
  this.setData({ 
    loading: false, 
    error: error.message || 'åŠ è½½å¤±è´¥' 
  });
  
  wx.showToast({
    title: 'åŠ è½½å¤±è´¥',
    icon: 'none'
  });
}
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šUI/UX ä¼˜åŒ–

### 6.1 åŠ è½½çŠ¶æ€

```css
/* åŠ è½½åŠ¨ç”» */
.loading-spinner {
  width: 60rpx;
  height: 60rpx;
  border: 4rpx solid #e0e0e0;
  border-top-color: #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
```

### 6.2 ç©ºçŠ¶æ€

```xml
<view class="empty-state">
  <text class="empty-icon">ğŸ“Š</text>
  <text class="empty-text">æš‚æ— æ•°æ®</text>
</view>
```

### 6.3 é¢œè‰²ç¼–ç 

```css
/* å¯ä¿¡åº¦é¢œè‰² */
.credibility-value.high { color: #52c41a; }    /* ç»¿ */
.credibility-value.medium { color: #faad14; }  /* é»„ */
.credibility-value.low { color: #ff4d4f; }     /* çº¢ */

/* ç»´åº¦é¢œè‰² */
.bar-fill.authority { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); }
.bar-fill.visibility { background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); }
.bar-fill.purity { background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%); }
.bar-fill.consistency { background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%); }
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæµ‹è¯•éªŒè¯

### 7.1 æµ‹è¯•æ­¥éª¤

```
1. å®Œæˆä¸€æ¬¡å“ç‰Œè¯Šæ–­æµ‹è¯•
2. æŸ¥çœ‹æˆ˜ç•¥ä»ªè¡¨ç›˜
   - æ£€æŸ¥ ROI æŒ‡æ ‡å±•ç¤º
   - æ£€æŸ¥é—®é¢˜å¢™
   - æ£€æŸ¥è´Ÿé¢ä¿¡æºåˆ—è¡¨
3. æŸ¥çœ‹ ROI è¯¦æƒ…é¡µ
   - æ£€æŸ¥æ ¸å¿ƒæŒ‡æ ‡
   - æ£€æŸ¥å½±å“åŠ›è¯„åˆ†
4. æŸ¥çœ‹ä¿¡æºå›¾è°±
   - æ£€æŸ¥ä¿¡æºæ’å
   - æ£€æŸ¥ç±»å‹åˆ†å¸ƒ
   - æ£€æŸ¥å¯ä¿¡åº¦
5. æŸ¥çœ‹å†å²è¯¦æƒ…
   - æ£€æŸ¥è¯„åˆ†å±•ç¤º
   - æ£€æŸ¥è¯¦ç»†ç»“æœ
   - æµ‹è¯• PDF å¯¼å‡º
```

### 7.2 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰é¡µé¢èƒ½æ­£å¸¸åŠ è½½
- [ ] æ•°æ®å±•ç¤ºå‡†ç¡®
- [ ] åŠ è½½çŠ¶æ€å‹å¥½
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] UI å“åº”å¼é€‚é…
- [ ] PDF å¯¼å‡ºåŠŸèƒ½æ­£å¸¸

---

## ç¬¬å…«éƒ¨åˆ†ï¼šåç»­æ”¹è¿›è®¡åˆ’

### P1 æ”¹è¿›é¡¹

1. **å›¾è¡¨å¢å¼º**
   - å¼•å…¥å›¾è¡¨åº“ï¼ˆecharts-for-weixinï¼‰
   - æ·»åŠ æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾
   - æ”¯æŒäº¤äº’ï¼ˆç‚¹å‡»ã€ç¼©æ”¾ï¼‰

2. **æ•°æ®å¯¹æ¯”**
   - æ”¯æŒå¤šæ¬¡æµ‹è¯•å¯¹æ¯”
   - è¶‹åŠ¿åˆ†æå›¾è¡¨
   - ç«å“å¯¹æ¯”è§†å›¾

### P2 æ”¹è¿›é¡¹

3. **æ”¶è—åŠŸèƒ½**
   - æ”¶è—é‡è¦æŠ¥å‘Š
   - æ·»åŠ ç¬”è®°æ ‡æ³¨
   - åˆ†ç±»ç®¡ç†

4. **åˆ†äº«ä¼˜åŒ–**
   - ç”Ÿæˆåˆ†äº«æµ·æŠ¥
   - è‡ªå®šä¹‰åˆ†äº«å†…å®¹
   - è¿½è¸ªåˆ†äº«æ•ˆæœ

---

**æ–‡æ¡£ç»“æŸ**
