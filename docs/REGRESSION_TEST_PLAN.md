# P0 修复回归测试计划

**版本：** 1.0  
**测试日期：** 2026-02-26  
**测试范围：** 验证 P0 修复不影响现有功能  
**测试负责人：** 首席测试工程师

---

## 📋 测试目标

验证 5 个 P0 问题修复后：
1. 修复内容正常工作
2. 不影响现有功能
3. 无新的回归问题
4. 性能无明显下降

---

## 🎯 测试范围

### 受影响的模块

| 模块 | 文件 | 变更内容 | 测试优先级 |
|------|------|---------|----------|
| 前端结果页 | results.js | 错误日志计算优化 | P0 |
| 前端结果页 | results.wxml | 模态框条件判断 | P0 |
| 告警系统 | alert_system.py | 邮件导入异常处理 | P0 |
| 监控脚本 | monitoring_daemon.py | API 重试机制 | P0 |
| 监控 API | app.py | 权限验证 | P0 |

---

## 🧪 回归测试用例

### 一、前端结果页测试 (results.js)

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-P0-001 | 正常结果加载 | 1. 完成诊断 2. 查看结果页 | 数据正常加载，无重复计算 | ⏳ |
| REG-P0-002 | 错误日志统计 | 1. 有错误的诊断 2. 查看结果页 | 错误统计数字准确 | ⏳ |
| REG-P0-003 | 配额用尽统计 | 1. 配额用尽场景 2. 查看结果页 | quotaExhaustedCount 准确 | ⏳ |
| REG-P0-004 | 性能验证 | 1. 加载结果页 2. 检查控制台 | 无重复计算日志 | ⏳ |
| REG-P0-005 | 数据一致性 | 1. 多次刷新 2. 比较数据 | 数据一致，无随机错误 | ⏳ |

### 二、错误详情模态框测试 (results.wxml)

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-P0-006 | 有错误时打开 | 1. 有错误 2. 点击错误日志 | 模态框正常打开 | ⏳ |
| REG-P0-007 | 无错误时隐藏 | 1. 无错误 2. 查看按钮 | 错误日志按钮不显示 | ⏳ |
| REG-P0-008 | 模态框关闭 | 1. 打开模态框 2. 点击关闭 | 模态框正常关闭 | ⏳ |
| REG-P0-009 | 空数据处理 | 1. 模拟空数据 2. 打开模态框 | 显示"暂无错误记录" | ⏳ |
| REG-P0-010 | 样式验证 | 1. 查看模态框 2. 检查样式 | 样式正常，无错位 | ⏳ |

### 三、邮件告警测试 (alert_system.py)

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-P0-011 | 正常邮件发送 | 1. 配置 SMTP 2. 触发告警 | 邮件正常发送 | ⏳ |
| REG-P0-012 | SMTP 未安装 | 1. 卸载 smtplib 2. 触发告警 | 不崩溃，记录日志 | ⏳ |
| REG-P0-013 | SMTP 未配置 | 1. 不配置 SMTP 2. 触发告警 | 跳过发送，记录日志 | ⏳ |
| REG-P0-014 | 钉钉告警 | 1. 触发告警 2. 检查钉钉 | 钉钉告警正常 | ⏳ |
| REG-P0-015 | 告警级别 | 1. 不同级别告警 2. 检查通知 | 按级别选择通知方式 | ⏳ |

### 四、监控脚本测试 (monitoring_daemon.py)

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-P0-016 | API 正常 | 1. API 可用 2. 运行脚本 | 正常获取数据 | ⏳ |
| REG-P0-017 | API 不可用 | 1. 关闭 API 2. 运行脚本 | 重试 3 次后退出 | ⏳ |
| REG-P0-018 | 网络超时 | 1. 模拟超时 2. 运行脚本 | 重试机制工作 | ⏳ |
| REG-P0-019 | 日志记录 | 1. 运行脚本 2. 查看日志 | 重试日志详细 | ⏳ |
| REG-P0-020 | 告警触发 | 1. 触发阈值 2. 检查告警 | 告警正常发送 | ⏳ |

### 五、监控大盘权限测试 (app.py)

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-P0-021 | 已认证访问 | 1. 登录 2. 访问监控页 | 正常访问 | ⏳ |
| REG-P0-022 | 未认证访问 | 1. 未登录 2. 访问监控页 | 跳转登录 | ⏳ |
| REG-P0-023 | Token 过期 | 1. Token 过期 2. 访问监控页 | 跳转登录 | ⏳ |
| REG-P0-024 | API 访问 | 1. 未认证 2. 调用 API | 返回 401 | ⏳ |
| REG-P0-025 | 页面加载 | 1. 认证后 2. 加载页面 | 页面正常渲染 | ⏳ |

---

## 🔧 核心业务流程测试

### 诊断流程回归

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| REG-CORE-001 | 完整诊断 | 1. 选择品牌 2. 执行诊断 3. 查看结果 | 全流程正常 | ⏳ |
| REG-CORE-002 | 部分失败 | 1. 模拟失败 2. 执行诊断 3. 查看结果 | 错误提示正常 | ⏳ |
| REG-CORE-003 | 结果保存 | 1. 完成诊断 2. 保存结果 | 保存成功 | ⏳ |
| REG-CORE-004 | 历史记录 | 1. 查看历史 2. 选择记录 | 加载正常 | ⏳ |
| REG-CORE-005 | 刷新功能 | 1. 刷新结果 2. 检查数据 | 数据更新 | ⏳ |

---

## ⚡ 性能测试

| 用例 ID | 测试场景 | 测试步骤 | 性能指标 | 状态 |
|--------|---------|---------|---------|------|
| REG-PERF-001 | 结果页加载 | 1. 计时加载 2. 比较修复前后 | < 3 秒 | ⏳ |
| REG-PERF-002 | 错误计算 | 1. 100 条错误 2. 计时计算 | < 100ms | ⏳ |
| REG-PERF-003 | 模态框渲染 | 1. 打开模态框 2. 计时渲染 | < 200ms | ⏳ |
| REG-PERF-004 | 监控脚本 | 1. 运行脚本 2. 检查资源 | CPU < 5% | ⏳ |
| REG-PERF-005 | API 响应 | 1. 调用 API 2. 计时响应 | < 500ms | ⏳ |

---

## 📊 测试通过标准

### 功能测试
- [ ] 所有 P0 回归用例 100% 通过
- [ ] 所有核心业务流程用例 100% 通过
- [ ] 无新的功能缺陷

### 性能测试
- [ ] 结果页加载时间 < 3 秒
- [ ] 错误计算时间 < 100ms
- [ ] 模态框渲染时间 < 200ms
- [ ] 监控脚本 CPU 占用 < 5%
- [ ] API 响应时间 < 500ms

### 兼容性测试
- [ ] 微信开发者工具正常
- [ ] iOS 微信正常
- [ ] Android 微信正常

---

## 🐛 问题跟踪

| 问题 ID | 严重程度 | 问题描述 | 复现步骤 | 状态 |
|--------|---------|---------|---------|------|
| REG-BUG-xxx | P0/P1/P2 | 描述 | 步骤 | 新建/修复/验证 |

---

## 📅 测试时间表

| 时间 | 测试内容 | 负责人 | 预计工时 |
|------|---------|--------|---------|
| 第 1 小时 | 前端结果页测试 | 测试工程师 | 1h |
| 第 2 小时 | 告警系统测试 | 测试工程师 | 1h |
| 第 3 小时 | 监控脚本测试 | 测试工程师 | 1h |
| 第 4 小时 | 核心流程测试 | 测试工程师 | 1h |
| 第 5 小时 | 性能测试 | 测试工程师 | 1h |
| 第 6 小时 | 生成报告 | 测试工程师 | 1h |

---

## ✅ 准出标准

- [ ] 回归测试用例通过率 > 98%
- [ ] 无 P0 级回归问题
- [ ] 性能指标全部达标
- [ ] 核心业务流程正常
- [ ] 测试报告已生成

---

**文档维护：** 测试团队  
**最后更新：** 2026-02-26
