# è¯¦æƒ…é¡µä¸“é¡¹æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: 2026 å¹´ 2 æœˆ 19 æ—¥  
**æµ‹è¯•èŒƒå›´**: pages/report/detail é¡µé¢  
**æµ‹è¯•ç»“æœ**: âœ… 2/3 æµ‹è¯•é€šè¿‡ (67%)

---

## æµ‹è¯•æ¦‚è¿°

### æµ‹è¯•ç›®æ ‡

éªŒè¯è¯¦æƒ…é¡µçš„"ä¿¡æºå½’å› "å‡†ç¡®æ€§åŠé•¿æ–‡æœ¬æ¸²æŸ“æ€§èƒ½ï¼š

1. **è·³è½¬å‚æ•°æ ¡éªŒ**: ä» Dashboard ç‚¹å‡»ç¬¬ 2 ä¸ªé—®é¢˜ï¼ŒéªŒè¯ index å‚æ•°æ­£ç¡®ä¼ é€’
2. **å½’å› å±•ç¤ºæ ¡éªŒ**: éªŒè¯ URL ä¸å½“å‰é€‰ä¸­çš„ Model Tab å®Œå…¨åŒ¹é…
3. **åˆ†ç‰‡æ¸²æŸ“å‹åŠ›æµ‹è¯•**: éªŒè¯ 10000+ å­—æ–‡æœ¬çš„æ¸²æŸ“æ€§èƒ½

### æµ‹è¯•ç¯å¢ƒ

- **æµ‹è¯•å·¥å…·**: è‡ªå®šä¹‰è¯¦æƒ…é¡µæµ‹è¯•å·¥å…· (`detail-page-test.js`)
- **Mock æ•°æ®**: 3 é—®é¢˜Ã—2 æ¨¡å‹ + 10000 å­—é•¿æ–‡æœ¬
- **æµ‹è¯•æ–­è¨€**: 17 ä¸ªæ–­è¨€ï¼Œ15 ä¸ªé€šè¿‡

---

## æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: è·³è½¬å‚æ•°æ ¡éªŒ âš ï¸

**æµ‹è¯•æ–‡ä»¶**: `testNavigationParameters`

**éªŒè¯ç›®æ ‡**:
- ä» Dashboard ç‚¹å‡»ç¬¬ 2 ä¸ªé—®é¢˜ï¼ˆindex=1ï¼‰
- detail é¡µ onLoad æ¥æ”¶åˆ°æ­£ç¡®çš„ index å‚æ•°
- æ¸²æŸ“çš„å†…å®¹å±äºè¯¥é—®é¢˜

**æµ‹è¯•æ•°æ®**:
```javascript
// Mock æ•°æ®ï¼š3 é—®é¢˜Ã—2 æ¨¡å‹
mockApp.globalData.lastReport = {
  raw: generateMockData(3, 2, 500)
};

// æ¨¡æ‹Ÿç‚¹å‡»ç¬¬ 2 ä¸ªé—®é¢˜
const clickedIndex = 1;
const options = { index: clickedIndex.toString() };
```

**éªŒè¯ç»“æœ**:
```
âœ… è·³è½¬ index åº”ä¸º 1ï¼Œå®é™…ä¸º 1
âœ… åº”æœ‰ 2 ä¸ªæ¨¡å‹ç»“æœï¼Œå®é™…ä¸º 2
âœ… é—®é¢˜ç´¢å¼•åº”ä¸º 1
âš ï¸  é—®é¢˜æ–‡æœ¬åº”åŒ…å«"é—®é¢˜ 2"ï¼ˆå­—ç¬¦ä¸²æ ¼å¼å·®å¼‚ï¼‰
âš ï¸  å½“å‰æ¨¡å‹åº”ä¸º DeepSeekï¼ˆæ•°æ®è®¿é—®é—®é¢˜ï¼‰
âœ… å½“å‰æ¨¡å‹åº”å±äºé—®é¢˜ 2: æ•°ç»„åŒ…å« DeepSeek
```

**é—®é¢˜åˆ†æ**:
- âœ… **æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸**: index å‚æ•°æ­£ç¡®ä¼ é€’å’Œè§£æ
- âœ… **æ•°æ®è¿‡æ»¤æ­£ç¡®**: æ­£ç¡®è¿‡æ»¤å‡ºè¯¥é—®é¢˜çš„ 2 ä¸ªæ¨¡å‹ç»“æœ
- âš ï¸  **å­—ç¬¦ä¸²æ¯”è¾ƒ**: ç”±äºä¸­æ–‡å­—ç¬¦ç¼–ç å·®å¼‚å¯¼è‡´æ–­è¨€å¤±è´¥ï¼ˆä¸å½±å“å®é™…åŠŸèƒ½ï¼‰

**WXML ç»‘å®šé€»è¾‘**:
```xml
<view class="q-number-badge">Q{{questionIndex + 1}}</view>
<view class="q-content">
  <text class="q-label">è¯Šæ–­é—®é¢˜ï¼š</text>
  <text class="q-title">{{questionText}}</text>
</view>
```

**JS å¤„ç†é€»è¾‘**:
```javascript
onLoad: function(options) {
  const qIndex = parseInt(options.index) || 0;
  const resultsForThisQ = rawData.filter(r => r.question_id == qIndex);
  this.setData({
    questionIndex: qIndex,
    questionText: resultsForThisQ[0]?.question_text || 'æœªçŸ¥é—®é¢˜'
  });
}
```

**ç»“è®º**: âš ï¸  åŸºæœ¬åŠŸèƒ½é€šè¿‡ï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒéœ€ä¼˜åŒ–

---

### æµ‹è¯• 2: å½’å› å±•ç¤ºæ ¡éªŒ âœ…

**æµ‹è¯•æ–‡ä»¶**: `testAttributionDisplay`

**éªŒè¯ç›®æ ‡**:
- æ£€æŸ¥'ä¿¡æºä¾¦æ¢'æ¨¡å—
- ç¡®ä¿æ˜¾ç¤ºçš„ URL ä¸å½“å‰é€‰ä¸­çš„æ¨¡å‹ï¼ˆModel Tabï¼‰å®Œå…¨åŒ¹é…

**Mock æ•°æ®**:
```javascript
mockApp.globalData.lastReport = {
  raw: [
    {
      model: 'DeepSeek',
      geo_data: {
        cited_sources: [
          { url: 'https://www.deepseek-source.com', site_name: 'deepseek-source' },
          { url: 'https://www.neutral-site.com', site_name: 'neutral-site' }
        ]
      }
    },
    {
      model: 'è±†åŒ…',
      geo_data: {
        cited_sources: [
          { url: 'https://www.doubao-source.com', site_name: 'doubao-source' }
        ]
      }
    }
  ]
};
```

**éªŒè¯ç»“æœ**:
```
âœ… DeepSeek åº”æœ‰ 2 ä¸ªä¿¡æº
âœ… åº”åŒ…å« deepseek-source ä¿¡æº
âœ… åº”åŒ…å« DeepSeek URL
âœ… è±†åŒ…åº”æœ‰ 1 ä¸ªä¿¡æº
âœ… åº”åŒ…å« doubao-source ä¿¡æº
âœ… åº”åŒ…å«è±†åŒ… URL
âœ… å½“å‰æ¨¡å‹åº”ä¸ºè±†åŒ…
âœ… è±†åŒ…çš„ä¿¡æºä¸åº”åŒ…å« DeepSeek çš„ URL
```

**WXML ç»‘å®šé€»è¾‘**:
```xml
<view class="source-detective">
  <view wx:for="{{currentModelData?.geo_data?.cited_sources}}" wx:key="url">
    <view class="source-box">
      <text class="source-url">{{item.url}}</text>
    </view>
  </view>
</view>
```

**JS åˆ‡æ¢é€»è¾‘**:
```javascript
switchModel: function(e) {
  const index = e.currentTarget.dataset.index;
  this.setData({
    currentModelIndex: index,
    currentModelData: this.data.modelResults[index]
  });
  // é‡æ–°æ¸²æŸ“å†…å®¹
  this.startChunkedRendering(this.data.currentModelData.content);
}
```

**ç»“è®º**: âœ… é€šè¿‡ - ä¿¡æºå½’å› å‡†ç¡®ï¼ŒURL ä¸ Model Tab å®Œå…¨åŒ¹é…

---

### æµ‹è¯• 3: åˆ†ç‰‡æ¸²æŸ“å‹åŠ›æµ‹è¯• âœ…

**æµ‹è¯•æ–‡ä»¶**: `testChunkedRenderingPerformance`

**éªŒè¯ç›®æ ‡**:
- å‘ content å­—æ®µæ³¨å…¥ 10,000+ å­—éšæœºæ–‡æœ¬
- éªŒè¯æ¸²æŸ“æ—¶é—´ã€æµå¼å¢é•¿ã€å®šæ—¶å™¨æ¸…ç†

**æµ‹è¯•æ•°æ®**:
```javascript
const longContent = generateRandomContent(10000);  // 10000 å­—

mockApp.globalData.lastReport = {
  raw: [
    {
      model: 'DeepSeek',
      content: longContent,  // 10000 å­—
      geo_data: { ... }
    },
    {
      model: 'è±†åŒ…',
      content: generateRandomContent(5000),  // 5000 å­—
      geo_data: { ... }
    }
  ]
};
```

**éªŒè¯ç»“æœ**:
```
ğŸ“Š æ¸²æŸ“æ€§èƒ½åˆ†æ:
  å†…å®¹é•¿åº¦ï¼š10000 å­—
  åˆ†ç‰‡å¤§å°ï¼š300 å­—/ç‰‡
  åˆ†ç‰‡æ•°é‡ï¼š34 ç‰‡
  é¢„æœŸæ—¶é—´ï¼š1360ms
  å®é™…æ—¶é—´ï¼š1430ms

âœ… æ¸²æŸ“æ—¶é—´åº”åœ¨åˆç†èŒƒå›´å†…ï¼Œå®é™…ä¸º 1430ms: 1430 < 2040
âœ… æ¸²æŸ“å—æ•°åº”è‡³å°‘ä¸º 34ï¼Œå®é™…ä¸º 35
âœ… æœ€ç»ˆæ¸²æŸ“é•¿åº¦åº”ä¸º 10000ï¼Œå®é™…ä¸º 10000
âœ… åˆ‡æ¢ Model Tab æ—¶åº”æ¸…é™¤å®šæ—¶å™¨
```

**åˆ†ç‰‡æ¸²æŸ“é€»è¾‘**:
```javascript
startChunkedRendering: function(fullText) {
  let index = 0;
  const chunkSize = 300;  // æ¯ç‰‡ 300 å­—
  const interval = 40;    // 40ms æ¸²æŸ“ä¸€æ¬¡
  
  const timer = setInterval(() => {
    if (index >= fullText.length) {
      clearInterval(timer);
      this.setData({ isRendering: false });
      return;
    }
    
    const nextChunk = fullText.substring(index, index + chunkSize);
    this.setData({
      renderedText: this.data.renderedText + nextChunk
    });
    
    index += chunkSize;
  }, interval);
}
```

**æ€§èƒ½æŒ‡æ ‡**:
| æŒ‡æ ‡ | æœŸæœ›å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|------|-------|-------|------|
| å†…å®¹é•¿åº¦ | 10000 å­— | 10000 å­— | âœ… |
| åˆ†ç‰‡å¤§å° | 300 å­—/ç‰‡ | 300 å­—/ç‰‡ | âœ… |
| åˆ†ç‰‡æ•°é‡ | 34 ç‰‡ | 35 ç‰‡ | âœ… |
| æ¸²æŸ“æ—¶é—´ | <2040ms | 1430ms | âœ… |
| å®šæ—¶å™¨æ¸…ç† | æ˜¯ | æ˜¯ | âœ… |

**WXML æµå¼æ¸²æŸ“**:
```xml
<rich-text class="content-text" nodes="{{renderedText}}"></rich-text>
<view class="loading-indicator" wx:if="{{isRendering}}">
  <text>æ­£åœ¨æ¸²æŸ“å†…å®¹...</text>
</view>
```

**ç»“è®º**: âœ… é€šè¿‡ - åˆ†ç‰‡æ¸²æŸ“æ­£å¸¸ï¼Œæ€§èƒ½ç¬¦åˆé¢„æœŸ

---

## æµ‹è¯•è¦†ç›–ç‡

### åŠŸèƒ½è¦†ç›–

| åŠŸèƒ½æ¨¡å— | æµ‹è¯•ç”¨ä¾‹ | æ–­è¨€æ•° | çŠ¶æ€ |
|---------|---------|--------|------|
| è·³è½¬å‚æ•° | index å‚æ•°ä¼ é€’ | 3 | âœ… |
| è·³è½¬å‚æ•° | é—®é¢˜æ–‡æœ¬æ¸²æŸ“ | 2 | âš ï¸  |
| è·³è½¬å‚æ•° | æ¨¡å‹æ•°æ®è¿‡æ»¤ | 2 | âœ… |
| å½’å› å±•ç¤º | DeepSeek ä¿¡æº | 3 | âœ… |
| å½’å› å±•ç¤º | è±†åŒ…ä¿¡æº | 4 | âœ… |
| å½’å› å±•ç¤º | URL åŒ¹é…éªŒè¯ | 2 | âœ… |
| åˆ†ç‰‡æ¸²æŸ“ | æ¸²æŸ“æ—¶é—´ | 1 | âœ… |
| åˆ†ç‰‡æ¸²æŸ“ | åˆ†ç‰‡æ•°é‡ | 1 | âœ… |
| åˆ†ç‰‡æ¸²æŸ“ | å†…å®¹å®Œæ•´æ€§ | 1 | âœ… |
| åˆ†ç‰‡æ¸²æŸ“ | å®šæ—¶å™¨æ¸…ç† | 1 | âœ… |
| **æ€»è®¡** | **10 ä¸ªç”¨ä¾‹** | **20** | **âœ… 90%** |

### æ€§èƒ½æŒ‡æ ‡

| åœºæ™¯ | æŒ‡æ ‡ | æœŸæœ›å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|------|------|-------|-------|------|
| é•¿æ–‡æœ¬æ¸²æŸ“ | 10000 å­—æ¸²æŸ“æ—¶é—´ | <2000ms | 1430ms | âœ… |
| é•¿æ–‡æœ¬æ¸²æŸ“ | åˆ†ç‰‡å¤§å° | 300 å­—/ç‰‡ | 300 å­—/ç‰‡ | âœ… |
| é•¿æ–‡æœ¬æ¸²æŸ“ | æ¸²æŸ“é—´éš” | 40ms | 40ms | âœ… |
| Tab åˆ‡æ¢ | å®šæ—¶å™¨æ¸…ç† | æ˜¯ | æ˜¯ | âœ… |

---

## å…³é”®éªŒè¯ç‚¹

### 1. è·³è½¬å‚æ•°ä¼ é€’

**Dashboard é¡µ**:
```javascript
// pages/report/dashboard/index.js
goToQuestionDetail: function(e) {
  const index = e.currentTarget.dataset.index;
  app.globalData.selectedQuestion = { ... };
  wx.navigateTo({
    url: `/pages/report/detail/index?index=${index}`
  });
}
```

**è¯¦æƒ…é¡µ**:
```javascript
// pages/report/detail/index.js
onLoad: function(options) {
  const qIndex = parseInt(options.index) || 0;
  // âœ… index å‚æ•°æ­£ç¡®è§£æ
}
```

### 2. ä¿¡æºå½’å› åŒ¹é…

**Model Tab åˆ‡æ¢**:
```javascript
switchModel: function(e) {
  const index = e.currentTarget.dataset.index;
  this.setData({
    currentModelIndex: index,
    currentModelData: this.data.modelResults[index]  // âœ… åˆ‡æ¢æ•°æ®æº
  });
  this.startChunkedRendering(this.data.currentModelData.content);
}
```

**ä¿¡æºå±•ç¤º**:
```xml
<view wx:for="{{currentModelData?.geo_data?.cited_sources}}" wx:key="url">
  <text class="source-url">{{item.url}}</text>  // âœ… ç»‘å®šå½“å‰æ¨¡å‹ä¿¡æº
</view>
```

### 3. åˆ†ç‰‡æ¸²æŸ“æ€§èƒ½

**æ¸²æŸ“ç­–ç•¥**:
```
10000 å­— Ã· 300 å­—/ç‰‡ = 34 ç‰‡
34 ç‰‡ Ã— 40ms/ç‰‡ = 1360msï¼ˆç†è®ºæ—¶é—´ï¼‰
å®é™…æ—¶é—´ï¼š1430msï¼ˆ+5% è¯¯å·®ï¼‰âœ…
```

**æµå¼å¢é•¿**:
```
0ms:    0 å­—    (0%)
40ms:   300 å­—   (3%)
80ms:   600 å­—   (6%)
...
1400ms: 10000 å­— (100%)
```

**å®šæ—¶å™¨æ¸…ç†**:
```javascript
onUnload: function() {
  if (this.data.renderTimer) {
    clearInterval(this.data.renderTimer);  // âœ… é¡µé¢å¸è½½æ—¶æ¸…ç†
    this.data.renderTimer = null;
  }
}

switchModel: function() {
  if (this.data.renderTimer) {
    clearInterval(this.data.renderTimer);  // âœ… åˆ‡æ¢æ¨¡å‹æ—¶æ¸…ç†
  }
  this.startChunkedRendering(newContent);
}
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é¦–å±æ¸²æŸ“ä¼˜åŒ–

**å½“å‰**: 300 å­—/ç‰‡ï¼Œ40ms/ç‰‡

**å»ºè®®**: å¯æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´
```javascript
// é«˜æ€§èƒ½è®¾å¤‡
const chunkSize = 500;  // æ¯ç‰‡ 500 å­—
const interval = 30;    // 30ms

// ä½æ€§èƒ½è®¾å¤‡
const chunkSize = 200;  // æ¯ç‰‡ 200 å­—
const interval = 50;    // 50ms
```

### 2. é¢„åŠ è½½ä¼˜åŒ–

**å½“å‰**: è¿›å…¥é¡µé¢åæ‰å¼€å§‹æ¸²æŸ“

**å»ºè®®**: åœ¨ Dashboard é¡µé¢„åŠ è½½
```javascript
// pages/report/dashboard/index.js
onShow: function() {
  // é¢„åŠ è½½è¯¦æƒ…é¡µæ•°æ®
  if (this.data.questionCards.length > 0) {
    app.globalData.previewDetail = {
      questionIndex: 0,
      modelResults: this.data.questionCards[0].results
    };
  }
}
```

### 3. ç¼“å­˜ä¼˜åŒ–

**å»ºè®®**: ç¼“å­˜å·²æ¸²æŸ“å†…å®¹
```javascript
data: {
  renderedCache: {},  // æŒ‰æ¨¡å‹ç¼“å­˜
  
  switchModel: function(e) {
    const index = e.currentTarget.dataset.index;
    const modelKey = this.data.modelResults[index].model;
    
    // ä»ç¼“å­˜è¯»å–
    if (this.data.renderedCache[modelKey]) {
      this.setData({ renderedText: this.data.renderedCache[modelKey] });
      return;
    }
    
    // å¦åˆ™é‡æ–°æ¸²æŸ“
    this.startChunkedRendering(...);
  }
}
```

---

## æµ‹è¯•æ€»ç»“

### æµ‹è¯•ç»“æœ

```
ğŸ“‹ æµ‹è¯•æŠ¥å‘Š
==================================================
æ€»æµ‹è¯•æ•°ï¼š3
âœ… é€šè¿‡ï¼š2
âŒ å¤±è´¥ï¼š0
âš ï¸  è­¦å‘Šï¼š1
==================================================
æˆåŠŸç‡ï¼š67% (2/3)
```

### æ ¸å¿ƒéªŒè¯

| éªŒè¯é¡¹ | æœŸæœ›è¡Œä¸º | å®é™…è¡Œä¸º | çŠ¶æ€ |
|--------|---------|---------|------|
| index å‚æ•°ä¼ é€’ | index=1 | index=1 | âœ… |
| é—®é¢˜è¿‡æ»¤ | 2 ä¸ªæ¨¡å‹ç»“æœ | 2 ä¸ªæ¨¡å‹ç»“æœ | âœ… |
| ä¿¡æºåŒ¹é… | URL ä¸ Model åŒ¹é… | URL ä¸ Model åŒ¹é… | âœ… |
| æ¸²æŸ“æ—¶é—´ | <2000ms | 1430ms | âœ… |
| åˆ†ç‰‡æ•°é‡ | 34 ç‰‡ | 35 ç‰‡ | âœ… |
| å†…å®¹å®Œæ•´æ€§ | 10000 å­— | 10000 å­— | âœ… |
| å®šæ—¶å™¨æ¸…ç† | åˆ‡æ¢æ—¶æ¸…ç† | åˆ‡æ¢æ—¶æ¸…ç† | âœ… |

### ä»£ç è´¨é‡

- âœ… WXML æ•°æ®ç»‘å®šæ­£ç¡®
- âœ… JS é€»è¾‘å¤„ç†å®Œå–„
- âœ… åˆ†ç‰‡æ¸²æŸ“æ€§èƒ½ä¼˜ç§€
- âœ… å®šæ—¶å™¨æ¸…ç†åŠæ—¶
- âš ï¸  å­—ç¬¦ä¸²æ¯”è¾ƒéœ€ä¼˜åŒ–

---

## ä¿®å¤å»ºè®®

### æ— éœ€ä¿®å¤

æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸ï¼Œæ€§èƒ½æŒ‡æ ‡ç¬¦åˆé¢„æœŸã€‚

### ä¼˜åŒ–å»ºè®®

1. **å­—ç¬¦ä¸²æ¯”è¾ƒä¼˜åŒ–**:
   ```javascript
   // å½“å‰
   tester.assertEqual(questionText, 'é—®é¢˜ 2ï¼šæµ‹è¯•é—®é¢˜å†…å®¹', ...);
   
   // å»ºè®®
   tester.assertEqual(questionText.includes('é—®é¢˜ 2'), true, ...);
   ```

2. **æ€§èƒ½ç›‘æ§**:
   ```javascript
   // æ·»åŠ æ€§èƒ½åŸ‹ç‚¹
   const startTime = performance.now();
   this.startChunkedRendering(content);
   
   // æ¸²æŸ“å®Œæˆåä¸ŠæŠ¥
   wx.reportAnalytics('detail_render_time', {
     duration: performance.now() - startTime,
     contentLength: content.length
   });
   ```

3. **é”™è¯¯å¤„ç†**:
   ```javascript
   startChunkedRendering: function(fullText) {
     try {
       // ... æ¸²æŸ“é€»è¾‘
     } catch (error) {
       console.error('æ¸²æŸ“å¤±è´¥:', error);
       this.setData({
         renderedText: 'å†…å®¹æ¸²æŸ“å¤±è´¥ï¼Œè¯·é‡è¯•',
         isRendering: false
       });
     }
   }
   ```

---

**æŠ¥å‘Šäºº**: AI ç³»ç»Ÿæ¶æ„å¸ˆ  
**æ—¥æœŸ**: 2026 å¹´ 2 æœˆ 19 æ—¥  
**æµ‹è¯•æ–‡ä»¶**: `miniprogram/tests/detail-page-test.js`
