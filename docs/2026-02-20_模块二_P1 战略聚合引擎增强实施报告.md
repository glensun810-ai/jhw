# æ¨¡å—äºŒï¼šP1 æˆ˜ç•¥èšåˆå¼•æ“å¢å¼ºå®æ–½æŠ¥å‘Š

**å®æ–½æ—¶é—´**: 2026-02-20  
**å®æ–½çº§åˆ«**: P1 å¢å¼º (å·¥ä¸šçº§ç¨³å¥åº¦)  
**å®æ–½çŠ¶æ€**: âœ… å®Œæˆå¹¶é€šè¿‡æµ‹è¯• (4/4)

---

## ä¸€ã€å¢å¼ºæ¦‚è¿°

ä¸ºäº†è®©èšåˆå¼•æ“è¾¾åˆ°"å·¥ä¸šçº§"ç¨³å¥åº¦ï¼Œæ ¹æ®æµ‹è¯•ä¸“å®¶ã€äº§å“ç»ç†å’Œ UI å¼€å‘ä¸“å®¶çš„è”åˆå»ºè®®ï¼Œå®æ–½ä¸‰é¡¹è¡¥å……å¢å¼ºï¼š

| ä»»åŠ¡ | å»ºè®®äºº | ç›®æ ‡ | çŠ¶æ€ |
|------|--------|------|------|
| ä»»åŠ¡ 1 | æµ‹è¯•ä¸“å®¶ | ç®—æ³•é²æ£’æ€§åŠ å›º - é›¶åˆ†æ¯ä¿æŠ¤ + æ•°æ®ç±»å‹å¼ºåˆ¶è½¬æ¢ | âœ… |
| ä»»åŠ¡ 2 | äº§å“ç»ç† | ç«å“æ‹¦æˆªç®—æ³•ä¼˜åŒ– - æ¨¡ç³ŠåŒ¹é… + å…³é”®è¯æå– | âœ… |
| ä»»åŠ¡ 3 | UI å¼€å‘ä¸“å®¶ | UI çŠ¶æ€æ˜ å°„å­—å…¸åŒ– - è¯­ä¹‰åŒ–çŠ¶æ€ + é£é™©åˆ†çº§ | âœ… |

---

## äºŒã€ä»»åŠ¡ 1ï¼šç®—æ³•é²æ£’æ€§åŠ å›º

### 1.1 é›¶åˆ†æ¯ä¿æŠ¤

**é—®é¢˜**: è®¡ç®— Sentiment Index å’Œ SOV æ—¶ï¼Œè‹¥åˆ†æ¯ä¸º 0 ä¼šäº§ç”Ÿ Infinity æˆ– NaN

**è§£å†³æ–¹æ¡ˆ**: åœ¨æ‰€æœ‰é™¤æ³•è¿ç®—å‰å¢åŠ åˆ†æ¯æ£€æŸ¥

**ä»£ç å®ç°**:
```javascript
// calculateSOV å‡½æ•°
export const calculateSOV = (results, totalModels) => {
  // ã€ä»»åŠ¡ 1ã€‘é›¶åˆ†æ¯ä¿æŠ¤
  if (!results || results.length === 0 || !totalModels || totalModels === 0) {
    return 0;
  }

  const totalVisibilityScore = results.reduce((sum, r) => {
    const visibilityScore = r.geo_data?._visibility_score ?? r._visibility_score ?? 0;
    return sum + Number(visibilityScore);
  }, 0);

  const maxPossibleScore = results.length * 100;
  
  // ã€ä»»åŠ¡ 1ã€‘é›¶åˆ†æ¯ä¿æŠ¤ - é¿å…é™¤ä»¥ 0
  const sov = maxPossibleScore > 0 ? (totalVisibilityScore / maxPossibleScore) * 100 : 0;
  
  return parseFloat(Number(sov).toFixed(2));
};

// calculateSentimentIndex å‡½æ•°
export const calculateSentimentIndex = (results) => {
  // ...
  const validSamples = mentionedResults.length;

  if (validSamples === 0) {
    return {
      sentimentIndex: 0,
      validSamples: 0,
      totalSamples: results.length,
      sentimentLabel: 'no_mentions',
      sentimentColor: SENTIMENT_COLOR_MAP.neutral
    };
  }

  const sentimentSum = mentionedResults.reduce((sum, r) => {
    const sentiment = r.geo_data?.sentiment ?? 0;
    return sum + Number(sentiment);
  }, 0);

  // ã€ä»»åŠ¡ 1ã€‘é›¶åˆ†æ¯ä¿æŠ¤ - é¿å…é™¤ä»¥ 0
  const sentimentIndex = validSamples > 0 ? sentimentSum / validSamples : 0;
  // ...
};
```

### 1.2 æ•°æ®ç±»å‹å¼ºåˆ¶è½¬æ¢

**é—®é¢˜**: åç«¯å¯èƒ½æ„å¤–è¿”å›å­—ç¬¦ä¸²æ ¼å¼çš„æ•°å­—ï¼Œå¯¼è‡´åŠ æ³•è¿ç®—å˜æˆå­—ç¬¦ä¸²æ‹¼æ¥

**è§£å†³æ–¹æ¡ˆ**: åœ¨æ‰€æœ‰æ•°å€¼è¿ç®—å‰ä½¿ç”¨ `Number()` å¼ºåˆ¶è½¬æ¢

**ä»£ç å®ç°**:
```javascript
// visibility_score å¼ºåˆ¶è½¬æ¢
const visibilityScore = r.geo_data?._visibility_score ?? r._visibility_score ?? 0;
return sum + Number(visibilityScore);

// sentiment å¼ºåˆ¶è½¬æ¢
const sentiment = r.geo_data?.sentiment ?? 0;
return sum + Number(sentiment);

// è¿”å›å€¼å¼ºåˆ¶è½¬æ¢
return parseFloat(Number(sov).toFixed(2));
return parseFloat(Number(sentimentIndex).toFixed(2));
```

### 1.3 æµ‹è¯•éªŒè¯

```javascript
// æµ‹è¯•ç”¨ä¾‹ï¼šé›¶åˆ†æ¯åœºæ™¯
{
  name: 'æµ‹è¯•ï¼šé›¶åˆ†æ¯ä¿æŠ¤',
  input: {
    results: [],  // ç©ºæ•°ç»„
    brandName: 'Test',
    competitors: []
  },
  expected: {
    result: null  // åº”è¿”å› null è€ŒéæŠ›å‡ºå¼‚å¸¸
  }
}

// æµ‹è¯•ç”¨ä¾‹ï¼šå­—ç¬¦ä¸²æ•°å­—åœºæ™¯
{
  name: 'æµ‹è¯•ï¼šæ•°æ®ç±»å‹å¼ºåˆ¶è½¬æ¢',
  input: {
    results: [
      { 
        question_id: 0, 
        model: 'test', 
        geo_data: { 
          brand_mentioned: true, 
          rank: "2",  // å­—ç¬¦ä¸²è€Œéæ•°å­—
          sentiment: "0.5"  // å­—ç¬¦ä¸²è€Œéæ•°å­—
        } 
      }
    ],
    brandName: 'Test',
    competitors: []
  },
  expected: {
    sov: 100,  // åº”æ­£ç¡®è®¡ç®—è€Œé NaN
    sentimentIndex: 0.5  // åº”æ­£ç¡®è§£æè€Œé "0.5"
  }
}
```

---

## ä¸‰ã€ä»»åŠ¡ 2ï¼šç«å“æ‹¦æˆªç®—æ³•ä¼˜åŒ–

### 2.1 æ¨¡ç³ŠåŒ¹é… - ç«å“åç§°å½’ä¸€åŒ–

**é—®é¢˜**: ã€åä¸ºã€å’Œã€åä¸ºæ‰‹æœºã€åº”è§†ä¸ºåŒä¸€ç«å“ï¼Œä½†è¢«ç»Ÿè®¡ä¸ºä¸¤ä¸ª

**è§£å†³æ–¹æ¡ˆ**: å®ç°ç«å“åç§°å½’ä¸€åŒ–å‡½æ•°

**ä»£ç å®ç°**:
```javascript
/**
 * ã€ä»»åŠ¡ 2ã€‘æ¨¡ç³ŠåŒ¹é… - ç«å“åç§°å½’ä¸€åŒ–
 * 
 * å°†ç›¸ä¼¼åç§°å½’ä¸€åŒ–ä¸ºåŒä¸€ç«å“
 * 
 * è§„åˆ™ï¼š
 * 1. å¦‚æœä¸€ä¸ªåç§°åŒ…å«å¦ä¸€ä¸ªåç§°ï¼Œåˆ™å½’ä¸€åŒ–ä¸ºè¾ƒçŸ­çš„åç§°
 * 2. å»é™¤é€šç”¨åç¼€ï¼ˆå¦‚'æ‰‹æœº'ã€'å…¬å¸'ã€'é›†å›¢'ç­‰ï¼‰
 */
export const normalizeCompetitorName = (name) => {
  if (!name || typeof name !== 'string') {
    return '';
  }
  
  // å»é™¤é€šç”¨åç¼€
  const suffixes = ['æ‰‹æœº', 'å…¬å¸', 'é›†å›¢', 'ç§‘æŠ€', 'è‚¡ä»½', 'æœ‰é™', 'å“ç‰Œ', 'äº§å“'];
  let normalizedName = name.trim();
  
  suffixes.forEach(suffix => {
    if (normalizedName.endsWith(suffix) && normalizedName.length > suffix.length + 1) {
      normalizedName = normalizedName.slice(0, -suffix.length);
    }
  });
  
  return normalizedName.trim();
};
```

**æµ‹è¯•ç”¨ä¾‹**:
| åŸå§‹åç§° | å½’ä¸€åŒ–å |
|---------|---------|
| åä¸ºæ‰‹æœº | åä¸º |
| è‹¹æœå…¬å¸ | è‹¹æœ |
| å°ç±³ç§‘æŠ€ | å°ç±³ |
| å¥”é©° | å¥”é©° |
| BMW | BMW |

### 2.2 å…³é”®è¯æå– - ä»é•¿å¥ä¸­æå–ç«å“åè¯

**é—®é¢˜**: åç«¯è¿”å›çš„ interception å¯èƒ½æ˜¯é•¿å¥å­ï¼Œä¸é€‚åˆç›´æ¥å±•ç¤º

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å…³é”®è¯

**ä»£ç å®ç°**:
```javascript
/**
 * ã€ä»»åŠ¡ 2ã€‘å…³é”®è¯æå– - ä»é•¿å¥ä¸­æå–ç«å“åè¯
 * 
 * ç­–ç•¥ï¼š
 * 1. æå–å¼•å·å†…çš„å†…å®¹
 * 2. æå–"äº†/æ˜¯/ä¸º"ç­‰åŠ¨è¯åçš„åè¯çŸ­è¯­
 * 3. æå–è¿ç»­çš„ä¸­è‹±æ–‡å­—ç¬¦ï¼ˆ2-10 ä¸ªå­—ç¬¦ï¼‰
 */
export const extractCompetitorKeyword = (text) => {
  if (!text || typeof text !== 'string') {
    return '';
  }
  
  const trimmedText = text.trim();
  
  // å¦‚æœæ–‡æœ¬å¾ˆçŸ­ï¼ˆ< 5 å­—ç¬¦ï¼‰ï¼Œç›´æ¥è¿”å›
  if (trimmedText.length < 5) {
    return normalizeCompetitorName(trimmedText);
  }
  
  // ç­–ç•¥ 1: æå–å¼•å·å†…çš„å†…å®¹
  const quoteMatch = trimmedText.match(/[""]([^""]{2,15})[""]/);
  if (quoteMatch && quoteMatch[1]) {
    return normalizeCompetitorName(quoteMatch[1]);
  }
  
  // ç­–ç•¥ 2: æå–"äº†/æ˜¯/ä¸º/æ¨è/é€‰æ‹©"ç­‰åŠ¨è¯åçš„åè¯çŸ­è¯­
  const verbPatterns = [
    /äº†\s*([^\s,ï¼Œ.ã€‚]{2,10})/,
    /æ˜¯\s*([^\s,ï¼Œ.ã€‚]{2,10})/,
    /ä¸º\s*([^\s,ï¼Œ.ã€‚]{2,10})/,
    /æ¨è\s*([^\s,ï¼Œ.ã€‚]{2,10})/,
    /é€‰æ‹©\s*([^\s,ï¼Œ.ã€‚]{2,10})/,
    /æåˆ°\s*([^\s,ï¼Œ.ã€‚]{2,10})/
  ];
  
  for (const pattern of verbPatterns) {
    const match = trimmedText.match(pattern);
    if (match && match[1]) {
      const extracted = match[1].trim();
      if (/^[a-zA-Z\u4e00-\u9fa5]+$/.test(extracted)) {
        return normalizeCompetitorName(extracted);
      }
    }
  }
  
  // ç­–ç•¥ 3: æå–ç¬¬ä¸€ä¸ªè¿ç»­çš„åè¯çŸ­è¯­
  const nounPattern = /([a-zA-Z\u4e00-\u9fa5]{2,8})/;
  const nounMatch = trimmedText.match(nounPattern);
  if (nounMatch && nounMatch[1]) {
    return normalizeCompetitorName(nounMatch[1]);
  }
  
  // å…œåº•ï¼šè¿”å›åŸæ–‡æœ¬ï¼ˆå½’ä¸€åŒ–åï¼‰
  return normalizeCompetitorName(trimmedText.substring(0, 10));
};
```

**æµ‹è¯•ç”¨ä¾‹**:
| åŸå§‹æ–‡æœ¬ | æå–ç»“æœ |
|---------|---------|
| "æˆ‘æ¨èäº†åä¸º" | åä¸º |
| "ç”¨æˆ·é€‰æ‹©äº†"BMW"" | BMW |
| "æåˆ°äº†å°ç±³æ‰‹æœº" | å°ç±³ |
| "å»ºè®®é€‰æ‹©è‹¹æœ" | è‹¹æœ |
| "ç«å“æ˜¯å¥”é©°" | å¥”é©° |

### 2.3 ç«å“é¢‘ç‡åˆå¹¶

**ä»£ç å®ç°**:
```javascript
/**
 * ã€ä»»åŠ¡ 2ã€‘ç«å“é¢‘ç‡åˆå¹¶ - åˆå¹¶ç›¸ä¼¼åç§°
 */
export const mergeCompetitorFrequencies = (interceptionCount) => {
  const mergedCount = {};
  
  Object.entries(interceptionCount).forEach(([name, count]) => {
    const normalizedName = normalizeCompetitorName(name);
    if (normalizedName) {
      mergedCount[normalizedName] = (mergedCount[normalizedName] || 0) + count;
    }
  });
  
  return mergedCount;
};
```

### 2.4 é›†æˆåˆ° calculateInterceptionMatrix

```javascript
export const calculateInterceptionMatrix = (results) => {
  const interceptionCount = {};

  results.forEach(r => {
    const interception = r.geo_data?.interception;
    if (interception && interception.trim()) {
      // ã€ä»»åŠ¡ 2ã€‘å…³é”®è¯æå–
      const extractedKeyword = extractCompetitorKeyword(interception);
      
      if (extractedKeyword) {
        interceptionCount[extractedKeyword] = (interceptionCount[extractedKeyword] || 0) + 1;
      }
    }
  });

  // ã€ä»»åŠ¡ 2ã€‘ç«å“é¢‘ç‡åˆå¹¶
  const mergedCount = mergeCompetitorFrequencies(interceptionCount);

  const topCompetitors = Object.entries(mergedCount)
    .map(([name, frequency]) => ({
      name,
      frequency,
      percentage: parseFloat(((frequency / results.length) * 100).toFixed(2)),
      // ã€ä»»åŠ¡ 2ã€‘æ–°å¢ï¼šåŸå§‹åç§°åˆ—è¡¨ï¼ˆç”¨äºè°ƒè¯•ï¼‰
      originalNames: Object.keys(interceptionCount).filter(n => 
        normalizeCompetitorName(n) === name
      )
    }))
    .sort((a, b) => b.frequency - a.frequency);

  return topCompetitors;
};
```

---

## å››ã€ä»»åŠ¡ 3ï¼šUI çŠ¶æ€æ˜ å°„å­—å…¸åŒ–

### 3.1 è¯­ä¹‰åŒ–çŠ¶æ€

**é—®é¢˜**: JS ä¸­å†™æ­»é¢œè‰²ä»£ç ï¼Œä¸åˆ©äºå‰ç«¯æ ·å¼ç»´æŠ¤

**è§£å†³æ–¹æ¡ˆ**: è¾“å‡ºè¯­ä¹‰åŒ–çŠ¶æ€ï¼Œè®© WXML é€šè¿‡ class ç»‘å®šæ ·å¼

**ä»£ç å®ç°**:
```javascript
export const buildBrandHealth = (healthData, sov, sentimentData) => {
  // ã€ä»»åŠ¡ 3ã€‘è¯­ä¹‰åŒ–çŠ¶æ€ - è¾“å‡º sentiment_status è€Œéé¢œè‰²ä»£ç 
  const sentimentStatus = sentimentData.sentimentLabel; // 'positive' | 'neutral' | 'negative'
  
  // ã€ä»»åŠ¡ 3ã€‘é£é™©åˆ†çº§ç­–ç•¥ - åŸºäºå¥åº·åº¦å’Œæƒ…æ„Ÿ
  let riskLevel;
  if (healthData.score < 40 || sentimentData.sentimentIndex < -0.3) {
    riskLevel = 'critical';  // é«˜é£é™©
  } else if (healthData.score < 60 || sentimentData.sentimentIndex < 0) {
    riskLevel = 'warning';   // ä¸­é£é™©
  } else {
    riskLevel = 'safe';      // ä½é£é™©
  }

  return {
    score: healthData.score,
    sov_label: sovLabel,
    // ã€ä»»åŠ¡ 3ã€‘è¯­ä¹‰åŒ–çŠ¶æ€
    sentiment_status: sentimentStatus,  // 'positive' | 'neutral' | 'negative'
    // ã€ä»»åŠ¡ 3ã€‘é£é™©åˆ†çº§
    risk_level: riskLevel,  // 'critical' | 'warning' | 'safe'
    // ä¿ç•™å‘åå…¼å®¹å­—æ®µ
    sentiment_color: sentimentData.sentimentColor,
    sentiment_label: sentimentData.sentimentLabel
  };
};
```

### 3.2 é£é™©åˆ†çº§ç­–ç•¥ä¼˜åŒ–

**é—®é¢˜**: åŸæœ‰é£é™©åˆ†çº§ä»…åŸºäºæåŠç‡ï¼Œä¸å¤Ÿç›´è§‚

**è§£å†³æ–¹æ¡ˆ**: åŸºäº avg_rank å’Œ sentiment å¤šç»´åº¦åˆ¤å®š

**é£é™©åˆ†çº§æ ‡å‡†**:
| æ¡ä»¶ | é£é™©ç­‰çº§ | è¯´æ˜ |
|------|---------|------|
| avg_rank > 5 ä¸” sentiment < 0 | critical | é«˜é£é™©ï¼šæ’åé åä¸”æƒ…æ„Ÿè´Ÿé¢ |
| avg_rank > 3 æˆ– sentiment < 0.2 | warning | ä¸­é£é™©ï¼šæ’åä¸­ç­‰æˆ–æƒ…æ„Ÿä¸€èˆ¬ |
| mentionRate < 30% | high | æåŠç‡è¿‡ä½ |
| mentionRate 30-60% | mid | æåŠç‡ä¸­ç­‰ |
| å…¶ä»– | safe | ä½é£é™©ï¼šæ’åé å‰ä¸”æƒ…æ„Ÿæ­£é¢ |

**ä»£ç å®ç°**:
```javascript
export const buildDiagnosticGrid = (results, questionMap) => {
  const diagnosticGrid = Object.values(questionMap).map(q => {
    // è®¡ç®—å¹³å‡æ’åå’Œæƒ…æ„Ÿ
    const avgRankNumeric = mentionCount > 0 ? rankSum / mentionCount : 10;
    const avgSentiment = mentionCount > 0 ? sentimentSum / mentionCount : 0;

    // ã€ä»»åŠ¡ 3ã€‘é£é™©åˆ†çº§ç­–ç•¥ä¼˜åŒ– - åŸºäº avg_rank å’Œ sentiment
    let riskLevel;
    if (avgRankNumeric > 5 && avgSentiment < 0) {
      riskLevel = 'critical';  // é«˜é£é™©ï¼šæ’åé åä¸”æƒ…æ„Ÿè´Ÿé¢
    } else if (avgRankNumeric > 3 || avgSentiment < 0.2) {
      riskLevel = 'warning';   // ä¸­é£é™©ï¼šæ’åä¸­ç­‰æˆ–æƒ…æ„Ÿä¸€èˆ¬
    } else if (mentionRate < RISK_THRESHOLDS.high) {
      riskLevel = 'high';      // æåŠç‡è¿‡ä½
    } else if (mentionRate < RISK_THRESHOLDS.mid) {
      riskLevel = 'mid';       // æåŠç‡ä¸­ç­‰
    } else {
      riskLevel = 'safe';      // ä½é£é™©
    }

    return {
      question_id: q.questionId,
      question_text: q.questionText,
      avg_rank: avgRank,
      risk_level: riskLevel,
      // ...
    };
  });

  return diagnosticGrid;
};
```

### 3.3 å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

**WXML æ¨¡æ¿**:
```xml
<!-- å“ç‰Œå¥åº·å¡ç‰‡ -->
<view class="health-card sentiment-{{brandHealth.sentiment_status}}">
  <text>å“ç‰Œå¥åº·åº¦ï¼š{{brandHealth.score}}/100</text>
  <text>å¸‚åœºåœ°ä½ï¼š{{brandHealth.sov_label}}</text>
  <text>æƒ…æ„ŸçŠ¶æ€ï¼š{{brandHealth.sentiment_status}}</text>
</view>

<!-- è¯Šæ–­ç½‘æ ¼ - é£é™©å¢™ -->
<view wx:for="{{diagnosticGrid}}" wx:key="question_id" 
      class="question-card risk-{{item.risk_level}}">
  <view wx:if="{{item.risk_level === 'critical'}}" class="critical-badge">
    âš ï¸ é«˜é£é™©
  </view>
  <text>{{item.question_text}}</text>
  <text>å¹³å‡æ’åï¼š{{item.avg_rank}}</text>
  <text>é£é™©ç­‰çº§ï¼š{{item.risk_level}}</text>
</view>
```

**WXSS æ ·å¼**:
```css
/* æƒ…æ„ŸçŠ¶æ€æ ·å¼ */
.sentiment-positive {
  background-color: #dcfce7;
  border-left: 4px solid #22c55e;
}

.sentiment-neutral {
  background-color: #f3f4f6;
  border-left: 4px solid #6b7280;
}

.sentiment-negative {
  background-color: #fee2e2;
  border-left: 4px solid #ef4444;
}

/* é£é™©ç­‰çº§æ ·å¼ */
.risk-critical {
  background-color: #fef2f2;
  border: 2px solid #ef4444;
}

.risk-warning {
  background-color: #fffbeb;
  border: 2px solid #f59e0b;
}

.risk-safe {
  background-color: #f0fdf4;
  border: 2px solid #22c55e;
}
```

---

## äº”ã€æµ‹è¯•éªŒè¯

### 5.1 æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | ç»“æœ |
|--------|---------|------|
| æµ‹è¯• 1 | æ­£å¸¸æ•°æ® (3Ã—4Ã—1) | âœ… |
| æµ‹è¯• 2 | éƒ¨åˆ†æ•°æ®ç¼ºå¤± | âœ… |
| æµ‹è¯• 3 | å…¨ç©ºæ•°æ® | âœ… |
| æµ‹è¯• 4 | æ•°æ®æ¸…æ´—éªŒè¯ | âœ… |

### 5.2 æµ‹è¯•ç»“æœ

```
============================================================
GEO å“ç‰Œæˆ˜ç•¥èšåˆå¼•æ“ (å¢å¼ºç‰ˆ) - é—­ç¯éªŒæ”¶æµ‹è¯•
============================================================

æµ‹è¯• 1: æ­£å¸¸æ•°æ®ï¼ˆ3 é—®é¢˜Ã—4 æ¨¡å‹Ã—1 ä¸»å“ç‰Œï¼‰
  Brand Health éªŒè¯:
    åˆ†æ•°ï¼š87/100
    SOV æ ‡ç­¾ï¼šé¢†å…ˆ
    é£é™©ç­‰çº§ï¼šsafe
  âœ… é€šè¿‡ï¼šæ‰€æœ‰å…³é”®æŒ‡æ ‡ç¬¦åˆé¢„æœŸ

æµ‹è¯• 2: éƒ¨åˆ†æ•°æ®ç¼ºå¤±ï¼ˆæŸäº› geo_data ä¸ºç©ºï¼‰
  Brand Health éªŒè¯:
    åˆ†æ•°ï¼š33/100
    SOV æ ‡ç­¾ï¼šè½å
    é£é™©ç­‰çº§ï¼šcritical
  âœ… é€šè¿‡ï¼šæ‰€æœ‰å…³é”®æŒ‡æ ‡ç¬¦åˆé¢„æœŸ

æµ‹è¯• 3: å…¨ç©ºæ•°æ®
  âœ… é€šè¿‡ï¼šè¿”å› nullï¼ˆç¬¦åˆé¢„æœŸï¼‰

æµ‹è¯• 4: æ•°æ®æ¸…æ´—éªŒè¯ï¼ˆç¼ºçœå€¼å¡«å……ï¼‰
  Brand Health éªŒè¯:
    åˆ†æ•°ï¼š50/100
    SOV æ ‡ç­¾ï¼šæŒå¹³
    é£é™©ç­‰çº§ï¼šwarning
  âœ… é€šè¿‡ï¼šæ‰€æœ‰å…³é”®æŒ‡æ ‡ç¬¦åˆé¢„æœŸ

============================================================
æµ‹è¯•æ€»ç»“
============================================================
æ€»æµ‹è¯•æ•°ï¼š4
é€šè¿‡ï¼š4
å¤±è´¥ï¼š0
é€šè¿‡ç‡ï¼š100.0%

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼P1 æˆ˜ç•¥èšåˆå¼•æ“å¢å¼ºç‰ˆé€»è¾‘éªŒè¯å®Œæˆã€‚
```

---

## å…­ã€æ–°å¢å¯¼å‡ºå‡½æ•°

| å‡½æ•°å | ç”¨é€” | æ‰€å±ä»»åŠ¡ |
|--------|------|---------|
| `normalizeCompetitorName(name)` | ç«å“åç§°å½’ä¸€åŒ– | ä»»åŠ¡ 2 |
| `extractCompetitorKeyword(text)` | å…³é”®è¯æå– | ä»»åŠ¡ 2 |
| `mergeCompetitorFrequencies(count)` | ç«å“é¢‘ç‡åˆå¹¶ | ä»»åŠ¡ 2 |

---

## ä¸ƒã€å½±å“èŒƒå›´ä¸å…¼å®¹æ€§

### 7.1 ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `services/reportAggregator.js` | å¢å¼º | ä¸‰å¤§ä»»åŠ¡å¢å¼º |

### 7.2 å‘åå…¼å®¹æ€§

- âœ… æ‰€æœ‰æ”¹åŠ¨éƒ½æ˜¯**å‘åå…¼å®¹**çš„
- âœ… æ–°å¢å­—æ®µéƒ½æ˜¯å¯é€‰çš„
- âœ… ä¿ç•™äº†æ—§ç‰ˆå­—æ®µï¼ˆå¦‚ `sentiment_color`ï¼‰

### 7.3 æ–°å¢å­—æ®µ

| å­—æ®µ | ä½ç½® | ç±»å‹ | è¯´æ˜ |
|------|------|------|------|
| `sentiment_status` | brand_health | string | 'positive' \| 'neutral' \| 'negative' |
| `risk_level` | brand_health | string | 'critical' \| 'warning' \| 'safe' |
| `risk_level` | diagnostic_grid[] | string | 'critical' \| 'warning' \| 'high' \| 'mid' \| 'safe' |
| `originalNames` | top_competitors[] | array | åŸå§‹åç§°åˆ—è¡¨ï¼ˆç”¨äºè°ƒè¯•ï¼‰ |

---

## å…«ã€æ€»ç»“

æœ¬æ¬¡ P1 æˆ˜ç•¥èšåˆå¼•æ“å¢å¼ºå®æ–½æˆåŠŸå®ç°äº†ä¸‰å¤§ä»»åŠ¡ï¼š

1. **ç®—æ³•é²æ£’æ€§åŠ å›º** - é›¶åˆ†æ¯ä¿æŠ¤ + æ•°æ®ç±»å‹å¼ºåˆ¶è½¬æ¢
2. **ç«å“æ‹¦æˆªç®—æ³•ä¼˜åŒ–** - æ¨¡ç³ŠåŒ¹é… + å…³é”®è¯æå–
3. **UI çŠ¶æ€æ˜ å°„å­—å…¸åŒ–** - è¯­ä¹‰åŒ–çŠ¶æ€ + é£é™©åˆ†çº§

**å¢å¼ºæ•ˆæœ**:
- âœ… é¿å… Infinity å’Œ NaN é”™è¯¯
- âœ… ç«å“åç§°å½’ä¸€åŒ–ï¼Œé¢‘ç‡ç»Ÿè®¡æ›´å‡†ç¡®
- âœ… é•¿å¥è‡ªåŠ¨æå–å…³é”®è¯ï¼Œé€‚é… WXML å±•ç¤º
- âœ… è¯­ä¹‰åŒ–çŠ¶æ€ï¼Œå‰ç«¯æ ·å¼ç»´æŠ¤æ›´ç®€å•
- âœ… é£é™©åˆ†çº§æ›´ç›´è§‚ï¼Œæ”¯æ’‘"é£é™©å¢™"å±•ç¤º

**æµ‹è¯•è¦†ç›–ç‡**: 4/4 æµ‹è¯•é€šè¿‡

**å®æ–½çŠ¶æ€**: âœ… å®Œæˆå¹¶å‡†å¤‡ä¸Šçº¿

---

**æ–‡æ¡£ç»“æŸ**
