# ã€å“ç‰Œ AI è¯Šæ–­ç³»ç»Ÿã€‘ä¸Šçº¿å‰ä¸“é¡¹æµ‹è¯•è®¡åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-22  
**æµ‹è¯•è´Ÿè´£äºº**: é¦–å¸­æµ‹è¯•å·¥ç¨‹å¸ˆ  
**ç³»ç»Ÿç‰ˆæœ¬**: v2.0  

---

## ä¸€ã€æµ‹è¯•æ¦‚è¿°

### 1.1 ç³»ç»Ÿæ¶æ„

| å±‚çº§ | æŠ€æœ¯æ ˆ | å…³é”®æ–‡ä»¶ |
|-----|-------|---------|
| **å‰ç«¯** | å¾®ä¿¡å°ç¨‹åº | pages/index/index.js (1723 è¡Œ), pages/results/results.js (2122 è¡Œ) |
| **åç«¯** | Flask + SQLite | backend_python/wechat_backend/views.py, services/*.py |
| **AI é›†æˆ** | å¤šå¹³å°é€‚é…å™¨ | backend_python/wechat_backend/ai_adapters/*.py |
| **å›¾è¡¨** | ECharts | components/ec-canvas/, utils/chartRenderer.js |

### 1.2 æ ¸å¿ƒéš¾ç‚¹

1. **å¤š AI è½®è¯¢**: 7 ä¸ª AI å¹³å°ï¼ŒNxM çŸ©é˜µæ‰§è¡Œï¼ˆé—®é¢˜æ•° Ã— æ¨¡å‹æ•°ï¼‰
2. **å¤§å®¹é‡æ•°æ®æŒä¹…åŒ–**: è¯Šæ–­ç»“æœé€šè¿‡ Storage ä¼ é€’ï¼Œé¿å… URL 2KB é™åˆ¶
3. **ECharts å¤æ‚æ¸²æŸ“**: é›·è¾¾å›¾ã€è¯äº‘å›¾ Canvas æ¸²æŸ“ï¼Œæ—¶åºæ§åˆ¶å…³é”®

### 1.3 æµ‹è¯•èŒƒå›´

| ç±»åˆ« | æµ‹è¯•é‡ç‚¹ | ä¼˜å…ˆçº§ |
|-----|---------|--------|
| æ ¸å¿ƒé“¾è·¯ | è¯Šæ–­å¯åŠ¨â†’è½®è¯¢â†’ç»“æœå±•ç¤º | P0 |
| å¼‚å¸¸å¤„ç† | 403 é”™è¯¯ã€Canvas æ¸²æŸ“å¤±è´¥ | P0 |
| æ•°æ®ä¸€è‡´æ€§ | Storage æ•°æ®å®Œæ•´æ€§ã€API æ•°æ®ä¼ è¾“ | P0 |
| æ€§èƒ½é€‚é… | é¦–å±åŠ è½½ã€CPU å ç”¨ã€å¤šè®¾å¤‡å…¼å®¹ | P1 |
| UI/UX | æ˜“ç”¨æ€§ã€ç¾è§‚åº¦ã€äº¤äº’æµç•…æ€§ | P1 |

---

## äºŒã€æ ¸å¿ƒé“¾è·¯å†’çƒŸæµ‹è¯• (Smoke Test)

### 2.1 æµ‹è¯•åœºæ™¯æ€»è§ˆ

| ç¼–å· | åœºæ™¯åç§° | ä¼˜å…ˆçº§ | é¢„è®¡è€—æ—¶ |
|-----|---------|--------|---------|
| ST-01 | æ–°ç”¨æˆ·é¦–æ¬¡è¯Šæ–­ | P0 | 10 åˆ†é’Ÿ |
| ST-02 | è€ç”¨æˆ·æ¢å¤è‰ç¨¿è¯Šæ–­ | P0 | 8 åˆ†é’Ÿ |
| ST-03 | è¯Šæ–­ä¸­æ–­åé‡æ–°è¿æ¥ | P0 | 10 åˆ†é’Ÿ |

---

### ST-01: æ–°ç”¨æˆ·é¦–æ¬¡è¯Šæ–­

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|--------|
| 1 | æ‰“å¼€å°ç¨‹åºé¦–é¡µ | index.js onLoad æ‰§è¡ŒæˆåŠŸ | console è¾“å‡º"å“ç‰Œ AI é›·è¾¾ - é¡µé¢åŠ è½½å®Œæˆ" |
| 2 | è¾“å…¥å“ç‰Œåç§°"æµ‹è¯•å“ç‰Œ" | input äº‹ä»¶è§¦å‘ï¼Œé˜²æŠ– 500ms åä¿å­˜è‰ç¨¿ | setData åè¾“å…¥æ¡†å®æ—¶æ˜¾ç¤ºï¼Œstorage ä¸­æœ‰ draft_diagnostic_input |
| 3 | é€‰æ‹© AI æ¨¡å‹ï¼ˆDeepSeekã€è±†åŒ…ï¼‰ | æ¨¡å‹é€‰ä¸­çŠ¶æ€åˆ‡æ¢ï¼Œè®¡æ•°æ›´æ–° | selectedModelCount = 2 |
| 4 | æ·»åŠ è‡ªå®šä¹‰é—®é¢˜"ä»‹ç»ä¸€ä¸‹æµ‹è¯•å“ç‰Œ" | é—®é¢˜åˆ—è¡¨æ›´æ–°ï¼Œè®¡æ•° +1 | selectedQuestionCount = 1 |
| 5 | ç‚¹å‡»"å¯åŠ¨è¯Šæ–­"æŒ‰é’® | startBrandTest æ‰§è¡Œï¼Œæ˜¾ç¤º Loading | wx.showLoading è°ƒç”¨ï¼ŒisTesting = true |
| 6 | ç­‰å¾…åç«¯å“åº” | è·å– execution_idï¼Œå¯åŠ¨è½®è¯¢ | pollTestProgress å¯åŠ¨ï¼ŒexecutionId æœ‰æ•ˆ |
| 7 | è½®è¯¢è¿›åº¦æ›´æ–° | è¿›åº¦æ¡ 0%â†’100%ï¼Œé˜¶æ®µæ–‡æœ¬å˜åŒ– | testProgress æ›´æ–°ï¼ŒprogressText å˜åŒ– |
| 8 | è¯Šæ–­å®Œæˆ | è·³è½¬åˆ° results é¡µï¼ŒStorage ä¿å­˜æ•°æ® | wx.navigateTo è°ƒç”¨ï¼Œlast_diagnostic_results å­˜åœ¨ |
| 9 | results é¡µåŠ è½½ | ä» Storage åŠ è½½æ•°æ®ï¼Œæ¸²æŸ“å›¾è¡¨ | loadingState = 'success'ï¼ŒradarChartInstance å­˜åœ¨ |
| 10 | æŸ¥çœ‹é›·è¾¾å›¾ | ECharts æ¸²æŸ“æˆåŠŸ | canvas èŠ‚ç‚¹å­˜åœ¨ï¼Œchart.setOption è°ƒç”¨ |

**é¢„æœŸè¡Œä¸º**:
- æ•´ä¸ªæµç¨‹è€—æ—¶ < 60 ç§’
- æ—  403 é”™è¯¯
- Canvas æ¸²æŸ“æ— æŠ¥é”™
- æ•°æ®å®Œæ•´å±•ç¤º

**é£é™©ç­‰çº§**: ğŸ”´ é«˜ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

---

### ST-02: è€ç”¨æˆ·æ¢å¤è‰ç¨¿è¯Šæ–­

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|--------|
| 1 | å®Œæˆä¸€æ¬¡è¯Šæ–­åå…³é—­å°ç¨‹åº | è‰ç¨¿è‡ªåŠ¨ä¿å­˜ | draft_diagnostic_input å­˜åœ¨ï¼ŒupdatedAt æ›´æ–° |
| 2 | é‡æ–°æ‰“å¼€å°ç¨‹åº | onShow è§¦å‘ï¼ŒrestoreDraft æ‰§è¡Œ | brandNameã€competitorBrandsã€customQuestions æ¢å¤ |
| 3 | æ£€æŸ¥è‰ç¨¿æœ‰æ•ˆæœŸ | 7 å¤©å†…è‰ç¨¿æœ‰æ•ˆï¼Œè¿‡æœŸæ¸…é™¤ | draftAge < 7*24*60*60*1000 |
| 4 | ä¿®æ”¹å“ç‰Œåç§° | è‰ç¨¿æ›´æ–° | draft_diagnostic_input.brandName æ›´æ–° |
| 5 | å†æ¬¡å¯åŠ¨è¯Šæ–­ | ä½¿ç”¨æ¢å¤çš„æ•°æ® | API è¯·æ±‚ä¸­åŒ…å«æ¢å¤çš„å“ç‰Œåç§° |

**é¢„æœŸè¡Œä¸º**:
- è‰ç¨¿æ¢å¤æˆåŠŸç‡ 100%
- æ•°æ®æ ¼å¼æ­£ç¡®ï¼ˆcustomQuestions æ•°ç»„æ ¼å¼ï¼‰
- è¿‡æœŸè‰ç¨¿è‡ªåŠ¨æ¸…é™¤

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­ï¼ˆç”¨æˆ·ä½“éªŒï¼‰

---

### ST-03: è¯Šæ–­ä¸­æ–­åé‡æ–°è¿æ¥

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | éªŒè¯ç‚¹ |
|-----|------|---------|--------|
| 1 | å¯åŠ¨è¯Šæ–­ï¼Œè¿›åº¦ 30% | è½®è¯¢æ­£å¸¸è¿›è¡Œ | currentStage = 'ai_fetching' |
| 2 | æ¨¡æ‹Ÿç½‘ç»œæ–­å¼€ | è½®è¯¢å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º | pollTestProgress catch æ‰§è¡Œï¼ŒprogressText = 'çŠ¶æ€è¿æ¥å¼‚å¸¸...' |
| 3 | æ¢å¤ç½‘ç»œ | è½®è¯¢è‡ªåŠ¨é‡è¯• | setInterval ç»§ç»­æ‰§è¡Œ |
| 4 | åç«¯è¿”å› 403 | è‡ªåŠ¨åˆ·æ–° Tokenï¼Œé‡è¯•è¯·æ±‚ | refreshToken è°ƒç”¨ï¼Œé‡è¯•æˆåŠŸ |
| 5 | è¯Šæ–­ç»§ç»­å®Œæˆ | è¿›åº¦ç»§ç»­æ›´æ–°åˆ° 100% | testCompleted = true |

**é¢„æœŸè¡Œä¸º**:
- ç½‘ç»œæ¢å¤åè‡ªåŠ¨é‡è¯•
- Token åˆ·æ–°æ— æ„ŸçŸ¥
- è¿›åº¦ä¸ä¸¢å¤±

**é£é™©ç­‰çº§**: ğŸ”´ é«˜ï¼ˆé²æ£’æ€§ï¼‰

---

## ä¸‰ã€å¼‚å¸¸ä¸é²æ£’æ€§æµ‹è¯•ä¸“é¡¹

### 3.1 æµ‹è¯•ç”¨ä¾‹æ€»è§ˆ

| ç¼–å· | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ | æ¨¡æ‹Ÿæ–¹æ³• |
|-----|---------|--------|---------|
| EX-01 | Token çªç„¶å¤±æ•ˆåçš„é™é»˜åˆ·æ–° | P0 | Mock 403 å“åº” |
| EX-02 | Canvas åˆå§‹åŒ–å…ˆäºæ•°æ®åˆ°è¾¾ | P0 | å»¶è¿Ÿæ•°æ®åŠ è½½ |
| EX-03 | åç«¯å“åº”ææ…¢å¯¼è‡´è½®è¯¢è¶…æ—¶ | P1 | Mock å»¶è¿Ÿå“åº” |
| EX-04 | Storage è¶…é™æ¸…ç† | P1 | å¡«æ»¡ Storage |
| EX-05 | å¤š Tab åˆ‡æ¢å¯¼è‡´çŠ¶æ€ä¸¢å¤± | P2 | æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢ |

---

### EX-01: Token çªç„¶å¤±æ•ˆåçš„é™é»˜åˆ·æ–°

**æµ‹è¯•ç›®çš„**: éªŒè¯ 403 é”™è¯¯è‡ªåŠ¨å¤„ç†æœºåˆ¶

**æµ‹è¯•æ­¥éª¤**:
1. æ­£å¸¸å¯åŠ¨è¯Šæ–­
2. Mock åç«¯è¿”å› 403 çŠ¶æ€ç 
3. éªŒè¯ request.js ä¸­çš„ Token åˆ·æ–°é€»è¾‘
4. éªŒè¯é‡è¯•è¯·æ±‚ä½¿ç”¨æ–° Token

**é¢„æœŸè¡Œä¸º**:
- æ£€æµ‹åˆ° 403 åè‡ªåŠ¨è°ƒç”¨ refreshToken
- åˆ·æ–°æˆåŠŸåä½¿ç”¨æ–° Token é‡è¯•åŸè¯·æ±‚
- ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œä¸è·³è½¬ç™»å½•é¡µ
- åˆ·æ–°é˜Ÿåˆ—ä¸­çš„è¯·æ±‚å…¨éƒ¨æˆåŠŸ

**éªŒè¯ç‚¹**:
```javascript
// request.js ä¸­çš„å¤„ç†
if (response.statusCode === 403) {
  // è‡ªåŠ¨åˆ·æ–° Token
  refreshToken().then(newToken => {
    // é‡è¯•åŸè¯·æ±‚
    request({ ...options, header: { Authorization: `Bearer ${newToken}` } })
  })
}
```

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

---

### EX-02: Canvas åˆå§‹åŒ–å…ˆäºæ•°æ®åˆ°è¾¾ï¼ˆç«äº‰æ¡ä»¶ï¼‰

**æµ‹è¯•ç›®çš„**: éªŒè¯ Canvas èŠ‚ç‚¹æœªæ‰¾åˆ°çš„é‡è¯•æœºåˆ¶

**æµ‹è¯•æ­¥éª¤**:
1. å¿«é€Ÿè¿›å…¥ results é¡µ
2. åœ¨ setData å‰æŸ¥è¯¢ Canvas èŠ‚ç‚¹
3. éªŒè¯ wx.nextTick + setTimeout å»¶è¿Ÿæ¸²æŸ“
4. éªŒè¯ 3 æ¬¡é‡è¯•æœºåˆ¶

**é¢„æœŸè¡Œä¸º**:
- ä½¿ç”¨ wx.nextTick ç¡®ä¿ DOM æ›´æ–°
- setTimeout 300ms ç¼“å†²
- èŠ‚ç‚¹æœªæ‰¾åˆ°æ—¶æœ€å¤šé‡è¯• 3 æ¬¡
- é‡è¯•å¤±è´¥åæ˜¾ç¤ºå‹å¥½æç¤º

**éªŒè¯ç‚¹**:
```javascript
// chartRenderer.js ä¸­çš„å¤„ç†
renderRadarChart(pageContext, retryCount = 0) {
  query.select('#radarCanvas').fields({ node: true }, (res) => {
    if (!res[0] || !res[0].node) {
      if (retryCount < 3) {
        setTimeout(() => renderRadarChart(pageContext, retryCount + 1), 300)
        return
      }
      // æ˜¾ç¤ºé”™è¯¯æç¤º
    }
  })
}
```

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

---

### EX-03: åç«¯å“åº”ææ…¢å¯¼è‡´è½®è¯¢è¶…æ—¶

**æµ‹è¯•ç›®çš„**: éªŒè¯è½®è¯¢è¶…æ—¶ä¿æŠ¤æœºåˆ¶

**æµ‹è¯•æ­¥éª¤**:
1. Mock åç«¯å“åº”å»¶è¿Ÿ 10 ç§’
2. å¯åŠ¨è¯Šæ–­è½®è¯¢
3. éªŒè¯ 5 åˆ†é’Ÿè¶…æ—¶ä¿æŠ¤
4. éªŒè¯æœ€å¤§è½®è¯¢æ¬¡æ•°é™åˆ¶

**é¢„æœŸè¡Œä¸º**:
- è½®è¯¢é—´éš” 2 ç§’
- 5 åˆ†é’Ÿåè‡ªåŠ¨åœæ­¢
- æ˜¾ç¤º"è¯Šæ–­è¶…æ—¶"é”™è¯¯
- å…è®¸ç”¨æˆ·æ‰‹åŠ¨é‡è¯•

**éªŒè¯ç‚¹**:
```javascript
// brandTestService.js ä¸­çš„å¤„ç†
const maxDuration = 5 * 60 * 1000 // 5 åˆ†é’Ÿè¶…æ—¶
if (Date.now() - startTime > maxDuration) {
  stop()
  onError(new Error('è¯Šæ–­è¶…æ—¶'))
  return
}
```

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### EX-04: Storage è¶…é™æ¸…ç†

**æµ‹è¯•ç›®çš„**: éªŒè¯ Storage è¶…é™æ—¶çš„å¤„ç†

**æµ‹è¯•æ­¥éª¤**:
1. å¡«æ»¡ Storageï¼ˆæ¥è¿‘ 10MB é™åˆ¶ï¼‰
2. å°è¯•ä¿å­˜è¯Šæ–­ç»“æœ
3. éªŒè¯è‡ªåŠ¨æ¸…ç†é€»è¾‘
4. éªŒè¯ä¿å­˜æˆåŠŸ

**é¢„æœŸè¡Œä¸º**:
- æ£€æµ‹åˆ° Storage è¶…é™æ—¶è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
- æ¸…ç†åé‡è¯•ä¿å­˜
- ä¿å­˜å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½æç¤º

**éªŒè¯ç‚¹**:
```javascript
// request.js ä¸­çš„å¤„ç†
if (error.errMsg.includes('maximum size limit exceeded')) {
  clearStorageRecursive()
  resolve(null)
  return
}
```

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### EX-05: å¤š Tab åˆ‡æ¢å¯¼è‡´çŠ¶æ€ä¸¢å¤±

**æµ‹è¯•ç›®çš„**: éªŒè¯é¡µé¢åˆ‡æ¢æ—¶çš„çŠ¶æ€ä¿æŒ

**æµ‹è¯•æ­¥éª¤**:
1. å¯åŠ¨è¯Šæ–­ï¼Œè¿›åº¦ 50%
2. åˆ‡æ¢åˆ°"æˆ‘çš„"é¡µé¢
3. è¿”å› index é¡µ
4. éªŒè¯è½®è¯¢ç»§ç»­æ‰§è¡Œ

**é¢„æœŸè¡Œä¸º**:
- é¡µé¢åˆ‡æ¢ä¸å½±å“è½®è¯¢
- è¿›åº¦çŠ¶æ€ä¿æŒ
- è¿”å›åè¿›åº¦æ¡ç»§ç»­æ›´æ–°

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

## å››ã€æ•°æ®ä¸€è‡´æ€§å®¡è®¡

### 4.1 æµ‹è¯•åœºæ™¯æ€»è§ˆ

| ç¼–å· | æµ‹è¯•åœºæ™¯ | æ•°æ®æµ | éªŒè¯ç‚¹ |
|-----|---------|-------|--------|
| DA-01 | Storage æ•°æ®å®Œæ•´æ€§ | API â†’ Storage â†’ Page | æ•°æ®ç»“æ„ä¸å˜ |
| DA-02 | NxM çŸ©é˜µæ•°æ®ä¼ é€’ | åç«¯ â†’ å‰ç«¯ â†’ ECharts | æ•°ç»„é•¿åº¦ä¸€è‡´ |
| DA-03 | å“ç‰Œåˆ†æ•°è®¡ç®— | results â†’ brandScores | åˆ†æ•°è®¡ç®—å‡†ç¡® |
| DA-04 | ç«äº‰åˆ†ææ•°æ® | API â†’ competitiveAnalysis | å¯¹è±¡ç»“æ„å®Œæ•´ |

---

### DA-01: Storage æ•°æ®å®Œæ•´æ€§éªŒè¯

**æµ‹è¯•ç›®çš„**: éªŒè¯ wx.setStorageSync('last_diagnostic_results') çš„æ•°æ®å®Œæ•´æ€§

**æµ‹è¯•æ­¥éª¤**:
1. è¯Šæ–­å®Œæˆåè·å–åŸå§‹æ•°æ®
2. æ£€æŸ¥ Storage ä¸­ä¿å­˜çš„æ•°æ®
3. ä» Storage åŠ è½½æ•°æ®
4. å¯¹æ¯”åŸå§‹æ•°æ®å’ŒåŠ è½½æ•°æ®

**éªŒè¯ç‚¹**:
```javascript
// åŸå§‹æ•°æ®
const originalData = {
  results: [...],           // æ•°ç»„ï¼Œé•¿åº¦ = é—®é¢˜æ•° Ã— æ¨¡å‹æ•°
  competitiveAnalysis: {...},
  brandScores: {...},
  targetBrand: 'æµ‹è¯•å“ç‰Œ',
  executionId: 'xxx',
  timestamp: 1234567890
}

// Storage æ•°æ®
const storedData = wx.getStorageSync('last_diagnostic_results')

// éªŒè¯
expect(storedData.results.length).toBe(originalData.results.length)
expect(storedData.competitiveAnalysis).toEqual(originalData.competitiveAnalysis)
expect(storedData.brandScores).toEqual(originalData.brandScores)
```

**é¢„æœŸè¡Œä¸º**:
- results æ•°ç»„é•¿åº¦ä¸€è‡´
- competitiveAnalysis å¯¹è±¡ç»“æ„å®Œæ•´
- brandScores åˆ†æ•°å‡†ç¡®
- timestamp åœ¨åˆç†èŒƒå›´å†…

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

---

### DA-02: NxM çŸ©é˜µæ•°æ®ä¼ é€’éªŒè¯

**æµ‹è¯•ç›®çš„**: éªŒè¯ NxM æ•°æ®åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸å‘ç”Ÿéé¢„æœŸå˜æ›´

**æ•°æ®æµ**:
```
åç«¯ API â†’ å‰ç«¯ Page â†’ Storage â†’ results é¡µ â†’ ECharts ç»„ä»¶
```

**éªŒè¯ç‚¹**:
```javascript
// 1. åç«¯ API è¿”å›
const apiResponse = {
  detailed_results: [
    { brand: 'å“ç‰Œ A', model: 'deepseek', question: 'é—®é¢˜ 1', score: 85 },
    { brand: 'å“ç‰Œ A', model: 'deepseek', question: 'é—®é¢˜ 2', score: 90 },
    // ... NxM ä¸ªç»“æœ
  ]
}

// 2. å‰ç«¯ Page æ¥æ”¶
const pageData = processReportData(apiResponse.detailed_results)
expect(pageData.results.length).toBe(apiResponse.detailed_results.length)

// 3. Storage ä¿å­˜
wx.setStorageSync('last_diagnostic_results', pageData)

// 4. results é¡µåŠ è½½
const loadedData = wx.getStorageSync('last_diagnostic_results')
expect(loadedData.results.length).toBe(pageData.results.length)

// 5. ECharts æ¸²æŸ“
const chartData = prepareRadarChartData(loadedData.competitiveAnalysis)
expect(chartData.length).toBeGreaterThan(0)
```

**é¢„æœŸè¡Œä¸º**:
- æ•°ç»„é•¿åº¦åœ¨æ¯æ­¥ä¼ é€’ä¸­ä¿æŒä¸€è‡´
- å¯¹è±¡å±æ€§ä¸ä¸¢å¤±
- æ•°å€¼ç±»å‹ä¸å˜ï¼ˆnumber ä¸å˜æˆ stringï¼‰

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

---

### DA-03: å“ç‰Œåˆ†æ•°è®¡ç®—éªŒè¯

**æµ‹è¯•ç›®çš„**: éªŒè¯ brandScores è®¡ç®—å‡†ç¡®æ€§

**æµ‹è¯•æ­¥éª¤**:
1. å‡†å¤‡å·²çŸ¥åˆ†æ•°çš„æµ‹è¯•ç»“æœ
2. è°ƒç”¨ extractScoreData
3. éªŒè¯è®¡ç®—ç»“æœ

**éªŒè¯ç‚¹**:
```javascript
const mockResults = [
  { brand: 'å“ç‰Œ A', score: 85 },
  { brand: 'å“ç‰Œ A', score: 90 },
  { brand: 'å“ç‰Œ A', score: 80 }
]

const brandScores = extractScoreData({ results: mockResults })

// å¹³å‡åˆ† = (85 + 90 + 80) / 3 = 85
expect(brandScores['å“ç‰Œ A'].overallScore).toBe(85)
// ç­‰çº§ = A
expect(brandScores['å“ç‰Œ A'].overallGrade).toBe('A')
```

**é¢„æœŸè¡Œä¸º**:
- å¹³å‡åˆ†è®¡ç®—å‡†ç¡®
- ç­‰çº§åˆ’åˆ†æ­£ç¡®ï¼ˆA+â‰¥90, Aâ‰¥80, Bâ‰¥70, Câ‰¥60, D<60ï¼‰
- å„ç»´åº¦åˆ†æ•°åˆç†

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### DA-04: ç«äº‰åˆ†ææ•°æ®éªŒè¯

**æµ‹è¯•ç›®çš„**: éªŒè¯ competitiveAnalysis æ•°æ®å®Œæ•´æ€§

**éªŒè¯ç‚¹**:
```javascript
const expectedStructure = {
  brandScores: {
    'å“ç‰Œ A': {
      overallScore: 85,
      overallGrade: 'A',
      overallAuthority: 80,
      overallVisibility: 90,
      overallPurity: 85,
      overallConsistency: 80
    }
  },
  firstMentionByPlatform: {
    deepseek: 0.8,
    doubao: 0.6
  },
  interceptionRisks: {
    visibility: { level: 'medium', description: '...' }
  }
}

expect(competitiveAnalysis).toMatchObject(expectedStructure)
```

**é¢„æœŸè¡Œä¸º**:
- brandScores åŒ…å«æ‰€æœ‰å“ç‰Œ
- firstMentionByPlatform æœ‰æ•°æ®
- interceptionRisks ç»“æ„å®Œæ•´

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

## äº”ã€æ€§èƒ½ä¸é€‚é…ä¸“é¡¹

### 5.1 çœŸæœºç¯å¢ƒæµ‹è¯•æ¸…å•

| ç¼–å· | è®¾å¤‡/ç³»ç»Ÿ | ä¼˜å…ˆçº§ | æµ‹è¯•é‡ç‚¹ |
|-----|----------|--------|---------|
| PE-01 | iOS 12.xï¼ˆä½ç‰ˆæœ¬ï¼‰ | P0 | å…¼å®¹æ€§ã€Canvas æ¸²æŸ“ |
| PE-02 | iOS 16.xï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰ | P0 | æ€§èƒ½åŸºå‡† |
| PE-03 | Android 10.x | P0 | å…¼å®¹æ€§ã€Storage |
| PE-04 | Android æŠ˜å å± | P1 | å±å¹•é€‚é…ã€å›¾è¡¨ç¾è§‚åº¦ |
| PE-05 | Mac å°ç¨‹åºæ¨¡æ‹Ÿå™¨ | P1 | å¼€å‘è°ƒè¯•ã€æ€§èƒ½åˆ†æ |

---

### PE-01: iOS 12.x ä½ç‰ˆæœ¬å…¼å®¹æ€§

**æµ‹è¯•ç›®çš„**: éªŒè¯ä½ç‰ˆæœ¬ iOS å…¼å®¹æ€§

**æµ‹è¯•é¡¹ç›®**:
- [ ] ES6 è¯­æ³•å…¼å®¹æ€§ï¼ˆç®­å¤´å‡½æ•°ã€async/awaitï¼‰
- [ ] Canvas API æ”¯æŒ
- [ ] Storage API æ”¯æŒ
- [ ] ç½‘ç»œè¯·æ±‚æ­£å¸¸

**é¢„æœŸè¡Œä¸º**:
- é¡µé¢æ—  JS æŠ¥é”™
- Canvas æ¸²æŸ“æ­£å¸¸
- Storage è¯»å†™æ­£å¸¸
- API è¯·æ±‚æˆåŠŸ

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

---

### PE-02: iOS 16.x æœ€æ–°ç‰ˆæœ¬

**æµ‹è¯•ç›®çš„**: å»ºç«‹æ€§èƒ½åŸºå‡†

**ç›‘æ§æŒ‡æ ‡**:
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|-------|---------|
| é¦–å±åŠ è½½æ—¶é—´ | < 2s | Performance API |
| è¯Šæ–­è½®è¯¢ CPU å ç”¨ | < 30% | å¼€å‘è€…å·¥å…· |
| å¤§å¯¹è±¡åºåˆ—åŒ–è€—æ—¶ | < 500ms | console.time |
| ECharts æ¸²æŸ“æ—¶é—´ | < 1s | performance.now() |
| å†…å­˜å ç”¨ | < 100MB | å¼€å‘è€…å·¥å…· |

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### PE-03: Android 10.x

**æµ‹è¯•ç›®çš„**: éªŒè¯ Android å…¼å®¹æ€§

**æµ‹è¯•é¡¹ç›®**:
- [ ] é¡µé¢åŠ è½½æ­£å¸¸
- [ ] Canvas æ¸²æŸ“æ­£å¸¸
- [ ] Storage è¯»å†™æ­£å¸¸
- [ ] ç½‘ç»œè¯·æ±‚æ­£å¸¸
- [ ] è¿”å›é”®å¤„ç†

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### PE-04: Android æŠ˜å å±

**æµ‹è¯•ç›®çš„**: éªŒè¯å¤§å±é€‚é…

**æµ‹è¯•é¡¹ç›®**:
- [ ] æ¨ªå±/ç«–å±åˆ‡æ¢
- [ ] å›¾è¡¨è‡ªé€‚åº”
- [ ] å¸ƒå±€ä¸å˜å½¢
- [ ] è§¦æ‘¸æ“ä½œæ­£å¸¸

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### PE-05: Mac å°ç¨‹åºæ¨¡æ‹Ÿå™¨

**æµ‹è¯•ç›®çš„**: å¼€å‘è°ƒè¯•ã€æ€§èƒ½åˆ†æ

**æµ‹è¯•é¡¹ç›®**:
- [ ] å¼€å‘è€…å·¥å…·æ€§èƒ½åˆ†æ
- [ ] ç½‘ç»œè¯·æ±‚ç›‘æ§
- [ ] Storage æ•°æ®æŸ¥çœ‹
- [ ] Console æ—¥å¿—è¾“å‡º

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### 5.2 æ€§èƒ½ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• | å‘Šè­¦é˜ˆå€¼ |
|-----|-------|---------|---------|
| é¦–å±åŠ è½½æ—¶é—´ | < 2s | Performance API | > 3s |
| è¯Šæ–­è½®è¯¢ CPU å ç”¨ | < 30% | å¼€å‘è€…å·¥å…· | > 50% |
| å¤§å¯¹è±¡åºåˆ—åŒ–è€—æ—¶ | < 500ms | console.time | > 1000ms |
| ECharts æ¸²æŸ“æ—¶é—´ | < 1s | performance.now() | > 2s |
| å†…å­˜å ç”¨ | < 100MB | å¼€å‘è€…å·¥å…· | > 200MB |
| Storage ä½¿ç”¨ç‡ | < 80% | wx.getStorageInfo | > 90% |

---

## å…­ã€UI/UX èµ°æŸ¥æ¸…å•

### 6.1 æ˜“ç”¨æ€§ CheckList

| ç¼–å· | æ£€æŸ¥é¡¹ | éªŒæ”¶æ ‡å‡† | ä¼˜å…ˆçº§ |
|-----|-------|---------|--------|
| UX-01 | æŒ‰é’®é˜²æŠ–å¤„ç† | å¿«é€Ÿç‚¹å‡»ä¸é‡å¤è§¦å‘ | P0 |
| UX-02 | é”™è¯¯ä¿¡æ¯å‹å¥½ç¨‹åº¦ | ç”¨æˆ·èƒ½ç†è§£å¹¶æ“ä½œ | P0 |
| UX-03 | Loading åŠ¨ç”»è¿è´¯æ€§ | æ— é—ªçƒã€æ— è·³è·ƒ | P1 |
| UX-04 | å›¾è¡¨ç¾è§‚åº¦ | ä¸åŒå±å¹•ä¸‹æ¸…æ™° | P1 |
| UX-05 | è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦ | è¿›å…¥é¡µé¢è‡ªåŠ¨èšç„¦ | P2 |
| UX-06 | è¡¨å•éªŒè¯æç¤º | å®æ—¶éªŒè¯ã€å³æ—¶åé¦ˆ | P2 |
| UX-07 | è¿”å›æŒ‰é’®é€»è¾‘ | è¿”å›ä¸Šä¸€é¡µè€Œéé¦–é¡µ | P2 |
| UX-08 | ç©ºçŠ¶æ€æç¤º | æœ‰å¼•å¯¼æ“ä½œ | P2 |

---

### UX-01: æŒ‰é’®é˜²æŠ–å¤„ç†

**æ£€æŸ¥ç‚¹**:
- [ ] "å¯åŠ¨è¯Šæ–­"æŒ‰é’® 500ms é˜²æŠ–
- [ ] "ä¿å­˜é…ç½®"æŒ‰é’® 500ms é˜²æŠ–
- [ ] "é‡è¯•"æŒ‰é’® 1000ms é˜²æŠ–

**éªŒæ”¶æ–¹æ³•**:
```javascript
// å¿«é€Ÿç‚¹å‡»æµ‹è¯•
for (let i = 0; i < 10; i++) {
  button.click()
}
// é¢„æœŸï¼šåªè§¦å‘ 1 æ¬¡
```

---

### UX-02: é”™è¯¯ä¿¡æ¯å‹å¥½ç¨‹åº¦

**æ£€æŸ¥ç‚¹**:
- [ ] ç½‘ç»œé”™è¯¯ â†’ "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®"
- [ ] 403 é”™è¯¯ â†’ "ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"
- [ ] 404 é”™è¯¯ â†’ "æœªæ‰¾åˆ°è¯Šæ–­ç»“æœï¼Œè¯·é‡æ–°è¯Šæ–­"
- [ ] è¶…æ—¶é”™è¯¯ â†’ "è¯Šæ–­è¶…æ—¶ï¼Œè¯·é‡è¯•"

**éªŒæ”¶æ ‡å‡†**:
- é”™è¯¯ä¿¡æ¯åŒ…å«é—®é¢˜åŸå› 
- æä¾›è§£å†³å»ºè®®
- æä¾›é‡è¯•å…¥å£

---

### UX-03: Loading åŠ¨ç”»è¿è´¯æ€§

**æ£€æŸ¥ç‚¹**:
- [ ] Loading æ˜¾ç¤ºæ— é—ªçƒ
- [ ] Loading æ¶ˆå¤±æ— è·³è·ƒ
- [ ] è¿›åº¦æ¡å¹³æ»‘è¿‡æ¸¡
- [ ] é˜¶æ®µæ–‡æœ¬å˜åŒ–æµç•…

**éªŒæ”¶æ–¹æ³•**:
- è‚‰çœ¼è§‚å¯Ÿ 10 æ¬¡ä»¥ä¸Šå¯åŠ¨æµç¨‹
- å½•å±æ…¢æ”¾æ£€æŸ¥

---

### UX-04: å›¾è¡¨ç¾è§‚åº¦

**æ£€æŸ¥ç‚¹**:
- [ ] iPhone SEï¼ˆå°å±ï¼‰å›¾è¡¨æ¸…æ™°
- [ ] iPhone 14 Pro Maxï¼ˆå¤§å±ï¼‰å›¾è¡¨æ¸…æ™°
- [ ] iPadï¼ˆå¹³æ¿ï¼‰å›¾è¡¨æ¸…æ™°
- [ ] æ·±è‰²æ¨¡å¼é€‚é…

**éªŒæ”¶æ ‡å‡†**:
- æ–‡å­—ä¸é‡å 
- é¢œè‰²å¯¹æ¯”åº¦è¶³å¤Ÿ
- å›¾ä¾‹æ¸…æ™°

---

## ä¸ƒã€å›å½’æµ‹è¯•å»ºè®®

### 7.1 é’ˆå¯¹ index.js é‡æ„çš„å›å½’æµ‹è¯•

**é‡æ„å‰**: 2276 è¡Œ  
**é‡æ„å**: 1723 è¡Œï¼ˆå‡å°‘ 24.3%ï¼‰

**å›å½’æµ‹è¯•é‡ç‚¹**:

| æ¨¡å— | é‡æ„å†…å®¹ | æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|-----|---------|---------|--------|
| onLoad | ä½¿ç”¨ initService | ST-01 æ­¥éª¤ 1-2 | P0 |
| restoreDraft | ä½¿ç”¨ draftService | ST-02 å…¨ç¨‹ | P0 |
| startBrandTest | ä½¿ç”¨ brandTestService | ST-01 æ­¥éª¤ 5-7 | P0 |
| pollTestProgress | ä½¿ç”¨ createPollingController | ST-03 å…¨ç¨‹ | P0 |
| saveCurrentInput | ä½¿ç”¨ draftService | ST-02 æ­¥éª¤ 4 | P1 |

**å›å½’æµ‹è¯•æ–¹æ³•**:
1. è¿è¡Œå…¨éƒ¨å†’çƒŸæµ‹è¯•ï¼ˆST-01 ~ ST-03ï¼‰
2. å¯¹æ¯”é‡æ„å‰åè¡Œä¸ºä¸€è‡´æ€§
3. æ£€æŸ¥ Console æ—¥å¿—æ— æ–°å¢æŠ¥é”™
4. éªŒè¯æ€§èƒ½æŒ‡æ ‡æ— å›é€€

---

### 7.2 é’ˆå¯¹ results.js çš„å›å½’æµ‹è¯•

**å½“å‰çŠ¶æ€**: 2122 è¡Œï¼ˆå¾…é‡æ„ï¼‰

**å›å½’æµ‹è¯•é‡ç‚¹**:
- onLoad æ•°æ®åŠ è½½é€»è¾‘
- å›¾è¡¨æ¸²æŸ“æ—¶åº
- é”™è¯¯å¤„ç†æœºåˆ¶

**å›å½’æµ‹è¯•æ–¹æ³•**:
1. è¿è¡Œ EX-02ï¼ˆCanvas ç«äº‰æ¡ä»¶æµ‹è¯•ï¼‰
2. è¿è¡Œ DA-01ï¼ˆStorage æ•°æ®å®Œæ•´æ€§æµ‹è¯•ï¼‰
3. è¿è¡Œ PE-02ï¼ˆæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼‰

---

### 7.3 è‡ªåŠ¨åŒ–æµ‹è¯•å»ºè®®

**ä¼˜å…ˆçº§æ’åº**:
1. **API å±‚ Unit Test**ï¼ˆåç«¯ï¼‰
   - ç¡®ä¿ API 200 OK
   - Header æ ¡éªŒé€šè¿‡
   - å“åº”æ ¼å¼æ­£ç¡®

2. **Service å±‚ Unit Test**ï¼ˆå‰ç«¯ï¼‰
   - dataProcessorService æµ‹è¯•ï¼ˆå·²æœ‰ 42 ç”¨ä¾‹ï¼‰
   - brandTestService æµ‹è¯•ï¼ˆå·²æœ‰ 16 ç”¨ä¾‹ï¼‰

3. **é¡µé¢å±‚ Integration Test**ï¼ˆå‰ç«¯ï¼‰
   - index é¡µé¢äº¤äº’æµ‹è¯•ï¼ˆå·²æœ‰ 9 ç”¨ä¾‹ï¼‰
   - results é¡µé¢æ¸²æŸ“æµ‹è¯•ï¼ˆå·²æœ‰ 10 ç”¨ä¾‹ï¼‰

4. **E2E Test**ï¼ˆå…¨é“¾è·¯ï¼‰
   - ä½¿ç”¨å°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
   - æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ

---

## å…«ã€æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### 8.1 æµ‹è¯•é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | æ—¶é—´ | æµ‹è¯•ç±»å‹ | è´Ÿè´£äºº |
|-----|------|---------|--------|
| **é˜¶æ®µ 1** | ç¬¬ 1 å‘¨ | æ ¸å¿ƒé“¾è·¯å†’çƒŸæµ‹è¯• | æµ‹è¯•ç»„ A |
| **é˜¶æ®µ 2** | ç¬¬ 2 å‘¨ | å¼‚å¸¸ä¸é²æ£’æ€§æµ‹è¯• | æµ‹è¯•ç»„ B |
| **é˜¶æ®µ 3** | ç¬¬ 3 å‘¨ | æ•°æ®ä¸€è‡´æ€§å®¡è®¡ | æµ‹è¯•ç»„ A |
| **é˜¶æ®µ 4** | ç¬¬ 4 å‘¨ | æ€§èƒ½ä¸é€‚é…æµ‹è¯• | æµ‹è¯•ç»„ B |
| **é˜¶æ®µ 5** | ç¬¬ 5 å‘¨ | UI/UX èµ°æŸ¥ | å…¨å‘˜ |

### 8.2 æµ‹è¯•èµ„æºéœ€æ±‚

| èµ„æº | æ•°é‡ | ç”¨é€” |
|-----|------|------|
| iOS æµ‹è¯•æœº | 3 å° | iOS 12.xã€14.xã€16.x |
| Android æµ‹è¯•æœº | 3 å° | Android 10.xã€12.xã€æŠ˜å å± |
| Mac æ¨¡æ‹Ÿå™¨ | 1 å¥— | å¼€å‘è°ƒè¯• |
| ç½‘ç»œæ¨¡æ‹Ÿå·¥å…· | 1 å¥— | å¼±ç½‘ã€æ–­ç½‘æµ‹è¯• |
| API Mock å·¥å…· | 1 å¥— | Mock æ•°æ®æµ‹è¯• |

### 8.3 æµ‹è¯•é€šè¿‡æ ‡å‡†

| ç±»åˆ« | é€šè¿‡ç‡è¦æ±‚ | é˜»å¡ Bug |
|-----|----------|---------|
| æ ¸å¿ƒé“¾è·¯ | 100% | 0 |
| å¼‚å¸¸å¤„ç† | 100% | 0 |
| æ•°æ®ä¸€è‡´æ€§ | 100% | 0 |
| æ€§èƒ½é€‚é… | â‰¥95% | â‰¤1 |
| UI/UX | â‰¥90% | â‰¤2 |

---

## ä¹ã€é™„å½•

### 9.1 æµ‹è¯•ç”¨ä¾‹ç¼–å·è§„åˆ™

```
[ç±»åˆ«]-[åºå·]
ä¾‹ï¼šST-01ï¼ˆå†’çƒŸæµ‹è¯• 01ï¼‰ã€EX-02ï¼ˆå¼‚å¸¸æµ‹è¯• 02ï¼‰
```

### 9.2 Bug ä¼˜å…ˆçº§å®šä¹‰

| ä¼˜å…ˆçº§ | å®šä¹‰ | å“åº”æ—¶é—´ |
|-------|------|---------|
| P0 | é˜»å¡ä¸Šçº¿ | 24 å°æ—¶å†… |
| P1 | ä¸¥é‡å½±å“ | 3 å¤©å†… |
| P2 | ä¸€èˆ¬é—®é¢˜ | 1 å‘¨å†… |
| P3 | è½»å¾®é—®é¢˜ | åç»­ç‰ˆæœ¬ |

### 9.3 æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# æµ‹è¯•æŠ¥å‘Š - [æµ‹è¯•é˜¶æ®µ]

**æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
**æµ‹è¯•äººå‘˜**: XXX
**æµ‹è¯•ç”¨ä¾‹**: XX ä¸ª
**é€šè¿‡**: XX ä¸ª
**å¤±è´¥**: XX ä¸ª
**é˜»å¡ Bug**: XX ä¸ª

## é—®é¢˜æ±‡æ€»
| ç¼–å· | æè¿° | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|-----|------|--------|------|
| BUG-001 | ... | P0 | å¾…ä¿®å¤ |

## ç»“è®º
[é€šè¿‡/ä¸é€šè¿‡]ï¼Œå»ºè®® [ä¸Šçº¿/ä¿®å¤åå¤æµ‹]
```

---

**æ–‡æ¡£å®¡æ‰¹**:

| è§’è‰² | å§“å | æ—¥æœŸ | æ„è§ |
|-----|------|------|------|
| é¦–å¸­æµ‹è¯•å·¥ç¨‹å¸ˆ | | 2026-02-22 | å·²å®¡æ‰¹ |
| æŠ€æœ¯è´Ÿè´£äºº | | | |
| äº§å“ç»ç† | | | |

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**:

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹äºº | ä¿®æ”¹å†…å®¹ |
|-----|------|--------|---------|
| v1.0 | 2026-02-22 | AI æµ‹è¯•å·¥ç¨‹å¸ˆ | åˆå§‹ç‰ˆæœ¬ |
