# è¯Šæ–­æµ‹è¯•è¿è¡Œç»“æœåˆ†ææŠ¥å‘Š

**æŠ¥å‘Šç¼–å·**: TEST-RUN-ANALYSIS-2026-0222-001  
**åˆ†ææ—¥æœŸ**: 2026-02-22 12:00:00  
**åˆ†æå·¥ç¨‹å¸ˆ**: AI Assistant  
**æµ‹è¯• ID**: 6 (execution_id: 2d2618bb-98ef-49e9-a...)

---

## ğŸ“Š æµ‹è¯•ç»“æœæ€»è§ˆ

| æŒ‡æ ‡ | å€¼ | çŠ¶æ€ |
|------|-----|------|
| å“ç‰Œ | åä¸º | âœ… |
| æ€»åˆ† | **94 åˆ†** | âœ… çœŸå®åˆ†æ•° |
| ç­‰çº§ | A | âœ… |
| æµ‹è¯•æ•° | 4 | âœ… |
| æˆåŠŸç‡ | 100% (4/4) | âœ… |
| æµ‹è¯•æ—¥æœŸ | 2026-02-21 21:51:53 | âœ… |

---

## âœ… ç¬¦åˆéœ€æ±‚çš„éƒ¨åˆ†

### 1. æ ¸å¿ƒè¯„åˆ†åŠŸèƒ½ âœ…

```
overall_score: 94.0 (é 0 åˆ†ï¼)
brand_scores:
  åä¸º:
    overallScore: 94
    overallGrade: A
    overallAuthority: 100.0
```

**éªŒè¯**:
- âœ… åˆ†æ•°ä¸å†æ˜¯ç¡¬ç¼–ç çš„ 0
- âœ… ä½¿ç”¨äº† ScoringEngine è®¡ç®—
- âœ… ç­‰çº§æ­£ç¡®æ˜ å°„ (94 åˆ† â†’ A çº§)

### 2. è¯­ä¹‰åç§»åˆ†æ âœ…

```
semantic_drift_data:
  driftScore: 100
  driftSeverity: high
  missingKeywords: 9 ä¸ª
```

**éªŒè¯**:
- âœ… è¯­ä¹‰åç§»æ•°æ®å·²ç”Ÿæˆ
- âœ… åç§»åˆ†æ•°è®¡ç®—æ­£ç¡®
- âœ… ä¸¥é‡æ€§æ ‡è®°æ­£ç¡®

### 3. ä¼˜åŒ–å»ºè®®ç”Ÿæˆ âœ…

```
recommendation_data:
  totalCount: 2 æ¡
  highPriorityCount: 2
  mediumPriorityCount: 0
  lowPriorityCount: 0
```

**éªŒè¯**:
- âœ… ä¼˜åŒ–å»ºè®®å·²ç”Ÿæˆ
- âœ… ä¼˜å…ˆçº§ç»Ÿè®¡æ­£ç¡®

### 4. å“ç‰Œåˆ†æ•°è¯¦æƒ… âœ…

```
brand_scores.åä¸º:
  overallScore: 94
  overallGrade: A
  overallAuthority: 100.0
```

**éªŒè¯**:
- âœ… å“ç‰Œåˆ†æ•°å®Œæ•´
- âœ… ç»´åº¦åˆ†æ•°å­˜åœ¨

---

## âŒ ä¸ç¬¦åˆéœ€æ±‚çš„éƒ¨åˆ†

### é—®é¢˜ 1: negative_sources ç¼ºå¤± âŒ

**ç°è±¡**:
```
âœ… æ–°å¢å­—æ®µæ£€æŸ¥:
  negative_sources: âŒ ç¼ºå¤±
```

**æ ¹å› åˆ†æ**:
1. AI å“åº”çš„ `geo_data.cited_sources` ä¸ºç©ºï¼ˆ0 ä¸ªï¼‰
2. è´Ÿé¢ä¿¡æºæå–é€»è¾‘ä¾èµ– `cited_sources`
3. å½“ `cited_sources` ä¸ºç©ºæ—¶ï¼Œæ— æ³•æå–è´Ÿé¢ä¿¡æº

**è¯æ®**:
```
ç»“æœ 1:
  geo_data:
    rank: 1
    sentiment: 0.6
    cited_sources: 0 ä¸ª  â† ç©º

ç»“æœ 2:
  geo_data:
    rank: 1
    sentiment: 1.0
    cited_sources: 0 ä¸ª  â† ç©º
```

**å½±å“**:
- ç»“æœé¡µæ— æ³•å±•ç¤ºè´Ÿé¢ä¿¡æºåˆ—è¡¨
- ç”¨æˆ·æ— æ³•çœ‹åˆ°éœ€è¦å¤„ç†çš„è´Ÿé¢ä¿¡æº
- P1 çº§åŠŸèƒ½ç¼ºå¤±

**ä¿®å¤å»ºè®®**:
```python
# åœ¨ nxm_execution_engine.py ä¸­
# å½“ cited_sources ä¸ºç©ºæ—¶ï¼Œç”ŸæˆåŸºäºåˆ†æç»“æœçš„è´Ÿé¢ä¿¡æº

if len(negative_sources) == 0:
    # åŸºäºä½åˆ†æ’åç”Ÿæˆè´Ÿé¢ä¿¡æº
    for result in all_results:
        geo = result.get('geo_data', {})
        if geo.get('rank', 10) > 5 or geo.get('sentiment', 0) < 0:
            negative_sources.append({
                'source_name': f'AI åˆ†æ - {result.get("model", "Unknown")}',
                'source_url': 'N/A',
                'content_summary': f'AI å›ç­”ä¸­æƒ…æ„Ÿåè´Ÿé¢ (sentiment={geo.get("sentiment")})',
                'sentiment_score': geo.get('sentiment', 0),
                'severity': 'medium' if geo.get('sentiment', 0) < 0 else 'low',
                'from_ai_analysis': True
            })
```

---

### é—®é¢˜ 2: cited_sources ä¸ºç©º âŒ

**ç°è±¡**: æ‰€æœ‰ AI å“åº”çš„ `cited_sources` éƒ½ä¸º 0 ä¸ª

**æ ¹å› åˆ†æ**:
1. AI å¹³å°è¿”å›çš„å›ç­”ä¸­å¯èƒ½ä¸åŒ…å«æ˜ç¡®çš„ URL å¼•ç”¨
2. geo_parser æœªèƒ½ä» AI å“åº”æ–‡æœ¬ä¸­æå–å‡º URL
3. æˆ–è€… AI æç¤ºè¯æœªè¦æ±‚ AI æä¾›å¼•ç”¨æ¥æº

**å½±å“**:
- æ— æ³•ä» AI å“åº”ä¸­æå–çœŸå®è´Ÿé¢ä¿¡æº
- ä¿¡æºæƒ…æŠ¥åŠŸèƒ½å—é™

**ä¿®å¤å»ºè®®**:

#### æ–¹æ¡ˆ A: ä¼˜åŒ– AI æç¤ºè¯
```python
# åœ¨ GEO_PROMPT_TEMPLATE ä¸­æ·»åŠ 
"""
é‡è¦ï¼šè¯·åœ¨å›ç­”ä¸­å¼•ç”¨å…·ä½“çš„ä¿¡æ¯æ¥æºï¼ŒåŒ…æ‹¬ï¼š
- ç½‘ç«™ URL
- æ¥æºåç§°ï¼ˆå¦‚çŸ¥ä¹ã€ç™¾åº¦ç™¾ç§‘ç­‰ï¼‰
- ä¿¡æ¯æ¥æºçš„æ€åº¦ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰

è¯·åœ¨ JSON è¾“å‡ºä¸­åŒ…å« cited_sources å­—æ®µï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
"geo_analysis": {
  "cited_sources": [
    {"url": "https://...", "site_name": "...", "attitude": "positive/negative/neutral"}
  ]
}
"""
```

#### æ–¹æ¡ˆ B: ä» AI å“åº”æ–‡æœ¬ä¸­æå– URL
```python
# åœ¨ geo_parser ä¸­æ·»åŠ  URL æå–é€»è¾‘
import re

def extract_urls_from_text(text):
    url_pattern = r'https?://[^\s<>"{}|\\^`\[\]]+'
    urls = re.findall(url_pattern, text)
    return urls
```

#### æ–¹æ¡ˆ C: é™çº§ç­–ç•¥
```python
# å½“ cited_sources ä¸ºç©ºæ—¶ï¼Œä½¿ç”¨æ¨¡å‹åç§°ä½œä¸ºä¿¡æº
if not geo.get('cited_sources'):
    negative_sources.append({
        'source_name': f'{result.get("model", "Unknown")} AI åˆ†æ',
        'source_type': 'ai_analysis',
        'content_summary': 'åŸºäº AI å›ç­”çš„æƒ…æ„Ÿåˆ†æ',
        'sentiment_score': geo.get('sentiment', 0),
        'from_ai_analysis': True
    })
```

---

### é—®é¢˜ 3: æ—¥å¿—è®°å½•ä¸è¶³ âš ï¸

**ç°è±¡**:
```bash
# æœç´¢è´Ÿé¢ä¿¡æºç›¸å…³æ—¥å¿—
tail -1000 logs/app.log | grep -E "negative|Negative|è´Ÿé¢"
# è¾“å‡ºï¼š(empty)

# æœç´¢ execution_id ç›¸å…³æ—¥å¿—
tail -1000 logs/app.log | grep "2d2618bb"
# è¾“å‡ºï¼š(empty)
```

**é—®é¢˜**:
- ç¼ºå°‘å…³é”®ä¸šåŠ¡é€»è¾‘çš„æ—¥å¿—è®°å½•
- æ— æ³•è¿½è¸ªè´Ÿé¢ä¿¡æºç”Ÿæˆè¿‡ç¨‹
- æ— æ³•è¿½æº¯ç‰¹å®š execution_id çš„å®Œæ•´å¤„ç†æµç¨‹

**å½±å“**:
- é—®é¢˜æ’æŸ¥å›°éš¾
- æ— æ³•ç›‘æ§åŠŸèƒ½æ‰§è¡Œæƒ…å†µ
- æ— æ³•ç»Ÿè®¡åŠŸèƒ½ä½¿ç”¨ç‡

**ä¿®å¤å»ºè®®**:

#### æ·»åŠ å…³é”®æ—¥å¿—ç‚¹

```python
# 1. åœ¨è´Ÿé¢ä¿¡æºç”Ÿæˆå¤„æ·»åŠ æ—¥å¿—
api_logger.info(f"[NegativeSources] Generated {len(negative_sources)} sources for {main_brand}")
for ns in negative_sources:
    api_logger.debug(f"  - {ns['source_name']}: {ns.get('severity', 'N/A')}")

# 2. åœ¨è¯­ä¹‰åç§»åˆ†æå¤„æ·»åŠ æ—¥å¿—
api_logger.info(f"[SemanticDrift] {main_brand}: drift_score={drift_score}, severity={drift_severity}")

# 3. åœ¨ä¼˜åŒ–å»ºè®®ç”Ÿæˆå¤„æ·»åŠ æ—¥å¿—
api_logger.info(f"[Recommendations] Generated {len(recommendations)} recommendations for {main_brand}")

# 4. åœ¨ä¿å­˜æ•°æ®åº“å‰æ·»åŠ è¯¦ç»†æ—¥å¿—
api_logger.info(f"[Database] Saving test record for {execution_id}:")
api_logger.info(f"  - overall_score: {overall_score}")
api_logger.info(f"  - brand_scores: {list(brand_scores.keys())}")
api_logger.info(f"  - negative_sources: {len(negative_sources)}")
api_logger.info(f"  - semantic_drift_data: drift_score={semantic_drift_data.get('driftScore')}")
api_logger.info(f"  - recommendation_data: {len(recommendation_data.get('recommendations', []))} recommendations")
```

#### æ·»åŠ ç»“æ„åŒ–æ—¥å¿—

```python
# ä½¿ç”¨ JSON æ ¼å¼è®°å½•å…³é”®äº‹ä»¶
api_logger.info(json.dumps({
    'event': 'test_completed',
    'execution_id': execution_id,
    'brand': main_brand,
    'overall_score': overall_score,
    'metrics': {
        'negative_sources_count': len(negative_sources),
        'semantic_drift_score': semantic_drift_data.get('driftScore'),
        'recommendations_count': len(recommendation_data.get('recommendations', []))
    }
}))
```

---

## ğŸ“‹ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

### æ•°æ®åº“å­—æ®µ

| å­—æ®µ | é¢„æœŸ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| overall_score | > 0 | 94.0 | âœ… |
| brand_scores | å­˜åœ¨ | å­˜åœ¨ | âœ… |
| competitive_analysis | å­˜åœ¨ | å­˜åœ¨ | âœ… |
| negative_sources | å­˜åœ¨ | âŒ ç¼ºå¤± | âŒ |
| semantic_drift_data | å­˜åœ¨ | å­˜åœ¨ | âœ… |
| semantic_contrast_data | å­˜åœ¨ | å­˜åœ¨ | âœ… |
| recommendation_data | å­˜åœ¨ | å­˜åœ¨ | âœ… |

### detailed_results å­—æ®µ

| å­—æ®µ | é¢„æœŸ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| brand | å“ç‰Œå | åä¸º | âœ… |
| model | æ¨¡å‹å | DeepSeek/è±†åŒ… | âœ… |
| status | success/failed | success | âœ… |
| geo_data.rank | æ•°å­— | 1 | âœ… |
| geo_data.sentiment | -1~1 | 0.6/1.0 | âœ… |
| geo_data.cited_sources | åˆ—è¡¨ | âŒ ç©ºåˆ—è¡¨ | âŒ |

---

## ğŸ¯ åŠŸèƒ½éªŒè¯æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | é¢„æœŸ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| è¯„åˆ†è®¡ç®— | é 0 åˆ†æ•° | 94 åˆ† | âœ… |
| å“ç‰Œåˆ†æ•° | å®Œæ•´ç»´åº¦ | å®Œæ•´ | âœ… |
| ç«å“å¯¹æ¯” | å®Œæ•´æ•°æ® | å®Œæ•´ | âœ… |
| è´Ÿé¢ä¿¡æº | ä» AI æå– | âŒ ç¼ºå¤± | âŒ |
| è¯­ä¹‰åç§» | å®Œæ•´åˆ†æ | å®Œæ•´ | âœ… |
| ä¼˜åŒ–å»ºè®® | AI ç”Ÿæˆ | 2 æ¡ | âœ… |

### æ•°æ®æµ

| ç¯èŠ‚ | é¢„æœŸ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| AI å“åº” | åŒ…å« cited_sources | âŒ ç©º | âŒ |
| åç«¯å¤„ç† | ç”Ÿæˆæ‰€æœ‰åˆ†ææ•°æ® | å¤§éƒ¨åˆ†ç”Ÿæˆ | âš ï¸ |
| æ•°æ®åº“ä¿å­˜ | ä¿å­˜æ‰€æœ‰å­—æ®µ | negative_sources ç¼ºå¤± | âŒ |
| å‰ç«¯å±•ç¤º | å±•ç¤ºæ‰€æœ‰æ•°æ® | å¾…éªŒè¯ | â³ |

---

## ğŸ“Š æ—¥å¿—ä¼˜åŒ–å»ºè®®

### å½“å‰æ—¥å¿—ç¼ºå¤±

| æ—¥å¿—ç±»å‹ | ç¼ºå¤±å†…å®¹ | ä¼˜å…ˆçº§ |
|----------|----------|--------|
| ä¸šåŠ¡æ—¥å¿— | è´Ÿé¢ä¿¡æºç”Ÿæˆè¿‡ç¨‹ | P0 |
| ä¸šåŠ¡æ—¥å¿— | è¯­ä¹‰åç§»åˆ†æç»“æœ | P1 |
| ä¸šåŠ¡æ—¥å¿— | ä¼˜åŒ–å»ºè®®ç”Ÿæˆè¯¦æƒ… | P1 |
| è¿½è¸ªæ—¥å¿— | execution_id å…¨é“¾è·¯è¿½è¸ª | P0 |
| æ€§èƒ½æ—¥å¿— | å„åˆ†ææ¨¡å—è€—æ—¶ | P2 |
| é”™è¯¯æ—¥å¿— | cited_sources ä¸ºç©ºè­¦å‘Š | P1 |

### å»ºè®®æ·»åŠ çš„æ—¥å¿—ç‚¹

```python
# 1. è¯Šæ–­å¼€å§‹
api_logger.info(f"[Diagnosis] Starting diagnosis for {main_brand}")
api_logger.info(f"  - Execution ID: {execution_id}")
api_logger.info(f"  - Models: {[m['name'] for m in selected_models]}")
api_logger.info(f"  - Questions: {len(raw_questions)}")

# 2. AI è°ƒç”¨å®Œæˆ
api_logger.info(f"[AI] Completed {len(all_results)} AI calls")
api_logger.info(f"  - Success: {sum(1 for r in all_results if r.get('status') == 'success')}")
api_logger.info(f"  - Failed: {sum(1 for r in all_results if r.get('status') == 'failed')}")

# 3. è¯„åˆ†è®¡ç®—å®Œæˆ
api_logger.info(f"[Scoring] Calculated scores for {len(brand_scores)} brands")
for brand, scores in brand_scores.items():
    api_logger.info(f"  - {brand}: {scores.get('overallScore')} ({scores.get('overallGrade')})")

# 4. è´Ÿé¢ä¿¡æºç”Ÿæˆ
api_logger.info(f"[NegativeSources] Generated {len(negative_sources)} sources")
if len(negative_sources) == 0:
    api_logger.warning(f"[NegativeSources] No negative sources generated for {main_brand}")

# 5. è¯­ä¹‰åç§»åˆ†æ
api_logger.info(f"[SemanticDrift] {main_brand}: score={semantic_drift_data.get('driftScore')}, severity={semantic_drift_data.get('driftSeverity')}")

# 6. ä¼˜åŒ–å»ºè®®ç”Ÿæˆ
api_logger.info(f"[Recommendations] Generated {len(recommendation_data.get('recommendations', []))} recommendations")

# 7. æ•°æ®åº“ä¿å­˜
api_logger.info(f"[Database] Saving test record: execution_id={execution_id[:20]}..., score={overall_score}")

# 8. è¯Šæ–­å®Œæˆ
api_logger.info(f"[Diagnosis] Completed diagnosis for {main_brand} in {time.time() - start_time:.2f}s")
```

---

## ğŸ“ˆ æ”¹è¿›ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤

1. **æ·»åŠ è´Ÿé¢ä¿¡æºé™çº§ç”Ÿæˆé€»è¾‘**
   - å½“ cited_sources ä¸ºç©ºæ—¶ï¼ŒåŸºäº AI åˆ†æç”Ÿæˆ
   - é¢„è®¡å·¥æ—¶ï¼š30 åˆ†é’Ÿ

2. **æ·»åŠ å…³é”®ä¸šåŠ¡æ—¥å¿—**
   - è´Ÿé¢ä¿¡æºã€è¯­ä¹‰åç§»ã€ä¼˜åŒ–å»ºè®®ç”Ÿæˆæ—¥å¿—
   - execution_id å…¨é“¾è·¯è¿½è¸ª
   - é¢„è®¡å·¥æ—¶ï¼š1 å°æ—¶

### P1 - è¿‘æœŸä¼˜åŒ–

3. **ä¼˜åŒ– AI æç¤ºè¯**
   - è¦æ±‚ AI æä¾›å¼•ç”¨æ¥æº
   - é¢„è®¡å·¥æ—¶ï¼š30 åˆ†é’Ÿ

4. **æ·»åŠ  URL æå–åŠŸèƒ½**
   - ä» AI å“åº”æ–‡æœ¬ä¸­æå– URL
   - é¢„è®¡å·¥æ—¶ï¼š1 å°æ—¶

### P2 - é•¿æœŸæ”¹è¿›

5. **ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ**
   - JSON æ ¼å¼è®°å½•å…³é”®äº‹ä»¶
   - æ—¥å¿—æŸ¥è¯¢å’Œåˆ†æ
   - é¢„è®¡å·¥æ—¶ï¼š4 å°æ—¶

---

## âœ… æ€»ç»“

### ç¬¦åˆéœ€æ±‚çš„éƒ¨åˆ† (70%)

- âœ… æ ¸å¿ƒè¯„åˆ†åŠŸèƒ½æ­£å¸¸ï¼ˆ94 åˆ†ï¼Œé 0 åˆ†ï¼‰
- âœ… å“ç‰Œåˆ†æ•°å®Œæ•´
- âœ… è¯­ä¹‰åç§»åˆ†ææ­£å¸¸
- âœ… ä¼˜åŒ–å»ºè®®ç”Ÿæˆæ­£å¸¸
- âœ… ç«å“å¯¹æ¯”æ•°æ®å®Œæ•´

### ä¸ç¬¦åˆéœ€æ±‚çš„éƒ¨åˆ† (30%)

- âŒ negative_sources ç¼ºå¤±
- âŒ cited_sources ä¸ºç©º
- âš ï¸ æ—¥å¿—è®°å½•ä¸è¶³

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³ä¿®å¤**: æ·»åŠ è´Ÿé¢ä¿¡æºé™çº§ç”Ÿæˆé€»è¾‘
2. **æ·»åŠ æ—¥å¿—**: è®°å½•å…³é”®ä¸šåŠ¡é€»è¾‘
3. **ä¼˜åŒ– AI æç¤ºè¯**: è¦æ±‚ AI æä¾›å¼•ç”¨æ¥æº
4. **å‰ç«¯éªŒè¯**: åœ¨å°ç¨‹åºä¸­éªŒè¯ç»“æœé¡µå±•ç¤º

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-22 12:00:00  
**åˆ†æç»“è®º**: æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸ï¼Œè´Ÿé¢ä¿¡æºåŠŸèƒ½éœ€ä¿®å¤  
**ä¼˜å…ˆçº§**: P0 - ç«‹å³ä¿®å¤è´Ÿé¢ä¿¡æºç”Ÿæˆé€»è¾‘

---

*è¯Šæ–­æµ‹è¯•è¿è¡Œç»“æœåˆ†ææŠ¥å‘Šï¼ŒåŸºäºæ•°æ®åº“è®°å½•å’Œæ—¥å¿—åˆ†æç”Ÿæˆ*
