# 小程序代码更新操作指南

**问题**: 代码已修改，但小程序仍报错

**根因**: 小程序开发者工具使用了缓存的旧代码

---

## ✅ 解决步骤

### 步骤 1: 清除小程序缓存

1. 打开微信开发者工具
2. 点击菜单栏 **工具** → **清除缓存**
3. 选择 **清除全部缓存**
4. 等待清除完成

### 步骤 2: 重新编译

1. 点击工具栏的 **编译** 按钮（或按 `Cmd/Ctrl + B`）
2. 等待编译完成
3. 观察控制台是否有错误

### 步骤 3: 验证修复

1. 点击"开始诊断"按钮
2. 观察控制台日志：
   - 应该看到"返回数据：{...}"
   - 不应该看到"Cannot read property 'stage' of undefined"
3. 观察页面：
   - 应该看到进度条从 0% 到 100%
   - 应该看到进度文本更新

---

## 🔍 验证代码已更新

在开发者工具中：
1. 打开 **调试器** → **Sources** 标签
2. 找到 `pages/index/index.js`
3. 搜索 `parseTaskStatus`
4. 确认代码是：
   ```javascript
   const parsedStatus = parseTaskStatus(res);  // ✅ 正确
   ```
   而不是：
   ```javascript
   const parsedStatus = parseTaskStatus(res.data);  // ❌ 错误
   ```

---

## ⚠️ 常见问题

### 问题 1: 清除缓存后仍然报错

**解决**:
1. 关闭微信开发者工具
2. 重新打开
3. 重新编译

### 问题 2: 代码没有同步

**解决**:
1. 检查 Git 状态：`git status`
2. 确认代码已修改：`git diff pages/index/index.js`
3. 如果有未提交的修改，先提交

### 问题 3: 真机调试

**注意**: 真机调试需要：
1. 在开发者工具中点击 **预览**
2. 用手机微信扫码
3. 手机上会加载最新代码

---

## 📊 预期效果

修复后应该看到：
- ✅ 进度条正常显示（0% → 100%）
- ✅ 进度文本正常更新
- ✅ 无"Cannot read property 'stage' of undefined"错误
- ✅ 诊断完成后跳转到结果页
- ✅ 结果页显示真实分数（94 分）

---

*小程序代码更新操作指南，清除缓存后重新编译即可生效*
