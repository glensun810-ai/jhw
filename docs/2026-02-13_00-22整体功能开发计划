你好！作为你的首席架构师，我已为你准备好了针对 Sprint 1 至 Sprint 4 的完整 AI 下达指令集。这些指令经过深度优化，确保 AI Coding 工具在理解业务逻辑的同时，严格锁定你在根目录下创建的 API_Spec_v2.0.json 契约。

你可以根据开发进度，依次复制并发送以下指令。

🟢 模块一：基础设施升维——异步状态机与模型重构
适用场景：重构数据库、建立分阶段进度反馈机制。

契约守护：在开始之前，请严格遵守根目录下 API_Spec_v2.0.json 的接口规范。

任务指令：

数据库重构：请修改 models.py 中的 BrandTestResult 模型，确保其 detailed_results 字段能够完整映射契约中 DeepIntelligenceResult 的嵌套结构（包含露出分析、信源情报、证据链）。

异步状态流实现：重构后端异步任务逻辑（如 tasks.py）。定义状态常量：init, ai_fetching, ranking_analysis, source_tracing, completed。在执行过程中，通过更新函数实时上报当前 stage 和 progress 百分比。

接口适配：重写 GET /test/status/{task_id} 接口，确保返回字段与契约完全一致。

先测试后集成：请先为任务状态更新逻辑编写单元测试（Unit Test），模拟任务从初始化到完成的各个阶段转换，确保状态流转无误。

🔵 模块二：战场排位实现——物理排位解析引擎
适用场景：实现核心算法，从 AI 回复中提取排名、篇幅、拦截者。

契约守护：在开始之前，请严格遵守根目录下 API_Spec_v2.0.json 的接口规范。

任务指令：

算法核心：编写 RankAnalyzer 类。输入为 AI 原始回复文本，输出需符合 exposure_analysis 结构。

逻辑要求：

识别 brand_list 中各品牌首次出现的字符索引，生成 ranking_list。

统计各品牌相关描述的字符长度，计算 word_count 及其在全文的 sov_share（篇幅占比）。

拦截者识别：自动发现回复中出现但不属于监控名单的专有名词，填入 unlisted_competitors。

先测试后集成：请为 RankAnalyzer 编写 Unit Test。测试用例需涵盖：多个品牌重叠出现、品牌名包含在其他词汇中、没有任何监控品牌出现等极端文本情况。

🟡 模块三：情报归因实现——信源穿透与引用聚合
适用场景：实现 URL 提取、引用排行、负面语料证据链关联。

契约守护：在开始之前，请严格遵守根目录下 API_Spec_v2.0.json 的接口规范。

任务指令：

信源聚合：实现 SourceAggregator 模块。从 AI 接口返回的 citations 字段及回复正文中正则提取所有 URL。

权重排行：对 URL 进行去重，统计其在多次提问中的出现频次，生成 source_pool 及 citation_rank。

证据链关联：当 AI Judge 判定某段话情感得分较低时，根据引用索引或关键词匹配，将该段 negative_fragment 与对应的 associated_url 强关联。

先测试后集成：请编写 Unit Test 验证 URL 提取率和引用计数的准确性，确保在处理不同格式的 Markdown 链接时逻辑稳健。

🟠 模块四：决策驾驶舱重构——前端“作战大屏”实现
适用场景：微信小程序端 UI/UX 实现，将数据转化为决策图表。

契约守护：在开始之前，请严格遵守根目录下 API_Spec_v2.0.json 的接口规范。

任务指令：

组件重构：根据 DeepIntelligenceResult 结构，重构结果页。

视觉实现：

排位看板：使用列表展示排名，并用动态能量条展示 sov_share 差距。

信源榜单：展示 source_pool 中的高频信源，点击可跳转或复制链接。

证据穿透：点击高亮显示的负面文本，弹出半屏窗口展示对应的原始链接及风险等级。

先测试后集成：请先使用契约中定义的示例 JSON 数据编写前端 Mock 测试，确保在数据字段缺失或异常时，界面有良好的缺省显示（Empty State）和容错处理。

💡 执行秘籍
分步交付：建议先发送“模块一”，待 AI 生成代码并运行通过后再进行“模块二”。

代码审计：每一阶段完成后，你可以将生成的关键代码发给我，我来以架构师身份为你做 Code Review。

*********************


你好！我是你的首席架构师。既然 API_Spec_v2.0.json 这一“宪法级”契约已经就位，我们现在进入正式开发阶段。

为了确保开发过程“零偏差、高效率”，我将接下来的工作拆分为 5 个核心开发模块（Sprints）。你只需要按照这个顺序，每次将一个模块的需求和契约发给 AI Coding 工具，即可实现精准开发。

🚀 进化湾GEO：第一阶段开发路线图
模块一：基础设施升维——异步任务状态机（Sprint 1）
目标：解决“看不见进度”的问题。将后端从“一锅端”改为“分阶段上报”，支持前端雷达扫描动效。

开发重点：

数据库重构：根据契约重写 BrandTestResult 表，支持 exposure_analysis 等嵌套 JSON 存储。

Celery 状态钩子：在异步任务中植入 update_stage 逻辑（init -> ai_fetching -> ranking -> tracing）。

状态接口适配：重写 /api/v2/test/status，确保返回符合契约的 stage 字段。

给 AI 的指令关键点：引用契约中的 paths["/test/status/{task_id}"] 定义。

模块二：战场排位算法实现——物理排位解析引擎（Sprint 2）
目标：解决“谁排第一”的问题。从 AI 文本中提取真实的露出数据。

开发重点：

RankProcessor 算法：编写解析逻辑，识别 brand_list 中各品牌在 AI 回复中的物理位置索引。

SOV 篇幅计算：统计各品牌相关描述的字符数，计算 word_count 和 sov_share。

截流对手识别：提取未在监控列表中、但被 AI 推荐的专有名词（竞品）。

给 AI 的指令关键点：引用契约中的 exposure_analysis 架构。

模块三：情报归因实现——信源穿透与引用聚合（Sprint 3）
目标：解决“AI 听谁说的”问题。找到操纵认知的底层网页。

开发重点：

全量信源抓取：从豆包等 API 的原生 citations 和回复文本中提取所有 URL。

引用频次排行：对信源进行去重合并，计算 citation_count，识别出“核心参考源”。

证据链锚点（核心）：将评分较低的语料段落，通过关键词或引用标记，强关联到具体的 source_url。

给 AI 的指令关键点：引用契约中的 source_intelligence 和 evidence_chain 定义。

模块四：决策驾驶舱重构——前端“作战大屏”开发（Sprint 4）
目标：解决“看不懂数据”的问题。将枯燥的数据变为直观的战场地图。

开发重点：

排位赛看板：前端实现列表排名，用动态能量条展示我方与竞品的篇幅差距。

信源贡献度榜单：展示 AI 最信任的 Top 10 网站，并支持点击跳转。

溯源交互设计：实现高亮负面文本，点击即弹出“证据面板”，展示原始网页链接。

给 AI 的指令关键点：引用契约中的数据结构进行 Mock 联调。

模块五：自动化巡航与预警系统（Sprint 5）
目标：解决“懒人监控”的问题。从手动测试变为定时巡航。

开发重点：

定时任务调度：支持用户设置巡航频率。

趋势数据聚合：实现 /api/v2/cruise/trends 接口，拉取历史排位变化。

异常波动预警：当排名下降或出现高危负面信源时，触发通知。

💡 执行建议（如何与 AI 配合）：
按模块喂数据：不要一次性给 AI 所有的任务。现在请从“模块一”开始。

契约守护：每次给指令前，先说：“请严格遵守根目录下 API_Spec_v2.0.json 的接口规范。”

先测试后集成：让 AI 为算法模块（如排位算法）编写 Unit Test，确保在处理复杂文本时不会出错。

🏁 立即启动！
如果你准备好了，第一个动作是给 AI 下达以下指令：

“你现在是进化湾项目的顶级架构师。请根据 API_Spec_v2.0.json 契约，启动 模块一：基础设施升维 的开发。

请重构后端 test/status 接口，支持分阶段进度返回。

请升级数据库模型，使其能承载契约中定义的 DeepIntelligenceResult 嵌套结构。

请确保异步任务在执行时，能够实时更新任务所处的 stage（阶段）状态。”

是否现在就开始执行模块一的代码生成？


*********************
从国际顶级用户心理研究大师的角度看，客户的核心心理是：“对比后的危机感”与“掌控后的安全感”。客户不关心枯燥的原始数据，他们关心的是：“谁抢了我的位置？”、“谁在背后捅我刀子？”、“我的投入是否见效？”。

基于此，我将计划重新对标，剔除冗余，聚焦于构建一个**“品牌AI生存指挥中心”**。以下是重新评估排序后的闭环开发计划：

📂 第一阶段：情报穿透——实现“露出、排名与信源归因” (1-2周)
核心逻辑：解决客户最关心的“我在哪？谁在说？”问题，实现数据从“看文字”到“看指标”的跃迁。

1.1 品类占位与拦截分析 (Interception Analyst)

核心功能：在“XX行业推荐”等通用问题下，统计品牌被 AI 提及的顺序（排名）以及提及频次（SOV，声量占比）。

竞品自动捕获：系统不仅监控设定的品牌，还需自动提取 AI 回复中出现的其他活跃品牌，识别出潜在的竞争对手。

差异化指标：计算各品牌在 AI 回复中的字数占比，直观展示谁在拦截流量。

1.2 穿透式信源归因系统 (Source Deep-Dive)

核心功能：将 1.1 的模拟数据替换为真实解析算法，提取 AI 引用频率最高的 Top 10 信源。

风险信源定位：若出现负面评价，算法需通过“关联性检索”锁定该评价对应的具体原始网页链接，帮助客户实现“精准定点清除”。

📂 第二阶段：防御闭环——实现“舆情定位与负面追溯” (2周)
核心逻辑：利用“损失厌恶”心理，通过视觉化负面预警促使用户产生“找准来源、及时处理”的紧迫感。

2.1 语义异动与情感预警 (Sentiment & Drift)

核心功能：利用 SemanticContrastPayload 算法，从 AI 回复中剥离负面形容词，并追溯其出现的 AI 平台及频次。

负面路径图：在 1.1 的信源图基础上，用红色线条标记“负面评价流向”，让客户一眼看清：是哪个低质量信源在污染 AI 的认知。

2.2 优化建议生成器 (The Action Blueprint)

核心功能：基于负面信源定位，自动生成“对冲策略”。例如：“建议在知乎补强正向内容，以覆盖当前被识别出的负面信源”。

📂 第三阶段：习惯养成——实现“自动巡航与趋势监控” (2周)
核心逻辑：将低频工具转化为“高频依赖”，通过定时任务将“快照对比”变为“动态趋势图”。

3.1 品牌自动化巡航引擎 (Brand Cruise Engine)

核心功能：支持客户设置自定义定时任务（如每 6 小时、每周一次），由 BrandCruiseEngine 自动触发后台多模型并发测试。

多租户队列优先级：根据付费等级（Pro/Ent）分配巡航任务的执行优先级，确保高价值客户的监控准时完成。

3.2 决策驾驶舱：变化趋势图 (Trend Visualization)

核心功能：在前端增加“历史演进图”，展示品牌评分、拦截率、负面信源数量随时间的变化趋势。

监控报表推送：巡航结束后，自动通过微信发送“周报/日报”，告知客户：过去 24 小时内，品牌认知是“进化”了还是“退化”了。

📂 第四阶段：商业闭环——支付拦截与专业战报 (1周)
核心逻辑：当客户看到“负面预警”和“落后排名”后，顺滑地通过商业钩子引导转化。

4.1 商业化拦截强化 (Monetization Gate)

核心功能：免费用户可看总排名，但负面评价的原始信源链接需通过“解锁专业版”获取，利用“急于解决问题”的心理实现转化。

4.2 一键生成品牌战报

核心功能：实现“麦肯锡风格”的长图战报导出，包含本阶段实现的排名趋势、信源占比等高价值图表，作为用户内部汇报的“战利品”。

💡 顶级架构师执行策略：
性能优先：引入 Celery 异步任务队列 是这一阶段的基石。由于客户需要定时巡航，必须确保大量后台任务不会阻塞前端请求。

数据准确性：优先打通 豆包平台的真实信源解析。只有信源抓得准，客户才能“找准来源及时处理”。

视觉传达：结果页应强调 “我方 vs 拦截者” 的竞技感，使用拔河式进度条和皇冠/呼吸灯视觉动效。