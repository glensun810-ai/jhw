# GEO å“ç‰Œæˆ˜ç•¥è¯Šæ–­æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å®Œå–„è®¡åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-21  
**æ–‡æ¡£ç±»å‹**: åŠŸèƒ½å®Œå–„è®¡åˆ’  
**ä¼˜å…ˆçº§**: P0  
**é¢„è®¡å·¥æœŸ**: 6 å‘¨ (30 ä¸ªå·¥ä½œæ—¥)  

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

GEO å“ç‰Œæˆ˜ç•¥è¯Šæ–­ç³»ç»Ÿå·²å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ŒåŒ…æ‹¬å“ç‰Œè¯Šæ–­æµ‹è¯•ã€AI é€‚é…å™¨é›†æˆã€æŠ¥å‘Šçœ‹æ¿ç­‰ã€‚ä½†å½“å‰ PDF æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å†…å®¹è¿‡äºç®€å•ï¼Œæ— æ³•æ»¡è¶³ç”¨æˆ·çš„æ ¸å¿ƒå†³ç­–éœ€æ±‚ã€‚

æ ¹æ®éº¦è‚¯é”¡äº§å“ç»ç†ä¸“å®¶çš„å®¡æ ¸ï¼Œå½“å‰æŠ¥å‘Šå¯¼å‡ºå†…å®¹è¯„åˆ†ä»…ä¸º 35%ï¼Œä¸è¡Œä¸šæ ‡æ† (88%) å­˜åœ¨ 53% çš„å·®è·ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

æ‰“é€ **éº¦è‚¯é”¡çº§åˆ«çš„å“ç‰Œè¯Šæ–­æŠ¥å‘Š**ï¼Œå®ç°ï¼š
- ğŸ“– **30 ç§’** ç†è§£æ ¸å¿ƒç»“è®ºï¼ˆæ‰§è¡Œæ‘˜è¦ï¼‰
- ğŸ“Š **3 åˆ†é’Ÿ** æŒæ¡å…³é”®å‘ç°ï¼ˆæ ¸å¿ƒæ´å¯Ÿï¼‰
- ğŸ¯ **10 åˆ†é’Ÿ** åˆ¶å®šè¡ŒåŠ¨è®¡åˆ’ï¼ˆå¯æ‰§è¡Œå»ºè®®ï¼‰

### 1.3 æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | åŸºçº¿ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| æŠ¥å‘Šä¸‹è½½ç‡ | 35% | 70% | +100% |
| æŠ¥å‘Šåˆ†äº«ç‡ | 10% | 30% | +200% |
| ç”¨æˆ·æ»¡æ„åº¦ | 3.5/5 | 4.5/5 | +29% |
| ä»˜è´¹è½¬åŒ–ç‡ | 5% | 12% | +140% |

---

## äºŒã€ç°çŠ¶åˆ†æ

### 2.1 å½“å‰ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (å¾®ä¿¡å°ç¨‹åº)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pages/index/           - é¦–é¡µè¯Šæ–­è¾“å…¥                           â”‚
â”‚  pages/report/dashboard/ - æŠ¥å‘Šçœ‹æ¿                              â”‚
â”‚  utils/pdf-export.js    - PDF å¯¼å‡ºå·¥å…· (å·²å®ç°)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯ (Flask + SQLite)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  views.py               - æ ¸å¿ƒ API (è¯Šæ–­æµ‹è¯•ã€æŠ¥å‘Šèšåˆ)            â”‚
â”‚  views_pdf_export.py    - PDF å¯¼å‡º API (å·²å®ç°)                   â”‚
â”‚  services/              - ä¸šåŠ¡æœåŠ¡å±‚                              â”‚
â”‚    â””â”€ pdf_export_service.py - PDF ç”ŸæˆæœåŠ¡ (å·²å®ç°)               â”‚
â”‚  ai_adapters/           - AI å¹³å°é€‚é…å™¨ (8 ä¸ªå¹³å°)                 â”‚
â”‚  analytics/             - åˆ†ææœåŠ¡                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  database.db            - SQLite ä¸»æ•°æ®åº“                        â”‚
â”‚  ai_responses.jsonl     - AI å“åº”æ—¥å¿—                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç°æœ‰åŠŸèƒ½è¯„ä¼°

| æ¨¡å— | çŠ¶æ€ | è¯„ä¼° | å·®è· |
|------|------|------|------|
| PDF å¯¼å‡º API | âœ… å·²å®ç° | åŸºç¡€åŠŸèƒ½å¯ç”¨ | ç¼ºå°‘è¯¦ç»†æ•°æ® |
| PDF æœåŠ¡ | âœ… å·²å®ç° | æ”¯æŒä¸­æ–‡ | æ¨¡æ¿ç®€å• |
| å‰ç«¯å¯¼å‡ºå·¥å…· | âœ… å·²å®ç° | å¯å¯¼å‡º HTML | ç¼ºå°‘é€‰é¡¹ |
| æ‰§è¡Œæ‘˜è¦ | âŒ æœªå®ç° | - | é«˜ä¼˜å…ˆçº§ |
| ç«å“å¯¹æ¯”è¯¦æƒ… | âš ï¸ éƒ¨åˆ†å®ç° | æœ‰åŸºç¡€æ•°æ® | ç¼ºå°‘å¯è§†åŒ– |
| è´Ÿé¢ä¿¡æºåˆ—è¡¨ | âš ï¸ éƒ¨åˆ†å®ç° | æœ‰åŸºç¡€æ•°æ® | ç¼ºå°‘è¯¦æƒ… |
| ROI æŒ‡æ ‡ | âš ï¸ éƒ¨åˆ†å®ç° | æœ‰è®¡ç®—é€»è¾‘ | ç¼ºå°‘å±•ç¤º |
| è¡ŒåŠ¨è®¡åˆ’ | âŒ æœªå®ç° | - | é«˜ä¼˜å…ˆçº§ |

### 2.3 æŠ€æœ¯å€ºåŠ¡

| é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ |
|------|------|--------|
| PDF ä¸­æ–‡å­—ä½“ä¾èµ–ç³»ç»Ÿ | è·¨å¹³å°å…¼å®¹æ€§é£é™© | ä¸­ |
| å¤§æ•°æ®é‡ç”Ÿæˆæ…¢ | ç”¨æˆ·ä½“éªŒé—®é¢˜ | ä¸­ |
| ç¼ºå°‘å¼‚æ­¥ç”Ÿæˆæœºåˆ¶ | è¶…æ—¶é£é™© | é«˜ |
| ç¼ºå°‘æŠ¥å‘Šæ¨¡æ¿ç³»ç»Ÿ | ç»´æŠ¤å›°éš¾ | ä¸­ |

---

## ä¸‰ã€åŠŸèƒ½éœ€æ±‚è¯¦ç»†è®¾è®¡

### 3.1 å®Œæ•´æŠ¥å‘Šç»“æ„

```
GEO å“ç‰Œæˆ˜ç•¥è¯Šæ–­æŠ¥å‘Š (15-20 é¡µ)
â”‚
â”œâ”€â”€ å°é¢ (1 é¡µ)
â”‚   â”œâ”€â”€ æŠ¥å‘Šæ ‡é¢˜
â”‚   â”œâ”€â”€ å“ç‰Œåç§°
â”‚   â”œâ”€â”€ æŠ¥å‘Šç”Ÿæˆæ—¥æœŸ
â”‚   â””â”€â”€ æ‰§è¡Œ ID
â”‚
â”œâ”€â”€ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ‰§è¡Œæ‘˜è¦ (1-2 é¡µ) ğŸ”´ P0
â”‚   â”œâ”€â”€ 1.1 å“ç‰Œå¥åº·åº¦é€Ÿè§ˆ
â”‚   â”œâ”€â”€ 1.2 æ ¸å¿ƒå‘ç° (3-5 æ¡)
â”‚   â”œâ”€â”€ 1.3 å…³é”®æŒ‡æ ‡
â”‚   â””â”€â”€ 1.4 ä¼˜å…ˆçº§å»ºè®®
â”‚
â”œâ”€â”€ ç¬¬äºŒéƒ¨åˆ†ï¼šå“ç‰Œå¥åº·åº¦è¯Šæ–­ (3-4 é¡µ) ğŸ”´ P0
â”‚   â”œâ”€â”€ 2.1 æ€»ä½“è¯„åˆ†ä¸è¯„çº§
â”‚   â”œâ”€â”€ 2.2 å››ç»´åº¦è¯¦è§£
â”‚   â”‚   â”œâ”€â”€ æƒå¨æ€§ (Authority)
â”‚   â”‚   â”œâ”€â”€ å¯è§æ€§ (Visibility)
â”‚   â”‚   â”œâ”€â”€ çº¯å‡€åº¦ (Purity)
â”‚   â”‚   â””â”€â”€ ä¸€è‡´æ€§ (Consistency)
â”‚   â”œâ”€â”€ 2.3 ä¸è¡Œä¸šåŸºå‡†å¯¹æ¯”
â”‚   â””â”€â”€ 2.4 å†å²è¶‹åŠ¿ (å¦‚æœ‰)
â”‚
â”œâ”€â”€ ç¬¬ä¸‰éƒ¨åˆ†ï¼šAI å¹³å°è¡¨ç°åˆ†æ (3-4 é¡µ) ğŸŸ¡ P1
â”‚   â”œâ”€â”€ 3.1 å„å¹³å°è¯„åˆ†å¯¹æ¯”
â”‚   â”œâ”€â”€ 3.2 å¹³å°è¡¨ç°çŸ©é˜µ
â”‚   â”œâ”€â”€ 3.3 ä¼˜åŠ¿/åŠ£åŠ¿å¹³å°
â”‚   â””â”€â”€ 3.4 å¹³å°ç‰¹å¼‚æ€§å‘ç°
â”‚
â”œâ”€â”€ ç¬¬å››éƒ¨åˆ†ï¼šç«å“å¯¹æ¯”åˆ†æ (3-4 é¡µ) ğŸ”´ P0
â”‚   â”œâ”€â”€ 4.1 ç«å“åˆ—è¡¨
â”‚   â”œâ”€â”€ 4.2 ç»¼åˆå¯¹æ¯”é›·è¾¾å›¾
â”‚   â”œâ”€â”€ 4.3 å„ç»´åº¦æ’å
â”‚   â”œâ”€â”€ 4.4 ç«äº‰å·®è·åˆ†æ
â”‚   â””â”€â”€ 4.5 è¶…è¶Šæœºä¼šç‚¹
â”‚
â”œâ”€â”€ ç¬¬äº”éƒ¨åˆ†ï¼šé—®é¢˜è¯Šæ–­ä¸è´Ÿé¢ä¿¡æº (2-3 é¡µ) ğŸ”´ P0
â”‚   â”œâ”€â”€ 5.1 æ ¸å¿ƒé—®é¢˜æ¸…å•
â”‚   â”œâ”€â”€ 5.2 é—®é¢˜ä¸¥é‡ç¨‹åº¦åˆ†çº§
â”‚   â”œâ”€â”€ 5.3 é«˜é£é™©è´Ÿé¢ä¿¡æºåˆ—è¡¨
â”‚   â”œâ”€â”€ 5.4 è´Ÿé¢ä¿¡æºè¯¦æƒ…
â”‚   â””â”€â”€ 5.5 åº”å¯¹å»ºè®®
â”‚
â”œâ”€â”€ ç¬¬å…­éƒ¨åˆ†ï¼šROI æŒ‡æ ‡åˆ†æ (1-2 é¡µ) ğŸŸ¡ P1
â”‚   â”œâ”€â”€ 6.1 æ›å…‰ ROI
â”‚   â”œâ”€â”€ 6.2 æƒ…æ„Ÿ ROI
â”‚   â”œâ”€â”€ 6.3 æ’å ROI
â”‚   â”œâ”€â”€ 6.4 ä¼°ç®—å“ç‰Œæ›å…‰ä»·å€¼
â”‚   â””â”€â”€ 6.5 è¡Œä¸šåŸºå‡†å¯¹æ¯”
â”‚
â”œâ”€â”€ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šè¡ŒåŠ¨å»ºè®®ä¸å®æ–½è®¡åˆ’ (2-3 é¡µ) ğŸŸ¡ P1
â”‚   â”œâ”€â”€ 7.1 çŸ­æœŸè¡ŒåŠ¨ (1-4 å‘¨)
â”‚   â”œâ”€â”€ 7.2 ä¸­æœŸè¡ŒåŠ¨ (1-3 æœˆ)
â”‚   â”œâ”€â”€ 7.3 é•¿æœŸè¡ŒåŠ¨ (3-6 æœˆ)
â”‚   â”œâ”€â”€ 7.4 èµ„æºéœ€æ±‚ä¼°ç®—
â”‚   â””â”€â”€ 7.5 é¢„æœŸæ•ˆæœè¯„ä¼°
â”‚
â””â”€â”€ é™„å½•ï¼šæµ‹è¯•è¯¦æƒ… (1 é¡µ) ğŸŸ¢ P2
    â”œâ”€â”€ A.1 æµ‹è¯•åŸºæœ¬ä¿¡æ¯
    â”œâ”€â”€ A.2 ä½¿ç”¨çš„ AI æ¨¡å‹
    â”œâ”€â”€ A.3 æµ‹è¯•é—®é¢˜åˆ—è¡¨
    â””â”€â”€ A.4 æ•°æ®æ”¶é›†æ—¶é—´èŒƒå›´
```

### 3.2 æ•°æ®éœ€æ±‚åˆ†æ

#### 3.2.1 éœ€è¦æ–°å¢çš„æ•°æ®å­—æ®µ

```python
# æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å»ºè®®

# 1. test_results è¡¨æ–°å¢å­—æ®µ
ALTER TABLE test_results ADD COLUMN competitor_analysis TEXT;  # JSON: ç«å“åˆ†ææ•°æ®
ALTER TABLE test_results ADD COLUMN negative_sources TEXT;     # JSON: è´Ÿé¢ä¿¡æºæ•°æ®
ALTER TABLE test_results ADD COLUMN roi_metrics TEXT;          # JSON: ROI æŒ‡æ ‡æ•°æ®
ALTER TABLE test_results ADD COLUMN action_plan TEXT;          # JSON: è¡ŒåŠ¨è®¡åˆ’æ•°æ®
ALTER TABLE test_results ADD COLUMN executive_summary TEXT;    # TEXT: æ‰§è¡Œæ‘˜è¦

# 2. æ–°å¢ competitive_analysis è¡¨
CREATE TABLE competitive_analysis (
    id INTEGER PRIMARY KEY,
    execution_id TEXT NOT NULL,
    competitor_name TEXT NOT NULL,
    overall_score REAL,
    authority_score REAL,
    visibility_score REAL,
    purity_score REAL,
    consistency_score REAL,
    platform_scores TEXT,  # JSON: å„å¹³å°è¯„åˆ†
    analyzed_at TEXT,
    FOREIGN KEY (execution_id) REFERENCES test_results(execution_id)
);

# 3. æ–°å¢ negative_sources è¡¨
CREATE TABLE negative_sources (
    id INTEGER PRIMARY KEY,
    execution_id TEXT NOT NULL,
    source_name TEXT NOT NULL,
    source_url TEXT,
    content_summary TEXT,
    severity TEXT,  # critical, high, medium, low
    impact_scope TEXT,  # high, medium, low
    discovered_at TEXT,
    recommendation TEXT,
    status TEXT,  # pending, in_progress, resolved
    FOREIGN KEY (execution_id) REFERENCES test_results(execution_id)
);
```

#### 3.2.2 æ•°æ®èšåˆæœåŠ¡

```python
# services/report_data_service.py

class ReportDataService:
    """
    æŠ¥å‘Šæ•°æ®èšåˆæœåŠ¡
    è´Ÿè´£ä»å„æ•°æ®æºèšåˆå®Œæ•´çš„æŠ¥å‘Šæ•°æ®
    """
    
    def __init__(self):
        self.db = get_connection()
        self.ai_analyzer = AIAnalyzer()
        self.competitor_service = CompetitorService()
        self.negative_source_service = NegativeSourceService()
        self.roi_calculator = ROICalculator()
        self.action_plan_generator = ActionPlanGenerator()
    
    def generate_full_report(self, execution_id: str) -> Dict[str, Any]:
        """
        ç”Ÿæˆå®Œæ•´æŠ¥å‘Šæ•°æ®
        
        Args:
            execution_id: æ‰§è¡Œ ID
        
        Returns:
            å®Œæ•´æŠ¥å‘Šæ•°æ®å­—å…¸
        """
        # 1. è·å–åŸºç¡€è¯Šæ–­æ•°æ®
        base_data = self._get_base_data(execution_id)
        
        # 2. è·å–æˆ–ç”Ÿæˆç«å“å¯¹æ¯”æ•°æ®
        competitive_data = self._get_or_generate_competitive_data(execution_id)
        
        # 3. è·å–æˆ–ç”Ÿæˆè´Ÿé¢ä¿¡æºæ•°æ®
        negative_sources = self._get_or_generate_negative_sources(execution_id)
        
        # 4. è®¡ç®— ROI æŒ‡æ ‡
        roi_metrics = self._calculate_roi(base_data)
        
        # 5. ç”Ÿæˆè¡ŒåŠ¨å»ºè®®
        action_plan = self._generate_action_plan(
            base_data, 
            competitive_data,
            negative_sources
        )
        
        # 6. ç”Ÿæˆæ‰§è¡Œæ‘˜è¦
        executive_summary = self._generate_executive_summary(
            base_data, 
            competitive_data, 
            negative_sources,
            roi_metrics
        )
        
        return {
            "reportMetadata": {
                "executionId": execution_id,
                "generatedAt": datetime.now().isoformat(),
                "reportVersion": "2.0",
                "brandName": base_data.get('brand_name')
            },
            "executiveSummary": executive_summary,
            "brandHealth": base_data,
            "platformAnalysis": base_data.get('platform_scores', []),
            "competitiveAnalysis": competitive_data,
            "negativeSources": negative_sources,
            "roiAnalysis": roi_metrics,
            "actionPlan": action_plan
        }
    
    def _get_base_data(self, execution_id: str) -> Dict[str, Any]:
        """è·å–åŸºç¡€è¯Šæ–­æ•°æ®"""
        # ä» database.db è·å–
        pass
    
    def _get_or_generate_competitive_data(self, execution_id: str) -> Dict[str, Any]:
        """è·å–æˆ–ç”Ÿæˆç«å“å¯¹æ¯”æ•°æ®"""
        # 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        # 2. å¦‚ä¸å­˜åœ¨ï¼Œè°ƒç”¨ AI åˆ†æç”Ÿæˆ
        pass
    
    def _get_or_generate_negative_sources(self, execution_id: str) -> List[Dict[str, Any]]:
        """è·å–æˆ–ç”Ÿæˆè´Ÿé¢ä¿¡æºæ•°æ®"""
        # 1. ä»è´Ÿé¢ä¿¡æºè¡¨è·å–
        # 2. å¦‚ä¸è¶³ï¼Œè°ƒç”¨ AI åˆ†æè¡¥å……
        pass
    
    def _calculate_roi(self, base_data: Dict[str, Any]) -> Dict[str, Any]:
        """è®¡ç®— ROI æŒ‡æ ‡"""
        # åŸºäºåŸºç¡€æ•°æ®è®¡ç®—
        pass
    
    def _generate_action_plan(self, base_data, competitive_data, negative_sources) -> Dict[str, Any]:
        """ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’"""
        # åŸºäºåˆ†æç»“æœç”Ÿæˆ
        pass
    
    def _generate_executive_summary(self, base_data, competitive_data, 
                                     negative_sources, roi_metrics) -> Dict[str, Any]:
        """ç”Ÿæˆæ‰§è¡Œæ‘˜è¦"""
        # æ±‡æ€»æ ¸å¿ƒå‘ç°
        pass
```

### 3.3 API è®¾è®¡

#### 3.3.1 æ–°å¢ API ç«¯ç‚¹

```python
# views_pdf_export.py

@pdf_export_bp.route('/api/export/report-data', methods=['GET'])
@require_auth_optional
@rate_limit(limit=10, window=60, per='endpoint')
def get_full_report_data():
    """
    è·å–å®Œæ•´æŠ¥å‘Šæ•°æ®
    
    Query Parameters:
    - executionId: æ‰§è¡Œ ID (required)
    - format: æ•°æ®æ ¼å¼ (basic, detailed, full) default: full
    - sections: éœ€è¦çš„ç« èŠ‚ (comma-separated) default: all
    
    Returns:
    - å®Œæ•´æŠ¥å‘Šæ•°æ® JSON
    """
    execution_id = request.args.get('executionId')
    format_level = request.args.get('format', 'full')
    sections = request.args.get('sections', 'all')
    
    if not execution_id:
        return jsonify({'error': 'executionId is required'}), 400
    
    try:
        report_service = ReportDataService()
        full_report = report_service.generate_full_report(execution_id)
        
        # æ ¹æ® format_level è¿‡æ»¤æ•°æ®
        if format_level == 'basic':
            report_data = self._filter_basic(full_report)
        elif format_level == 'detailed':
            report_data = self._filter_detailed(full_report)
        else:
            report_data = full_report
        
        # æ ¹æ® sections è¿‡æ»¤
        if sections != 'all':
            section_list = sections.split(',')
            report_data = {k: v for k, v in report_data.items() if k in section_list}
        
        return jsonify({
            'status': 'success',
            'data': report_data
        })
        
    except Exception as e:
        api_logger.error(f"è·å–æŠ¥å‘Šæ•°æ®å¤±è´¥ï¼š{e}", exc_info=True)
        return jsonify({
            'error': 'Failed to get report data',
            'details': str(e)
        }), 500


@pdf_export_bp.route('/api/export/pdf', methods=['GET'])
@require_auth_optional
@rate_limit(limit=5, window=60, per='endpoint')
def export_pdf_report():
    """
    å¯¼å‡ºæµ‹è¯•æŠ¥å‘Šä¸º PDF (å¢å¼ºç‰ˆ)
    
    Query Parameters:
    - executionId: æµ‹è¯•æ‰§è¡Œ ID (required)
    - level: æŠ¥å‘Šçº§åˆ« (basic, detailed, full) default: full
    - sections: éœ€è¦çš„ç« èŠ‚ (comma-separated) default: all
    - async: æ˜¯å¦å¼‚æ­¥ç”Ÿæˆ (true, false) default: false
    
    Returns:
    - PDF file download æˆ– å¼‚æ­¥ä»»åŠ¡ ID
    """
    execution_id = request.args.get('executionId')
    level = request.args.get('level', 'full')
    sections = request.args.get('sections', 'all')
    is_async = request.args.get('async', 'false').lower() == 'true'
    
    if not execution_id:
        return jsonify({'error': 'executionId is required'}), 400
    
    if is_async:
        # å¼‚æ­¥ç”Ÿæˆ
        task_id = generate_task_id()
        queue_pdf_generation(execution_id, level, sections, task_id)
        
        return jsonify({
            'status': 'processing',
            'task_id': task_id,
            'status_url': f'/api/export/status/{task_id}'
        }), 202
    else:
        # åŒæ­¥ç”Ÿæˆ
        try:
            pdf_service = PDFExportService()
            pdf_data = pdf_service.generate_full_report(execution_id, level, sections)
            
            return Response(
                pdf_data,
                mimetype='application/pdf',
                headers={
                    'Content-Disposition': f'attachment; filename=report_{execution_id}_{datetime.now().strftime("%Y%m%d")}.pdf',
                    'Content-Length': len(pdf_data)
                }
            )
        except Exception as e:
            return jsonify({'error': str(e)}), 500


@pdf_export_bp.route('/api/export/status/<task_id>', methods=['GET'])
@require_auth_optional
def get_export_status(task_id):
    """
    è·å–å¼‚æ­¥å¯¼å‡ºä»»åŠ¡çŠ¶æ€
    
    Returns:
    - ä»»åŠ¡çŠ¶æ€å’Œç»“æœ
    """
    status = get_task_status(task_id)
    
    if status['status'] == 'completed':
        return jsonify({
            'status': 'completed',
            'download_url': f'/api/export/download/{task_id}'
        })
    elif status['status'] == 'failed':
        return jsonify({
            'status': 'failed',
            'error': status.get('error')
        }), 500
    else:
        return jsonify({
            'status': 'processing',
            'progress': status.get('progress', 0)
        })


@pdf_export_bp.route('/api/export/html', methods=['GET'])
@require_auth_optional
@rate_limit(limit=10, window=60, per='endpoint')
def export_html_report():
    """
    å¯¼å‡ºæµ‹è¯•æŠ¥å‘Šä¸º HTMLï¼ˆç”¨äºå¾®ä¿¡å°ç¨‹åºé¢„è§ˆï¼‰
    
    Query Parameters:
    - executionId: æµ‹è¯•æ‰§è¡Œ ID (required)
    - level: æŠ¥å‘Šçº§åˆ« (basic, detailed, full) default: full
    
    Returns:
    - HTML content
    """
    execution_id = request.args.get('executionId')
    level = request.args.get('level', 'full')
    
    if not execution_id:
        return jsonify({'error': 'executionId is required'}), 400
    
    try:
        html_service = HTMLExportService()
        html_content = html_service.generate_report(execution_id, level)
        
        return Response(
            html_content,
            mimetype='text/html',
            headers={
                'Content-Disposition': f'inline; filename=report_{execution_id}.html',
            }
        )
    except Exception as e:
        return jsonify({'error': str(e)}), 500
```

### 3.4 å‰ç«¯ç»„ä»¶è®¾è®¡

#### 3.4.1 å¯¼å‡ºé€‰é¡¹ç»„ä»¶

```javascript
// components/ExportOptions/ExportOptions.js

Component({
  properties: {
    executionId: String,
    visible: Boolean
  },

  data: {
    format: 'pdf',  // pdf, html, excel
    level: 'full',  // basic, detailed, full
    sections: {
      executiveSummary: true,
      brandHealth: true,
      platformAnalysis: true,
      competitiveAnalysis: true,
      negativeSources: true,
      roiAnalysis: true,
      actionPlan: true
    },
    isAsync: false,
    generating: false,
    progress: 0
  },

  methods: {
    async handleExport() {
      const { executionId } = this.properties;
      const { format, level, sections, isAsync } = this.data;

      this.setData({ generating: true, progress: 0 });

      try {
        if (format === 'pdf') {
          await this.exportPDF(executionId, level, sections, isAsync);
        } else if (format === 'html') {
          await this.exportHTML(executionId, level);
        } else if (format === 'excel') {
          await this.exportExcel(executionId);
        }

        wx.showToast({
          title: 'å¯¼å‡ºæˆåŠŸ',
          icon: 'success'
        });

        this.triggerEvent('exportSuccess');
      } catch (error) {
        wx.showToast({
          title: 'å¯¼å‡ºå¤±è´¥ï¼š' + error.message,
          icon: 'none'
        });

        this.triggerEvent('exportError', { error });
      } finally {
        this.setData({ generating: false, progress: 0 });
      }
    },

    async exportPDF(executionId, level, sections, isAsync) {
      const { exportToPDF } = require('../../utils/pdf-export');

      if (isAsync) {
        // å¼‚æ­¥å¯¼å‡º
        const result = await wx.request({
          url: `${app.globalData.apiBaseUrl}/api/export/pdf`,
          method: 'GET',
          data: {
            executionId,
            level,
            sections: Object.keys(sections).filter(k => sections[k]).join(','),
            async: 'true'
          }
        });

        if (result.data.status === 'processing') {
          // è½®è¯¢ä»»åŠ¡çŠ¶æ€
          this.pollTaskStatus(result.data.task_id);
        }
      } else {
        // åŒæ­¥å¯¼å‡º
        await exportToPDF({
          executionId,
          level,
          sections,
          includeROI: sections.roiAnalysis,
          includeSources: sections.negativeSources
        });
      }
    },

    async pollTaskStatus(taskId) {
      const poll = async () => {
        const result = await wx.request({
          url: `${app.globalData.apiBaseUrl}/api/export/status/${taskId}`,
          method: 'GET'
        });

        if (result.data.status === 'completed') {
          // ä¸‹è½½æ–‡ä»¶
          this.downloadFile(result.data.download_url);
        } else if (result.data.status === 'failed') {
          throw new Error(result.data.error);
        } else {
          // ç»§ç»­è½®è¯¢
          this.setData({ progress: result.data.progress || 0 });
          setTimeout(poll, 2000);
        }
      };

      poll();
    },

    downloadFile(url) {
      wx.downloadFile({
        url: `${app.globalData.apiBaseUrl}${url}`,
        success: (res) => {
          wx.openDocument({
            filePath: res.tempFilePath,
            showMenu: true
          });
        }
      });
    }
  }
});
```

#### 3.4.2 æŠ¥å‘Šé¢„è§ˆç»„ä»¶

```javascript
// components/ReportPreview/ReportPreview.js

Component({
  properties: {
    reportData: Object,
    visible: Boolean
  },

  data: {
    currentSection: 'executiveSummary',
    sections: [
      { id: 'executiveSummary', title: 'æ‰§è¡Œæ‘˜è¦', icon: 'ğŸ“Š' },
      { id: 'brandHealth', title: 'å“ç‰Œå¥åº·åº¦', icon: 'ğŸ’š' },
      { id: 'competitiveAnalysis', title: 'ç«å“å¯¹æ¯”', icon: 'âš”ï¸' },
      { id: 'negativeSources', title: 'è´Ÿé¢ä¿¡æº', icon: 'âš ï¸' },
      { id: 'actionPlan', title: 'è¡ŒåŠ¨è®¡åˆ’', icon: 'ğŸ“‹' }
    ]
  },

  methods: {
    switchSection(e) {
      const { section } = e.currentTarget.dataset;
      this.setData({ currentSection: section });
    },

    handleExport() {
      this.triggerEvent('export');
    },

    handleShare() {
      this.triggerEvent('share');
    }
  }
});
```

---

## å››ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            å‰ç«¯å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ å¯¼å‡ºé€‰é¡¹ç»„ä»¶  â”‚  â”‚ æŠ¥å‘Šé¢„è§ˆç»„ä»¶  â”‚  â”‚ PDF å¯¼å‡ºå·¥å…·   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTPS
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            API ç½‘å…³å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Flask Blueprint                           â”‚  â”‚
â”‚  â”‚  /api/export/report-data  - è·å–æŠ¥å‘Šæ•°æ®                      â”‚  â”‚
â”‚  â”‚  /api/export/pdf        - å¯¼å‡º PDF                           â”‚  â”‚
â”‚  â”‚  /api/export/html       - å¯¼å‡º HTML                          â”‚  â”‚
â”‚  â”‚  /api/export/status     - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢                        â”‚  â”‚
â”‚  â”‚  /api/export/download   - æ–‡ä»¶ä¸‹è½½                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æœåŠ¡å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ReportDataServiceâ”‚  â”‚PDFExportServiceâ”‚  â”‚HTMLExportServiceâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚CompetitorServiceâ”‚ â”‚NegativeSourceServiceâ”‚ â”‚ROICalculatorâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ•°æ®å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  SQLite DB   â”‚  â”‚  AI Adapters â”‚  â”‚  File System â”‚               â”‚
â”‚  â”‚  - test_results  â”‚  â”‚  - 8 ä¸ªå¹³å°   â”‚  â”‚  - PDF æ–‡ä»¶   â”‚              â”‚
â”‚  â”‚  - competitive   â”‚  â”‚  - ç«å“åˆ†æ  â”‚  â”‚  - HTML æ–‡ä»¶  â”‚              â”‚
â”‚  â”‚  - negative_src  â”‚  â”‚  - è´Ÿé¢ä¿¡æº  â”‚  â”‚  - ä¸´æ—¶æ–‡ä»¶  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å¼‚æ­¥ä»»åŠ¡æ¶æ„

```python
# services/async_export_service.py

import threading
import queue
from typing import Dict, Any
from wechat_backend.logging_config import api_logger

class AsyncExportService:
    """
    å¼‚æ­¥å¯¼å‡ºæœåŠ¡
    å¤„ç†å¤§æ•°æ®é‡ PDF ç”Ÿæˆçš„å¼‚æ­¥ä»»åŠ¡
    """
    
    def __init__(self, max_workers: int = 4):
        self.task_queue = queue.Queue()
        self.task_status: Dict[str, Dict[str, Any]] = {}
        self.max_workers = max_workers
        self.workers = []
        self._start_workers()
    
    def _start_workers(self):
        """å¯åŠ¨å·¥ä½œçº¿ç¨‹"""
        for i in range(self.max_workers):
            worker = threading.Thread(target=self._worker_loop, daemon=True)
            worker.start()
            self.workers.append(worker)
        api_logger.info(f"AsyncExportService started with {self.max_workers} workers")
    
    def _worker_loop(self):
        """å·¥ä½œçº¿ç¨‹å¾ªç¯"""
        while True:
            try:
                task = self.task_queue.get()
                if task is None:
                    break
                
                self._process_task(task)
                self.task_queue.task_done()
            except Exception as e:
                api_logger.error(f"Worker error: {e}", exc_info=True)
    
    def _process_task(self, task: Dict[str, Any]):
        """å¤„ç†å•ä¸ªä»»åŠ¡"""
        task_id = task['task_id']
        
        try:
            # æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­
            self.task_status[task_id] = {
                'status': 'processing',
                'progress': 0,
                'started_at': datetime.now().isoformat()
            }
            
            # æ‰§è¡Œ PDF ç”Ÿæˆ
            pdf_service = PDFExportService()
            
            # åˆ†é˜¶æ®µæ›´æ–°è¿›åº¦
            self._update_progress(task_id, 20, "è·å–æŠ¥å‘Šæ•°æ®...")
            report_data = task['report_service'].generate_full_report(task['execution_id'])
            
            self._update_progress(task_id, 50, "ç”Ÿæˆ PDF...")
            pdf_data = pdf_service.generate_full_report(
                task['execution_id'],
                task['level'],
                task['sections']
            )
            
            self._update_progress(task_id, 80, "ä¿å­˜æ–‡ä»¶...")
            file_path = self._save_pdf(pdf_data, task_id)
            
            self._update_progress(task_id, 100, "å®Œæˆ")
            
            # æ›´æ–°çŠ¶æ€ä¸ºå®Œæˆ
            self.task_status[task_id] = {
                'status': 'completed',
                'progress': 100,
                'file_path': file_path,
                'completed_at': datetime.now().isoformat()
            }
            
        except Exception as e:
            api_logger.error(f"Task {task_id} failed: {e}", exc_info=True)
            self.task_status[task_id] = {
                'status': 'failed',
                'error': str(e),
                'failed_at': datetime.now().isoformat()
            }
    
    def _update_progress(self, task_id: str, progress: int, message: str):
        """æ›´æ–°ä»»åŠ¡è¿›åº¦"""
        if task_id in self.task_status:
            self.task_status[task_id]['progress'] = progress
            self.task_status[task_id]['message'] = message
    
    def _save_pdf(self, pdf_data: bytes, task_id: str) -> str:
        """ä¿å­˜ PDF æ–‡ä»¶"""
        import os
        from datetime import datetime
        
        output_dir = 'exports/pdf'
        os.makedirs(output_dir, exist_ok=True)
        
        filename = f"report_{task_id}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf"
        file_path = os.path.join(output_dir, filename)
        
        with open(file_path, 'wb') as f:
            f.write(pdf_data)
        
        return file_path
    
    def submit_task(self, execution_id: str, level: str, sections: str) -> str:
        """æäº¤å¼‚æ­¥ä»»åŠ¡"""
        import uuid
        task_id = str(uuid.uuid4())
        
        task = {
            'task_id': task_id,
            'execution_id': execution_id,
            'level': level,
            'sections': sections,
            'report_service': ReportDataService()
        }
        
        self.task_queue.put(task)
        
        # åˆå§‹åŒ–ä»»åŠ¡çŠ¶æ€
        self.task_status[task_id] = {
            'status': 'queued',
            'progress': 0,
            'submitted_at': datetime.now().isoformat()
        }
        
        api_logger.info(f"Task {task_id} submitted for execution_id={execution_id}")
        return task_id
    
    def get_task_status(self, task_id: str) -> Dict[str, Any]:
        """è·å–ä»»åŠ¡çŠ¶æ€"""
        return self.task_status.get(task_id, {
            'status': 'not_found',
            'error': 'Task not found'
        })


# å…¨å±€å®ä¾‹
_async_export_service = None

def get_async_export_service() -> AsyncExportService:
    """è·å–å¼‚æ­¥å¯¼å‡ºæœåŠ¡å®ä¾‹"""
    global _async_export_service
    if _async_export_service is None:
        _async_export_service = AsyncExportService(max_workers=4)
    return _async_export_service


def queue_pdf_generation(execution_id: str, level: str, sections: str, task_id: str):
    """é˜Ÿåˆ—åŒ– PDF ç”Ÿæˆä»»åŠ¡"""
    service = get_async_export_service()
    service.submit_task(execution_id, level, sections)
```

### 4.3 æ•°æ®åº“è¿ç§»è„šæœ¬

```sql
-- migrations/001_add_report_tables.sql

-- 1. ä¿®æ”¹ test_results è¡¨
ALTER TABLE test_results ADD COLUMN competitor_analysis TEXT;
ALTER TABLE test_results ADD COLUMN negative_sources TEXT;
ALTER TABLE test_results ADD COLUMN roi_metrics TEXT;
ALTER TABLE test_results ADD COLUMN action_plan TEXT;
ALTER TABLE test_results ADD COLUMN executive_summary TEXT;

-- 2. åˆ›å»ºç«å“åˆ†æè¡¨
CREATE TABLE IF NOT EXISTS competitive_analysis (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    execution_id TEXT NOT NULL,
    competitor_name TEXT NOT NULL,
    overall_score REAL,
    authority_score REAL,
    visibility_score REAL,
    purity_score REAL,
    consistency_score REAL,
    platform_scores TEXT,
    analyzed_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (execution_id) REFERENCES test_results(execution_id)
);

CREATE INDEX idx_competitive_execution ON competitive_analysis(execution_id);

-- 3. åˆ›å»ºè´Ÿé¢ä¿¡æºè¡¨
CREATE TABLE IF NOT EXISTS negative_sources (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    execution_id TEXT NOT NULL,
    source_name TEXT NOT NULL,
    source_url TEXT,
    content_summary TEXT,
    severity TEXT CHECK(severity IN ('critical', 'high', 'medium', 'low')),
    impact_scope TEXT CHECK(impact_scope IN ('high', 'medium', 'low')),
    discovered_at TEXT,
    recommendation TEXT,
    status TEXT CHECK(status IN ('pending', 'in_progress', 'resolved')) DEFAULT 'pending',
    FOREIGN KEY (execution_id) REFERENCES test_results(execution_id)
);

CREATE INDEX idx_negative_execution ON negative_sources(execution_id);
CREATE INDEX idx_negative_severity ON negative_sources(severity);

-- 4. åˆ›å»ºå¯¼å‡ºä»»åŠ¡è¡¨
CREATE TABLE IF NOT EXISTS export_tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id TEXT UNIQUE NOT NULL,
    execution_id TEXT NOT NULL,
    format TEXT CHECK(format IN ('pdf', 'html', 'excel')),
    level TEXT CHECK(level IN ('basic', 'detailed', 'full')),
    sections TEXT,
    status TEXT CHECK(status IN ('queued', 'processing', 'completed', 'failed')),
    progress INTEGER DEFAULT 0,
    file_path TEXT,
    error_message TEXT,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    completed_at TEXT,
    FOREIGN KEY (execution_id) REFERENCES test_results(execution_id)
);

CREATE INDEX idx_export_task ON export_tasks(task_id);
CREATE INDEX idx_export_execution ON export_tasks(execution_id);
CREATE INDEX idx_export_status ON export_tasks(status);
```

---

## äº”ã€å®æ–½è®¡åˆ’

### 5.1 æ€»ä½“æ—¶é—´çº¿

```
Week 1-2: Phase 1 - æ‰§è¡Œæ‘˜è¦ + è´Ÿé¢ä¿¡æºè¯¦æƒ… (P0)
Week 3-4: Phase 2 - ç«å“å¯¹æ¯”åˆ†æ + é›·è¾¾å›¾ (P0)
Week 5-6: Phase 3 - è¡ŒåŠ¨è®¡åˆ’ + ROI æŒ‡æ ‡ (P1)
Week 7-8: Phase 4 - å†å²è¶‹åŠ¿ + è§†è§‰ä¼˜åŒ– (P2)
```

### 5.2 Phase 1 è¯¦ç»†è®¡åˆ’ (ç¬¬ 1-2 å‘¨)

| ä»»åŠ¡ ID | ä»»åŠ¡æè¿° | è´Ÿè´£äºº | å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|----------|--------|------|------|--------|
| P1-1 | æ‰§è¡Œæ‘˜è¦æ•°æ®ç»“æ„è®¾è®¡ | åç«¯ | 4h | - | æ•°æ®æ¨¡å‹æ–‡æ¡£ |
| P1-2 | æ‰§è¡Œæ‘˜è¦ç”Ÿæˆé€»è¾‘å®ç° | åç«¯ | 8h | P1-1 | API ç«¯ç‚¹ |
| P1-3 | è´Ÿé¢ä¿¡æºæ•°æ®èšåˆ | åç«¯ | 4h | - | API ç«¯ç‚¹ |
| P1-4 | æ•°æ®åº“è¿ç§»è„šæœ¬ | åç«¯ | 2h | - | SQL è„šæœ¬ |
| P1-5 | PDF æ¨¡æ¿æ›´æ–° | å‰ç«¯ | 8h | P1-2 | æ–°æ¨¡æ¿ |
| P1-6 | å¯¼å‡ºé€‰é¡¹ç»„ä»¶ | å‰ç«¯ | 8h | - | ç»„ä»¶ |
| P1-7 | é›†æˆæµ‹è¯• | æµ‹è¯• | 4h | P1-5,P1-6 | æµ‹è¯•æŠ¥å‘Š |
| **åˆè®¡** | | | **38h** | | |

### 5.3 Phase 2 è¯¦ç»†è®¡åˆ’ (ç¬¬ 3-4 å‘¨)

| ä»»åŠ¡ ID | ä»»åŠ¡æè¿° | è´Ÿè´£äºº | å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|----------|--------|------|------|--------|
| P2-1 | ç«å“å¯¹æ¯”æ•°æ®ç»“æ„è®¾è®¡ | åç«¯ | 4h | - | æ•°æ®æ¨¡å‹ |
| P2-2 | ç«å“åˆ†æ AI é€»è¾‘ | åç«¯ | 12h | P2-1 | æœåŠ¡å±‚ |
| P2-3 | ç«å“å¯¹æ¯” API | åç«¯ | 4h | P2-2 | API ç«¯ç‚¹ |
| P2-4 | é›·è¾¾å›¾ç”Ÿæˆé€»è¾‘ | åç«¯ | 8h | - | å›¾è¡¨æ•°æ® |
| P2-5 | ç«å“å¯¹æ¯” PDF æ¨¡æ¿ | å‰ç«¯ | 8h | P2-3 | æ¨¡æ¿ |
| P2-6 | æŠ¥å‘Šé¢„è§ˆç»„ä»¶ | å‰ç«¯ | 8h | - | ç»„ä»¶ |
| P2-7 | é›†æˆæµ‹è¯• | æµ‹è¯• | 4h | P2-5,P2-6 | æµ‹è¯•æŠ¥å‘Š |
| **åˆè®¡** | | | **48h** | | |

### 5.4 Phase 3 è¯¦ç»†è®¡åˆ’ (ç¬¬ 5-6 å‘¨)

| ä»»åŠ¡ ID | ä»»åŠ¡æè¿° | è´Ÿè´£äºº | å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|----------|--------|------|------|--------|
| P3-1 | ROI æŒ‡æ ‡è®¡ç®—é€»è¾‘ | åç«¯ | 8h | - | è®¡ç®—å™¨ |
| P3-2 | è¡ŒåŠ¨è®¡åˆ’ç”Ÿæˆé€»è¾‘ | åç«¯ | 8h | - | ç”Ÿæˆå™¨ |
| P3-3 | å¼‚æ­¥ä»»åŠ¡æœåŠ¡ | åç«¯ | 8h | - | å¼‚æ­¥æœåŠ¡ |
| P3-4 | ROI/è¡ŒåŠ¨ PDF æ¨¡æ¿ | å‰ç«¯ | 8h | P3-1,P3-2 | æ¨¡æ¿ |
| P3-5 | å¼‚æ­¥å¯¼å‡º UI | å‰ç«¯ | 8h | P3-3 | ç»„ä»¶ |
| P3-6 | æ€§èƒ½æµ‹è¯• | æµ‹è¯• | 4h | P3-4,P3-5 | æµ‹è¯•æŠ¥å‘Š |
| **åˆè®¡** | | | **44h** | | |

### 5.5 èµ„æºéœ€æ±‚

| è§’è‰² | äººæ•° | æ—¶é—´ | æ€»å·¥æ—¶ |
|------|------|------|--------|
| åç«¯å¼€å‘ | 1 | 6 å‘¨ | 130h |
| å‰ç«¯å¼€å‘ | 1 | 6 å‘¨ | 130h |
| UI è®¾è®¡ | 0.5 | 2 å‘¨ | 40h |
| æµ‹è¯• | 0.5 | 6 å‘¨ | 60h |
| äº§å“ç»ç† | 0.2 | 6 å‘¨ | 24h |
| **æ€»è®¡** | | | **384h** |

---

## å…­ã€é£é™©è¯„ä¼°ä¸ç¼“è§£

### 6.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ | è´Ÿè´£äºº |
|------|------|------|----------|--------|
| PDF ä¸­æ–‡å­—ä½“å…¼å®¹æ€§é—®é¢˜ | ä¸­ | é«˜ | 1. ä½¿ç”¨ Web å­—ä½“ 2. æä¾›é™çº§æ–¹æ¡ˆ | åç«¯ |
| å¤§æ•°æ®é‡ç”Ÿæˆè¶…æ—¶ | ä¸­ | ä¸­ | 1. å¼‚æ­¥ç”Ÿæˆ 2. è¿›åº¦æç¤º | åç«¯ |
| AI åˆ†æç»“æœä¸ç¨³å®š | é«˜ | ä¸­ | 1. ç»“æœç¼“å­˜ 2. äººå·¥å®¡æ ¸æœºåˆ¶ | åç«¯ |
| ç«å“æ•°æ®ä¸è¶³ | é«˜ | ä¸­ | 1. é™çº§å±•ç¤º 2. æ•°æ®æ ‡æ³¨ | äº§å“ |

### 6.2 é¡¹ç›®é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ | è´Ÿè´£äºº |
|------|------|------|----------|--------|
| å·¥æœŸå»¶è¯¯ | ä¸­ | é«˜ | 1. åˆ†é˜¶æ®µäº¤ä»˜ 2. æ¯å‘¨è¿›åº¦ review | PM |
| éœ€æ±‚å˜æ›´ | ä¸­ | ä¸­ | 1. éœ€æ±‚å†»ç»“ 2. å˜æ›´æ§åˆ¶æµç¨‹ | PM |
| äººå‘˜å˜åŠ¨ | ä½ | é«˜ | 1. æ–‡æ¡£å®Œå–„ 2. ä»£ç  review | Tech Lead |

### 6.3 ä¸Šçº¿é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ | è´Ÿè´£äºº |
|------|------|------|----------|--------|
| æ€§èƒ½é—®é¢˜ | ä¸­ | é«˜ | 1. æ€§èƒ½æµ‹è¯• 2. é™æµä¿æŠ¤ | åç«¯ |
| ç”¨æˆ·éšç§ | ä½ | é«˜ | 1. æ•°æ®è„±æ• 2. æƒé™æ§åˆ¶ | å®‰å…¨ |
| å…¼å®¹æ€§é—®é¢˜ | ä¸­ | ä¸­ | 1. å¤šè®¾å¤‡æµ‹è¯• 2. é™çº§æ–¹æ¡ˆ | å‰ç«¯ |

---

## ä¸ƒã€è´¨é‡ä¿è¯

### 7.1 ä»£ç è´¨é‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| å•å…ƒæµ‹è¯•è¦†ç›–ç‡ | > 80% | pytest-cov |
| ä»£ç å®¡æŸ¥é€šè¿‡ç‡ | 100% | GitHub PR |
| é™æ€æ£€æŸ¥é€šè¿‡ç‡ | 100% | pylint, flake8 |
| æŠ€æœ¯å€ºåŠ¡æ¯”ç‡ | < 5% | SonarQube |

### 7.2 æµ‹è¯•ç­–ç•¥

| æµ‹è¯•ç±»å‹ | èŒƒå›´ | å·¥å…· | è´Ÿè´£äºº |
|----------|------|------|--------|
| å•å…ƒæµ‹è¯• | æœåŠ¡å±‚ | pytest | å¼€å‘ |
| é›†æˆæµ‹è¯• | API å±‚ | pytest + requests | æµ‹è¯• |
| E2E æµ‹è¯• | å®Œæ•´æµç¨‹ | å¾®ä¿¡å°ç¨‹åºæµ‹è¯• | æµ‹è¯• |
| æ€§èƒ½æµ‹è¯• | å¯¼å‡ºåŠŸèƒ½ | locust | æµ‹è¯• |
| å…¼å®¹æ€§æµ‹è¯• | å¤šè®¾å¤‡ | çœŸæœº + æ¨¡æ‹Ÿå™¨ | æµ‹è¯• |

### 7.3 éªŒæ”¶æ ‡å‡†

| åŠŸèƒ½ | éªŒæ”¶æ ‡å‡† | ä¼˜å…ˆçº§ |
|------|----------|--------|
| æ‰§è¡Œæ‘˜è¦ | åŒ…å« 3-5 æ¡æ ¸å¿ƒå‘ç°ï¼Œ30 ç§’å¯ç†è§£ | P0 |
| ç«å“å¯¹æ¯” | åŒ…å«è‡³å°‘ 3 ä¸ªç«å“ï¼Œé›·è¾¾å›¾æ¸…æ™° | P0 |
| è´Ÿé¢ä¿¡æº | åŒ…å« URLã€å†…å®¹æ‘˜è¦ã€åº”å¯¹å»ºè®® | P0 |
| è¡ŒåŠ¨è®¡åˆ’ | åˆ†çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸï¼Œæœ‰è´Ÿè´£äººå’Œé¢„ç®— | P1 |
| ROI æŒ‡æ ‡ | åŒ…å« 3 ä¸ª ROI æŒ‡æ ‡ï¼Œæœ‰è¡Œä¸šå¯¹æ¯” | P1 |
| PDF ç”Ÿæˆ | < 5 ç§’å®Œæˆï¼Œæ–‡ä»¶ < 5MB | P1 |
| å¼‚æ­¥å¯¼å‡º | æ”¯æŒå¤§æŠ¥å‘Šå¼‚æ­¥ç”Ÿæˆï¼Œæœ‰è¿›åº¦æç¤º | P2 |

---

## å…«ã€ç›‘æ§ä¸è¿ç»´

### 8.1 ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ | é˜ˆå€¼ | å‘Šè­¦æ–¹å¼ |
|------|------|----------|
| API å“åº”æ—¶é—´ | P95 < 2s | é‚®ä»¶ + çŸ­ä¿¡ |
| PDF ç”Ÿæˆæ—¶é—´ | P95 < 10s | é‚®ä»¶ |
| å¼‚æ­¥ä»»åŠ¡å¤±è´¥ç‡ | < 5% | é‚®ä»¶ |
| ç£ç›˜ä½¿ç”¨ç‡ | < 80% | é‚®ä»¶ + çŸ­ä¿¡ |

### 8.2 æ—¥å¿—è§„èŒƒ

```python
# æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„èŒƒ
api_logger.debug()  # è°ƒè¯•ä¿¡æ¯
api_logger.info()   # æ­£å¸¸æ“ä½œ
api_logger.warning() # è­¦å‘Šï¼Œä¸å½±å“åŠŸèƒ½
api_logger.error()  # é”™è¯¯ï¼Œå½±å“åŠŸèƒ½
api_logger.critical() # ä¸¥é‡é”™è¯¯ï¼Œç³»ç»Ÿä¸å¯ç”¨
```

### 8.3 å¤‡ä»½ç­–ç•¥

| æ•°æ®ç±»å‹ | å¤‡ä»½é¢‘ç‡ | ä¿ç•™æ—¶é—´ | å­˜å‚¨ä½ç½® |
|----------|----------|----------|----------|
| æ•°æ®åº“ | æ¯æ—¥ | 30 å¤© | æœ¬åœ° + äº‘å­˜å‚¨ |
| PDF æ–‡ä»¶ | æ¯å‘¨ | 90 å¤© | äº‘å­˜å‚¨ |
| æ—¥å¿—æ–‡ä»¶ | æ¯æ—¥ | 180 å¤© | äº‘å­˜å‚¨ |

---

## ä¹ã€é™„å½•

### 9.1 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| GEO | Generative Engine Optimizationï¼Œç”Ÿæˆå¼å¼•æ“ä¼˜åŒ– |
| SOV | Share of Voiceï¼Œå£°é‡å æ¯” |
| ROI | Return on Investmentï¼ŒæŠ•èµ„å›æŠ¥ç‡ |
| P0/P1/P2 | ä¼˜å…ˆçº§ç­‰çº§ï¼ŒP0 æœ€é«˜ |

### 9.2 å‚è€ƒæ–‡æ¡£

- [éº¦è‚¯é”¡æŠ¥å‘Šè¯„ä¼°æ¡†æ¶](å†…éƒ¨æ–‡æ¡£)
- [å¾®ä¿¡å°ç¨‹åº PDF å¯¼å‡ºæœ€ä½³å®è·µ](å®˜æ–¹æ–‡æ¡£)
- [reportlab ç”¨æˆ·æŒ‡å—](https://www.reportlab.com/docs/)
- [Flask Blueprint æ–‡æ¡£](https://flask.palletsprojects.com/)

### 9.3 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´å†…å®¹ |
|------|------|------|----------|
| v1.0 | 2026-02-21 | ç³»ç»Ÿæ¶æ„å¸ˆ | åˆå§‹ç‰ˆæœ¬ |

---

**æ–‡æ¡£ç»“æŸ**

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. âœ… å¬å¼€é¡¹ç›®å¯åŠ¨ä¼šè®®
2. âœ… ç¡®è®¤å¼€å‘èµ„æºåˆ†é…
3. âœ… å¯åŠ¨ Phase 1 å¼€å‘
4. âœ… å®‰æ’æ¯å‘¨è¿›åº¦ review
