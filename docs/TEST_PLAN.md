# AI 品牌诊断系统 - 测试计划

**版本：** 1.0  
**创建日期：** 2026 年 2 月 26 日  
**测试负责人：** 首席测试工程师  
**测试范围：** P0/P1/P2 全部修复任务（13 个任务）

---

## 📋 测试目标

验证诊断报告产出保障机制的所有功能按预期工作，确保：
1. 任何单一 AI 平台故障不影响整体结果产出
2. 错误信息透明展示，用户可操作
3. 监控告警系统正常工作
4. 自动恢复机制有效

---

## 🎯 测试优先级

| 优先级 | 测试范围 | 测试类型 | 预计工时 |
|--------|---------|---------|---------|
| P0 | 结果产出保障 (5 个任务) | 功能测试、容错测试 | 8h |
| P1 | 用户体验优化 (4 个任务) | 功能测试、UI 测试 | 6h |
| P2 | 监控告警系统 (4 个任务) | 功能测试、集成测试、性能测试 | 8h |

---

## 🧪 P0 级测试用例（结果产出保障）

### P0-005: 前端数据加载竞态条件修复

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P0-005-01 | 正常加载结果页 | 1. 完成诊断 2. 跳转到结果页 | 数据加载成功，无空白展示 | ⏳ |
| P0-005-02 | API 超时场景 | 1. 模拟 API 超时 2. 加载结果页 | 从 Storage/缓存加载，显示降级提示 | ⏳ |
| P0-005-03 | 三源并行加载验证 | 1. 清除缓存 2. 有 Storage 数据 3. API 正常 | 三个数据源同时请求，选择最优结果 | ⏳ |
| P0-005-04 | 所有数据源失败 | 1. 清除所有数据 2. API 失败 | 显示错误提示条，提供重试按钮 | ⏳ |
| P0-005-05 | 慢网络环境 | 1. 模拟 3G 网络 2. 加载结果页 | Loading 状态不超过 30 秒 | ⏳ |

### P0-006: 前端错误提示 UI 实现

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P0-006-01 | 错误提示条展示 | 1. 模拟加载失败 2. 查看结果页 | 红色错误提示条显示，重试按钮可用 | ⏳ |
| P0-006-02 | 降级提示条展示 | 1. 使用缓存数据 2. 查看结果页 | 黄色降级提示条显示 | ⏳ |
| P0-006-03 | 部分结果警告条 | 1. 部分 AI 平台失败 2. 查看结果页 | 橙色警告条显示，详情按钮可用 | ⏳ |
| P0-006-04 | 完成率提示条 | 1. 完成率<100% 2. 查看结果页 | 蓝色完成率提示条显示 | ⏳ |
| P0-006-05 | 提示条样式验证 | 1. 各类型提示条展示 | 颜色、图标、布局符合设计 | ⏳ |

### P0-007: 配额警告标记传递

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P0-007-01 | 配额用尽模型收集 | 1. 模拟豆包配额用尽 2. 执行诊断 | 后端返回 quota_exhausted_models 字段 | ⏳ |
| P0-007-02 | 配额警告前端展示 | 1. 有配额用尽模型 2. 查看结果页 | 配额警告提示条显示 | ⏳ |
| P0-007-03 | 配额恢复建议生成 | 1. 豆包配额用尽 2. 查看结果页 | 显示火山引擎控制台链接等建议 | ⏳ |
| P0-007-04 | 多平台配额用尽 | 1. 多个 AI 平台配额用尽 2. 执行诊断 | 所有用尽平台都显示建议 | ⏳ |
| P0-007-05 | 完成率计算验证 | 1. 10 任务完成 8 个 2. 查看结果页 | 完成率显示 80% | ⏳ |

### P0-008: 结果错误平台标记

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P0-008-01 | 错误平台视觉标记 | 1. 某平台 AI 调用失败 2. 查看结果页 | 该平台分数红色半透明显示 | ⏳ |
| P0-008-02 | 配额用尽标记 | 1. 平台配额用尽 2. 查看结果页 | 显示💰图标，脉冲动画 | ⏳ |
| P0-008-03 | 一般错误标记 | 1. 平台网络错误 2. 查看结果页 | 显示⚠️图标，脉冲动画 | ⏳ |
| P0-008-04 | 错误标记颜色 | 1. 各类型错误 | 不同错误类型不同颜色徽章 | ⏳ |
| P0-008-05 | 动画效果验证 | 1. 查看错误标记 | 脉冲动画流畅，不卡顿 | ⏳ |

### P0-009: 完成率强制展示

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P0-009-01 | 完成率<100% 展示 | 1. 部分任务失败 2. 查看结果页 | 蓝色完成率提示条显示 | ⏳ |
| P0-009-02 | 完成率=100% 隐藏 | 1. 全部任务成功 2. 查看结果页 | 不显示完成率提示条 | ⏳ |
| P0-009-03 | 后端未提供时计算 | 1. 后端未返回 completion_rate 2. 查看结果页 | 前端自动计算并显示 | ⏳ |
| P0-009-04 | 完成率数值验证 | 1. 不同完成比例 2. 查看结果页 | 数值计算准确 | ⏳ |
| P0-009-05 | 提示文案格式 | 1. 完成率 80% 2. 查看结果页 | "本次诊断完成率：8/10 (80%)" | ⏳ |

---

## 🧪 P1 级测试用例（用户体验）

### P1-015: WAL 恢复机制激活

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P1-015-01 | 服务启动 WAL 清理 | 1. 启动服务 2. 查看日志 | 清理过期 WAL 文件日志输出 | ⏳ |
| P1-015-02 | 未完成执行检测 | 1. 有未完成 WAL 文件 2. 启动服务 | 检测到未完成执行并记录 | ⏳ |
| P1-015-03 | WAL 恢复功能 | 1. 有未完成执行 2. 重新访问 | 从 WAL 恢复进度 | ⏳ |
| P1-015-04 | 过期 WAL 处理 | 1. WAL 文件>24 小时 2. 启动服务 | 过期 WAL 被清理 | ⏳ |
| P1-015-05 | WAL 写入失败处理 | 1. 模拟 WAL 写入失败 2. 执行诊断 | 不影响主流程，仅记录日志 | ⏳ |

### P1-016: 配额恢复建议

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P1-016-01 | 豆包配额建议 | 1. 豆包配额用尽 2. 查看结果页 | 显示火山引擎链接等 3 条建议 | ⏳ |
| P1-016-02 | 通义建议 | 1. 通义千问配额用尽 2. 查看结果页 | 显示阿里云链接等建议 | ⏳ |
| P1-016-03 | DeepSeek 建议 | 1. DeepSeek 配额用尽 2. 查看结果页 | 显示 DeepSeek 链接等建议 | ⏳ |
| P1-016-04 | 建议卡片 UI | 1. 有配额建议 2. 查看结果页 | 橙色卡片，链接高亮 | ⏳ |
| P1-016-05 | 切换平台按钮 | 1. 点击切换平台按钮 2. 确认 | 返回诊断页，带当前结果 | ⏳ |

### P1-017: 部分结果警告优化

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P1-017-01 | 移除自动弹窗 | 1. 部分结果 2. 加载结果页 | 不自动弹窗警告 | ⏳ |
| P1-017-02 | 详情按钮弹窗 | 1. 点击详情按钮 2. 查看弹窗 | 显示简化版警告信息 | ⏳ |
| P1-017-03 | 文案简化验证 | 1. 查看警告弹窗 | 完成率、配额警告、3 条建议 | ⏳ |
| P1-017-04 | 提示条展示 | 1. 部分结果 2. 查看结果页 | 橙色提示条正常显示 | ⏳ |
| P1-017-05 | 重试功能 | 1. 点击重试 2. 确认 | 重新加载数据 | ⏳ |

### P1-018: 数据库持久化告警

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P1-018-01 | 错误计数累加 | 1. 模拟持久化失败 2. 连续 10 次 | 错误计数累加到 10 | ⏳ |
| P1-018-02 | 告警触发 | 1. 连续 10 次失败 2. 查看日志 | 触发 HIGH 级别告警 | ⏳ |
| P1-018-03 | 时间窗口重置 | 1. 失败 5 次 2. 等待 5 分钟 3. 再失败 | 计数重置，重新累加 | ⏳ |
| P1-018-04 | 告警通知发送 | 1. 触发告警 2. 检查钉钉/邮件 | 收到告警通知 | ⏳ |
| P1-018-05 | 线程安全验证 | 1. 并发持久化失败 2. 检查计数 | 计数准确，无竞争条件 | ⏳ |

---

## 🧪 P2 级测试用例（监控告警）

### P2-020: 实时监控大盘

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P2-020-01 | 监控 API 访问 | 1. 访问/api/monitoring/dashboard 2. 检查响应 | 返回 JSON 数据，结构正确 | ⏳ |
| P2-020-02 | 前端页面访问 | 1. 访问/admin/monitoring 2. 检查页面 | 页面正常加载，图表渲染 | ⏳ |
| P2-020-03 | 指标记录 | 1. 执行诊断 2. 检查监控数据 | 诊断指标被记录 | ⏳ |
| P2-020-04 | 时间段切换 | 1. 切换今日/本周/本月 2. 检查数据 | 数据按时间段聚合 | ⏳ |
| P2-020-05 | 自动刷新 | 1. 等待 30 秒 2. 检查页面 | 数据自动刷新 | ⏳ |
| P2-020-06 | 图表渲染 | 1. 检查 4 个图表 2. 验证数据 | ECharts 图表正常渲染 | ⏳ |
| P2-020-07 | 最近诊断列表 | 1. 访问/api/monitoring/recent 2. 检查响应 | 返回最近诊断列表 | ⏳ |

### P2-021: 告警通知配置

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P2-021-01 | 钉钉告警发送 | 1. 触发告警 2. 检查钉钉 | 收到钉钉消息，格式正确 | ⏳ |
| P2-021-02 | 邮件告警发送 | 1. 触发 HIGH 告警 2. 检查邮箱 | 收到邮件，HTML 格式 | ⏳ |
| P2-021-03 | 告警级别选择 | 1. MEDIUM 告警 2. 检查通知 | 只发送钉钉，无邮件 | ⏳ |
| P2-021-04 | 环境变量配置 | 1. 修改 ALERT_ENABLED=false 2. 触发告警 | 不发送告警 | ⏳ |
| P2-021-05 | 告警冷却 | 1. 触发告警 2. 15 分钟内再触发 | 第二次不发送（冷却中） | ⏳ |

### P2-022: 错误结果详情展示

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P2-022-01 | 错误日志按钮 | 1. 有错误 2. 查看结果页 | 显示"错误日志"按钮 | ⏳ |
| P2-022-02 | 详情模态框 | 1. 点击错误日志 2. 检查模态框 | 模态框打开，显示错误列表 | ⏳ |
| P2-022-03 | 错误摘要 | 1. 查看模态框 2. 检查摘要 | 总错误数、配额用尽、其他错误 | ⏳ |
| P2-022-04 | 错误类型徽章 | 1. 各类型错误 2. 检查徽章 | 不同颜色区分错误类型 | ⏳ |
| P2-022-05 | 关闭功能 | 1. 点击遮罩/关闭按钮 2. 检查模态框 | 模态框关闭 | ⏳ |

### P2-023: 降级结果自动刷新

| 用例 ID | 测试场景 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|---------|------|
| P2-023-01 | 自动刷新启动 | 1. 使用降级数据 2. 查看控制台日志 | 启动后台刷新定时器 | ⏳ |
| P2-023-02 | 30 秒刷新间隔 | 1. 等待 30 秒 2. 检查日志 | 执行刷新请求 | ⏳ |
| P2-023-03 | 刷新成功 | 1. API 返回更多结果 2. 检查页面 | 页面数据更新，显示提示 | ⏳ |
| P2-023-04 | 最大尝试次数 | 1. 等待 5 分钟 2. 检查日志 | 达到 10 次后停止刷新 | ⏳ |
| P2-023-05 | 页面卸载清理 | 1. 刷新中 2. 离开页面 | 定时器被清理 | ⏳ |

---

## 🔍 代码质量检查清单

### 前端代码

| 检查项 | 检查内容 | 状态 |
|-------|---------|------|
| JS 语法 | 所有 JS 文件通过 node --check | ⏳ |
| 变量命名 | 驼峰命名，语义清晰 | ⏳ |
| 错误处理 | try-catch 包裹异步操作 | ⏳ |
| 内存泄漏 | 定时器正确清理 | ⏳ |
| 样式冲突 | CSS 类名无冲突 | ⏳ |

### 后端代码

| 检查项 | 检查内容 | 状态 |
|-------|---------|------|
| Python 语法 | 所有 py 文件通过 py_compile | ⏳ |
| 导入检查 | 无循环导入 | ⏳ |
| 异常处理 | 外部调用有 try-catch | ⏳ |
| 日志记录 | 关键操作有日志 | ⏳ |
| 线程安全 | 共享数据有锁保护 | ⏳ |

### 安全检査

| 检查项 | 检查内容 | 状态 |
|-------|---------|------|
| API Key 暴露 | .env 未提交到 git | ⏳ |
| SQL 注入 | 参数化查询 | ⏳ |
| XSS 防护 | 用户输入转义 | ⏳ |
| 速率限制 | API 有 rate_limit | ⏳ |
| 敏感数据 | 加密存储 | ⏳ |

---

## 📊 测试覆盖率目标

| 模块 | 覆盖率目标 | 当前状态 |
|------|----------|---------|
| 结果页 JS | 85% | ⏳ 待测 |
| 监控服务 | 90% | ⏳ 待测 |
| 告警系统 | 90% | ⏳ 待测 |
| 执行引擎 | 80% | ⏳ 待测 |

---

## 🐛 问题跟踪模板

| 问题 ID | 优先级 | 模块 | 问题描述 | 复现步骤 | 预期结果 | 实际结果 | 状态 |
|--------|-------|------|---------|---------|---------|---------|------|
| BUG-xxx | P0/P1/P2 | 模块名 | 描述 | 步骤 | 预期 | 实际 | 新建/修复/验证 |

---

## 📅 测试时间表

| 日期 | 测试内容 | 负责人 | 预计工时 |
|------|---------|--------|---------|
| Day 1 | P0 级功能测试 | 测试工程师 | 8h |
| Day 2 | P1 级功能测试 | 测试工程师 | 6h |
| Day 3 | P2 级功能测试 | 测试工程师 | 8h |
| Day 4 | 代码质量/安全检查 | 测试工程师 | 4h |
| Day 5 | 回归测试/报告 | 测试工程师 | 4h |

---

## ✅ 准入准出标准

### 准入标准
- [ ] 所有代码已提交并通过语法检查
- [ ] 测试环境已准备
- [ ] 测试数据已准备

### 准出标准
- [ ] P0 级测试用例 100% 通过
- [ ] P1 级测试用例 95% 通过
- [ ] P2 级测试用例 90% 通过
- [ ] 无 P0 级遗留 bug
- [ ] P1 级 bug < 5 个
- [ ] 代码质量检查通过

---

**文档维护：** 测试团队  
**最后更新：** 2026-02-26
