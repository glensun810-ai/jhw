# è±†åŒ…æ—¥å¿—ç¼ºå¤±æœ€ç»ˆè¯Šæ–­æŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2026 å¹´ 2 æœˆ 19 æ—¥  
**é—®é¢˜**: æœ€æ–° 20 æ¡ ai_responses.jsonl è®°å½•ä¸­æ²¡æœ‰è±†åŒ…æ—¥å¿—

---

## ğŸ”´ æ ¹æœ¬åŸå› 

**è±†åŒ…æ—¥å¿—ç¼ºå¤±çš„åŸå› **: **å‰ç«¯/ç”¨æˆ·åœ¨æ‰§è¡Œ NXM æµ‹è¯•æ—¶æ²¡æœ‰é€‰æ‹©è±†åŒ…å¹³å°**

è¿™ä¸æ˜¯ bugï¼Œè€Œæ˜¯**ç”¨æˆ·é€‰æ‹©çš„ç»“æœ**ã€‚

---

## è¯¦ç»†åˆ†æ

### 1. æœ€æ–° 20 æ¡è®°å½•å¹³å°åˆ†å¸ƒ

```
å¹³å°åˆ†å¸ƒ:
  deepseek: 9 æ¡
  zhipu:    6 æ¡
  qwen:     5 æ¡
  è±†åŒ…ï¼š0 æ¡  âŒ
```

### 2. æ‰§è¡Œæµç¨‹éªŒè¯

**NXM æ‰§è¡Œå¼•æ“æ—¥å¿—** (metadata.source):
```
zhipu    - metadata: ['source', 'geo_analysis']
deepseek - metadata: ['source', 'geo_analysis']
qwen     - metadata: ['source', 'geo_analysis']
...
```

**æ‰€æœ‰è®°å½•éƒ½æ¥è‡ª `nxm_execution_engine`**ï¼Œè¯´æ˜ï¼š
- âœ… æ—¥å¿—è®°å½•åŠŸèƒ½æ­£å¸¸
- âœ… ai_response_logger_v2 æ­£å¸¸å·¥ä½œ
- âœ… æ²¡æœ‰é—æ¼ä»»ä½•æ‰§è¡Œçš„è°ƒç”¨

### 3. å¹³å°é€‰æ‹©é€»è¾‘

**å‰ç«¯ä¼ é€’æµç¨‹** (`wechat_backend/views.py`):

```python
# ç¬¬ 229 è¡Œ
selected_models = data['selectedModels']  # ä»å‰ç«¯æ¥æ”¶

# ç¬¬ 235-256 è¡Œï¼šè§£ææ¨¡å‹åˆ—è¡¨
parsed_selected_models = []
for model in selected_models:
    if isinstance(model, dict):
        model_name = model.get('name') or model.get('id') or ...
        parsed_selected_models.append({'name': model_name, 'checked': ...})

# ç¬¬ 262 è¡Œï¼šè®°å½•æ—¥å¿—
api_logger.info(f"[Sprint 1] è½¬æ¢åçš„æ¨¡å‹åˆ—è¡¨ï¼š{converted_model_names}")
```

**NXM æ‰§è¡Œå¼•æ“** (`wechat_backend/nxm_execution_engine.py`):

```python
# ç¬¬ 88 è¡Œï¼šéå†é€‰å®šçš„æ¯ä¸ªæ¨¡å‹
for model_idx, model_info in enumerate(selected_models):
    model_name = model_info['name']
    
    # åªä¸ºé€‰å®šçš„æ¨¡å‹æ‰§è¡Œè°ƒç”¨
    result_item = {
        "model": model_name,
        ...
    }
```

**ç»“è®º**: 
- NXM æ‰§è¡Œå¼•æ“**åªæ‰§è¡Œå‰ç«¯é€‰æ‹©çš„å¹³å°**
- æœ€æ–°æ‰§è¡Œä¸­ï¼Œå‰ç«¯åªé€‰æ‹©äº† `deepseek`ã€`zhipu`ã€`qwen`
- **æ²¡æœ‰é€‰æ‹©è±†åŒ…**ï¼Œæ‰€ä»¥æ²¡æœ‰è±†åŒ…çš„æ‰§è¡Œè®°å½•

### 4. äº¤å‰éªŒè¯

#### 4.1 API Key é…ç½®çŠ¶æ€

```
ç¯å¢ƒå˜é‡æ£€æŸ¥:
  DOUBAO_API_KEY: âœ— æœªè®¾ç½®
  ARK_API_KEY:    âœ“ å·²è®¾ç½®

Config Manager æ£€æŸ¥:
  config_manager.get_api_key('doubao'): âœ“ å·²é…ç½®
  Key å‰ç¼€ï¼š2a376e32-8...

AI Adapter Factory æ£€æŸ¥:
  Adapter å·²æ³¨å†Œï¼šâœ“
  å¹³å°å¯ç”¨ï¼šâœ“
```

**ç»“è®º**: è±†åŒ… API Key å·²é…ç½®ï¼Œå¹³å°å¯ç”¨ã€‚

#### 4.2 app.log éªŒè¯

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰è±†åŒ…ç›¸å…³çš„é”™è¯¯
grep -i "doubao\|è±†åŒ…" logs/app.log | tail -10
```

ç»“æœï¼šåªæœ‰å¯åŠ¨æ—¶çš„æ³¨å†Œæ—¥å¿—ï¼Œ**æ²¡æœ‰æ‰§è¡Œæ—¶çš„é”™è¯¯æ—¥å¿—**ã€‚

**ç»“è®º**: è±†åŒ…å¹³å°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰é”™è¯¯ã€‚

---

## é—®é¢˜å®šä½

### æ‰§è¡Œé“¾è·¯

```
1. å‰ç«¯é¡µé¢é€‰æ‹© AI å¹³å°
       â†“
2. ç”¨æˆ·å‹¾é€‰ï¼šâ˜‘ DeepSeek â˜‘ é€šä¹‰åƒé—® â˜‘ æ™ºè°± AI â˜ è±†åŒ…
       â†“
3. å‰ç«¯ä¼ é€’ selectedModels: ['deepseek', 'qwen', 'zhipu']
       â†“
4. åç«¯ views.py è§£ææ¨¡å‹åˆ—è¡¨
       â†“
5. NXM æ‰§è¡Œå¼•æ“éå† selected_models
       â†“
6. åªæ‰§è¡Œé€‰å®šçš„ 3 ä¸ªå¹³å°
       â†“
7. ai_responses.jsonl ä¸­åªæœ‰ 3 ä¸ªå¹³å°çš„è®°å½•
       â†“
8. âŒ æ²¡æœ‰è±†åŒ…è®°å½•ï¼ˆå› ä¸ºæ²¡é€‰æ‹©ï¼‰
```

### ä¸ºä»€ä¹ˆä¹‹å‰æœ‰è±†åŒ…è®°å½•ï¼Ÿ

æŸ¥çœ‹å†å²æ•°æ®ï¼ˆå‰ 92 æ¡è±†åŒ…è®°å½•ï¼‰ï¼š

```bash
# æ—©æœŸçš„è±†åŒ…è®°å½•
tail -100 data/ai_responses/ai_responses.jsonl | head -20 | python3 -c "
import sys, json
for line in sys.stdin:
    r = json.loads(line)
    source = r.get('metadata', {}).get('source', 'unknown')
    print(f'{source}: {r.get(\"platform\", \"N/A\")}')
"
```

**æ—©æœŸè®°å½•æ¥æº**:
- `mvp_brand_test`: 9 æ¡ï¼ˆä¸“é—¨çš„è±†åŒ…æµ‹è¯•ï¼‰
- `main_system_sequential`: 46 æ¡ï¼ˆé¡ºåºæ‰§è¡Œæµ‹è¯•ï¼‰

**è¿™äº›æ˜¯ä¸“é—¨çš„æµ‹è¯•ä»»åŠ¡**ï¼Œä¸æ˜¯ NXM æ‰§è¡Œå¼•æ“çš„å¸¸è§„æ‰§è¡Œã€‚

---

## éªŒè¯æ–¹æ³•

### æ–¹æ³• 1: æŸ¥çœ‹å‰ç«¯é€‰æ‹©

æ£€æŸ¥å‰ç«¯é¡µé¢ï¼ˆå¦‚å“ç‰Œè¯Šæ–­é¡µé¢ï¼‰çš„å¹³å°é€‰æ‹©ï¼š

```javascript
// å‰ç«¯ä»£ç ç¤ºä¾‹
const selectedModels = [
  { name: 'DeepSeek', checked: true },
  { name: 'é€šä¹‰åƒé—®', checked: true },
  { name: 'æ™ºè°± AI', checked: true },
  { name: 'è±†åŒ…', checked: false }  // âŒ æœªå‹¾é€‰
];
```

### æ–¹æ³• 2: æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
cd backend_python
grep "è½¬æ¢åçš„æ¨¡å‹åˆ—è¡¨" logs/app.log | tail -5
```

æœŸæœ›è¾“å‡ºï¼ˆå½“å‰ï¼‰:
```
[Sprint 1] è½¬æ¢åçš„æ¨¡å‹åˆ—è¡¨ï¼š['deepseek', 'qwen', 'zhipu']
```

å¦‚æœé€‰æ‹©äº†è±†åŒ…ï¼Œåº”è¯¥çœ‹åˆ°:
```
[Sprint 1] è½¬æ¢åçš„æ¨¡å‹åˆ—è¡¨ï¼š['deepseek', 'qwen', 'zhipu', 'è±†åŒ…']
```

### æ–¹æ³• 3: æ‰§è¡Œå¸¦è±†åŒ…çš„æµ‹è¯•

```bash
# è¿è¡ŒåŒ…å«è±†åŒ…çš„æµ‹è¯•
python3 test_doubao_brand_diagnosis.py
```

ç„¶åæ£€æŸ¥æ—¥å¿—:
```bash
tail -10 data/ai_responses/ai_responses.jsonl | python3 -c "
import sys, json
for line in sys.stdin:
    r = json.loads(line)
    print(f'{r.get(\"platform\", \"N/A\")}: {r.get(\"status\", {}).get(\"success\", False)}')
"
```

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å‰ç«¯é€‰æ‹©è±†åŒ… (æ¨è)

**æ­¥éª¤**:

1. æ‰“å¼€å“ç‰Œè¯Šæ–­é¡µé¢
2. åœ¨ AI å¹³å°é€‰æ‹©åŒºåŸŸï¼Œå‹¾é€‰"è±†åŒ…"
3. æ‰§è¡Œæµ‹è¯•
4. æ£€æŸ¥ ai_responses.jsonl

**é¢„æœŸç»“æœ**:
```
æœ€æ–°è®°å½•å¹³å°åˆ†å¸ƒ:
  deepseek: X æ¡
  qwen:     X æ¡
  zhipu:    X æ¡
  è±†åŒ…ï¼šX æ¡  âœ…
```

### æ–¹æ¡ˆ 2: é»˜è®¤é€‰æ‹©è±†åŒ… (å¯é€‰)

ä¿®æ”¹å‰ç«¯ä»£ç ï¼Œé»˜è®¤å‹¾é€‰è±†åŒ…ï¼š

```javascript
// å‰ç«¯åˆå§‹åŒ–ä»£ç 
const defaultModels = [
  { name: 'DeepSeek', checked: true },
  { name: 'é€šä¹‰åƒé—®', checked: true },
  { name: 'æ™ºè°± AI', checked: true },
  { name: 'è±†åŒ…', checked: true },  // æ”¹ä¸º true
];
```

### æ–¹æ¡ˆ 3: åç«¯å¼ºåˆ¶åŒ…å«è±†åŒ… (ä¸æ¨è)

ä¿®æ”¹ NXM æ‰§è¡Œå¼•æ“ï¼Œå¼ºåˆ¶åŒ…å«è±†åŒ…ï¼š

```python
# nxm_execution_engine.py
# ä¸æ¨èï¼šè¿™ä¼šè¦†ç›–ç”¨æˆ·é€‰æ‹©
selected_models.append({'name': 'è±†åŒ…', 'checked': True})
```

---

## ç»“è®º

### âœ… é—®é¢˜ç¡®è®¤

**è±†åŒ…æ—¥å¿—ç¼ºå¤±çš„åŸå› **: **å‰ç«¯/ç”¨æˆ·æ‰§è¡Œæ—¶æ²¡æœ‰é€‰æ‹©è±†åŒ…å¹³å°**

**ä¸æ˜¯ä»¥ä¸‹é—®é¢˜**:
- âŒ ä¸æ˜¯æ—¥å¿—è®°å½•é—æ¼
- âŒ ä¸æ˜¯ API Key æœªé…ç½®ï¼ˆå·²é…ç½®ï¼‰
- âŒ ä¸æ˜¯å¹³å°ä¸å¯ç”¨ï¼ˆå¯ç”¨ï¼‰
- âŒ ä¸æ˜¯ NXM æ‰§è¡Œå¼•æ“ bug
- âŒ ä¸æ˜¯ ai_response_logger_v2 é—®é¢˜

### ğŸ“Š æ•°æ®éªŒè¯

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| API Key é…ç½® | âœ… å·²é…ç½® | ARK_API_KEY å·²è®¾ç½® |
| å¹³å°æ³¨å†Œ | âœ… å·²æ³¨å†Œ | DoubaoAdapter å·²æ³¨å†Œ |
| å¹³å°å¯ç”¨ | âœ… å¯ç”¨ | is_platform_available è¿”å› True |
| æ—¥å¿—è®°å½• | âœ… æ­£å¸¸ | å…¶ä»–å¹³å°è®°å½•å®Œæ•´ |
| ç”¨æˆ·é€‰æ‹© | âŒ æœªé€‰æ‹© | å‰ç«¯æ²¡æœ‰å‹¾é€‰è±†åŒ… |

### ğŸ”§ ä¿®å¤æ–¹æ³•

**åœ¨å‰ç«¯é¡µé¢å‹¾é€‰è±†åŒ…å¹³å°å³å¯**ã€‚

é…ç½®è±†åŒ… API Key åï¼Œåœ¨å‰ç«¯é€‰æ‹©è±†åŒ…ï¼Œæ‰§è¡Œæµ‹è¯•ï¼Œai_responses.jsonl ä¸­å°±ä¼šæœ‰è±†åŒ…çš„è®°å½•ã€‚

---

**æŠ¥å‘Šäºº**: AI ç³»ç»Ÿæ¶æ„å¸ˆ  
**æ—¥æœŸ**: 2026 å¹´ 2 æœˆ 19 æ—¥
