# 页面过渡动画系统使用文档

## 概述

本项目已集成完整的页面过渡动画系统，为微信小程序提供流畅的页面切换体验。

## 文件结构

```
/
├── app.wxss                          # 全局样式（包含过渡动画类）
├── app.js                            # 应用入口（初始化动画系统）
├── styles/
│   └── transition.wxss               # 过渡动画样式库
├── utils/
│   └── page-transition.js            # 页面过渡动画工具
└── services/
    └── navigationService.js          # 导航服务（集成动画）
```

## 可用动画类型

### 1. 淡入淡出系列
- `fade` - 淡入淡出 + 轻微缩放

### 2. 滑动系列
- `slide-left` - 从右向左滑入（前进导航）
- `slide-right` - 从左向右滑入（后退导航）
- `slide-up` - 从下向上滑入
- `slide-down` - 从上向下滑入

### 3. 缩放系列
- `zoom` - 放大呈现
- `zoom-out` - 缩小消失

### 4. 旋转系列
- `rotate` - 旋转进入

### 5. 3D 翻转系列
- `flip-y` - Y 轴翻转
- `flip-x` - X 轴翻转

### 6. 弹性系列
- `bounce` - 弹性进入

## 使用方法

### 方法 1: 使用导航服务（推荐）

导航服务已自动集成页面过渡动画：

```javascript
const {
  saveAndNavigateToResults,
  navigateToDashboard,
  navigateToReportDetail,
  navigateToHistory,
  navigateToConfigManager,
  navigateToPermissionManager,
  navigateToDataManager,
  navigateToUserGuide
} = require('../../services/navigationService');

// 直接使用，自动带有过渡动画
navigateToHistory();
navigateToConfigManager();
```

### 方法 2: 直接使用 PageTransition 工具

```javascript
const { PageTransition, ANIMATION_TYPES } = require('../../utils/page-transition');

// 前进导航（默认 slide-left 动画）
PageTransition.navigateTo('/pages/index/index');

// 指定动画类型
PageTransition.navigateTo('/pages/index/index', ANIMATION_TYPES.SLIDE_UP);

// 返回上一页（默认 slide-right 动画）
PageTransition.navigateBack();

// 重定向
PageTransition.redirectTo('/pages/index/index', ANIMATION_TYPES.FADE);

// 切换 Tab
PageTransition.switchTab('/pages/index/index');
```

### 方法 3: 在页面中自定义动画

```javascript
Page({
  data: {
    pageTransitionClass: '',
    pageLoaded: false
  },

  onLoad() {
    this.applyPageEnterAnimation();
  },

  applyPageEnterAnimation() {
    setTimeout(() => {
      this.setData({
        pageTransitionClass: 'fade-enter-active',
        pageLoaded: true
      });
    }, 50);
  }
});
```

## WXML 模板结构

在页面根元素添加过渡动画包装器：

```xml
<!-- 页面过渡动画包装器 -->
<view class="page-transition-container {{pageTransitionClass}}">
  <view class="page-container container {{pageLoaded ? 'loaded' : ''}}">
    <!-- 页面内容 -->
  </view>
</view>
```

## WXSS 样式导入

在页面样式文件中导入全局动画样式：

```css
/* 导入全局过渡动画样式 */
@import "../../app.wxss";

.page-container {
  /* 页面样式 */
}

/* 页面加载动画 */
.page-container.loaded {
  animation: pageEnter 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes pageEnter {
  from {
    opacity: 0;
    transform: translateY(30rpx);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

## 动画配置

### 修改默认动画

在 `app.js` 的 `onLaunch` 中配置：

```javascript
const { PageTransition, ANIMATION_TYPES } = require('./utils/page-transition');

PageTransition.setDefaultAnimation(ANIMATION_TYPES.SLIDE_LEFT);
PageTransition.setBackAnimation(ANIMATION_TYPES.SLIDE_RIGHT);
```

### 动画时长配置

```javascript
const ANIMATION_DURATION = {
  FAST: 200,    // 快速动画
  NORMAL: 350,  // 标准动画
  SLOW: 500     // 慢速动画
};
```

## 已集成页面

以下页面已自动集成页面过渡动画：

- ✅ `pages/index/index` - 首页
- ✅ `pages/results/results` - 结果页
- ✅ 所有通过 `navigationService` 导航的页面

## 无障碍支持

系统自动检测用户的无障碍偏好，对于选择"减少动画"的用户，会自动禁用所有过渡动画：

```css
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

## 性能优化建议

1. **避免动画叠加**: 同一时间只应用一个动画类
2. **使用 transform**: 优先使用 `transform` 而非 `top/left` 等属性
3. **合理使用 opacity**: `opacity` 是性能最好的动画属性之一
4. **避免强制重排**: 不要在动画过程中读取布局属性

## 调试技巧

在控制台查看动画系统日志：

```javascript
// 在 app.js 中
onLaunch() {
  this.initPageTransition(); // 会输出 "✅ 页面过渡动画系统已初始化"
}
```

导航时会输出：
```
[PageTransition] 导航到：/pages/index/index, 动画：slide-left
```

## 常见问题

### Q: 动画卡顿怎么办？
A: 检查是否同时应用了多个动画类，确保动画时长合理（200-500ms）。

### Q: 如何禁用某个页面的动画？
A: 在该页面的 `onLoad` 中不调用 `applyPageEnterAnimation()`，或设置 `pageTransitionClass` 为空。

### Q: 如何自定义动画？
A: 在 `styles/transition.wxss` 中添加新的动画类，然后在导航时指定自定义动画类型。

## 更新日志

- **2026-02-28**: 初始版本
  - 实现 6 大类 15 种过渡动画
  - 集成到导航服务
  - 支持无障碍偏好
  - 自动初始化系统
