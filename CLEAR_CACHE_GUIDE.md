# 🧹 清除小程序缓存操作指南

## 为什么需要清除缓存？

微信小程序会缓存编译后的代码，导致：
- ✅ 新修复的代码未生效
- ❌ 旧的错误仍然存在
- ❌ 新功能无法使用

---

## 操作步骤

### 方法 1: 微信开发者工具（推荐）

```
步骤 1: 打开微信开发者工具

步骤 2: 点击菜单栏
       工具 → 清除缓存 → 清除全部缓存
       
       或点击工具栏的"清缓存"按钮

步骤 3: 等待清理完成（约 3 秒）

步骤 4: 点击"编译"按钮重新编译

步骤 5: 测试功能
       - 诊断任务轮询
       - 历史记录加载
       - 按钮点击响应
```

**示意图**:
```
微信开发者工具
    ↓
工具 (菜单)
    ↓
清除缓存
    ↓
清除全部缓存 ✅
    ↓
编译
```

---

### 方法 2: 手动删除缓存目录

```
步骤 1: 找到项目目录
       /Users/sgl/PycharmProjects/PythonProject

步骤 2: 删除以下目录（如果存在）
       - .ide/
       - .miniprogram/
       - nodes/

步骤 3: 重新编译
```

**命令**:
```bash
cd /Users/sgl/PycharmProjects/PythonProject
rm -rf .ide .miniprogram nodes
# 然后在微信开发者工具中重新编译
```

---

### 方法 3: 真机调试

```
步骤 1: 关闭小程序
       在微信中完全关闭小程序（不是最小化）

步骤 2: 清除小程序缓存
       微信 → 发现 → 小程序
       → 长按"云程企航" → 删除
       
步骤 3: 重新扫码
       使用微信扫描开发者工具中的二维码

步骤 4: 测试功能
```

---

## 验证清除成功

清除缓存后，测试以下功能：

### ✅ 诊断任务测试

```
1. 打开首页
2. 输入品牌名称（华为）
3. 添加竞品（小米、特斯拉、比亚迪）
4. 选择 AI 平台（应显示 8 个国内 +5 个海外）
5. 输入问题（30 万预算的新能源汽车推荐）
6. 点击"AI 品牌战略诊断"
7. 观察控制台日志
   - ✅ 应显示 "使用 wx.request"
   - ❌ 不应显示 "fetch is not a function"
8. 等待诊断完成
9. 查看完整报告
```

### ✅ 历史记录测试

```
1. 点击底部"历史记录"标签
2. 观察控制台日志
   - ✅ 应正常加载历史记录
   - ❌ 不应显示 404 错误
3. 点击"查看最新结果"按钮
   - ✅ 应跳转到结果页面
4. 点击历史条目
   - ✅ 应查看详情
```

### ✅ 按钮功能测试

```
历史记录页面：
- 点击"立即进行一次诊断" → 跳转首页 ✅
- 点击"查看已保存结果" → 显示列表 ✅
- 点击"查看公共历史" → 显示提示 ✅
- 点击"查看个人历史" → 刷新列表 ✅
```

---

## 常见问题

### Q1: 清除缓存后仍然报错？

**A**: 尝试以下操作：
1. 完全关闭微信开发者工具
2. 重新打开项目
3. 再次清除缓存
4. 重新编译

### Q2: 真机调试仍然有问题？

**A**: 
1. 删除小程序（长按 → 删除）
2. 重新扫码登录
3. 测试功能

### Q3: 如何确认缓存已清除？

**A**: 查看控制台日志：
- ✅ 应显示 "使用 wx.request"
- ❌ 不应显示 "fetch is not a function"

---

## 预期效果

清除缓存后，所有修复将生效：

| 功能 | 清除前 | 清除后 |
|------|--------|--------|
| 诊断轮询 | ❌ fetch 错误 | ✅ 正常轮询 |
| 历史记录 | ❌ 404 错误 | ✅ 正常加载 |
| 按钮点击 | ❌ 方法缺失 | ✅ 正常响应 |
| 完整报告 | ❌ 无法查看 | ✅ 完整查看 |

---

## 总结

**核心操作**:
```
清除缓存 → 重新编译 → 测试验证
```

**预期结果**:
- ✅ 客户可完整查看品牌洞察报告
- ✅ 无错误完成诊断流程
- ✅ 流畅的用户体验

---

**指南版本**: 1.0  
**更新时间**: 2026-02-26  
**适用版本**: 微信开发者工具 最新版
