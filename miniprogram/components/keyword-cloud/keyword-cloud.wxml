<!--
  å…³é”®è¯äº‘ç»„ä»¶æ¨¡æ¿

  æ”¯æŒè¯äº‘å’Œåˆ—è¡¨ä¸¤ç§å±•ç¤ºæ¨¡å¼
  åŒ…å«å…³é”®è¯ç»Ÿè®¡å’Œè¯¦æƒ…å±•ç¤º
-->

<view class="keyword-cloud {{displayMode}}">
  <!-- æ ‡é¢˜æ  -->
  <view class="header">
    <text class="title">{{title}}</text>
    <view class="actions">
      <text class="stats-info" wx:if="{{hasData}}">
        {{stats.totalKeywords}}ä¸ªå…³é”®è¯
      </text>
      <text class="toggle-btn" bindtap="onToggleDisplayMode">
        {{displayMode === 'cloud' ? 'åˆ—è¡¨' : 'è¯äº‘'}}
      </text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{!hasData}}">
    <image class="empty-icon" src="/images/empty-data.png" mode="aspectFit"></image>
    <text class="empty-text">{{errorMessage || 'æš‚æ— æ•°æ®'}}</text>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card" wx:if="{{hasData}}">
    <view class="stat-item">
      <text class="stat-value positive">{{stats.positiveCount}}</text>
      <text class="stat-label">æ­£é¢</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value neutral">{{stats.neutralCount}}</text>
      <text class="stat-label">ä¸­æ€§</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value negative">{{stats.negativeCount}}</text>
      <text class="stat-label">è´Ÿé¢</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value avg">{{stats.avgSentiment}}</text>
      <text class="stat-label">å¹³å‡æƒ…æ„Ÿ</text>
    </view>
  </view>

  <!-- è¯äº‘æ¨¡å¼ -->
  <view class="cloud-container" wx:if="{{displayMode === 'cloud' && hasData}}">
    <view class="cloud-wrapper">
      <view 
        class="cloud-word"
        wx:for="{{cloudLayout}}"
        wx:key="word"
        data-index="{{index}}"
        bindtap="onKeywordTap"
        bindlongpress="onKeywordLongPress"
        style="
          left: {{item.x}}px;
          top: {{item.y}}px;
          font-size: {{item.fontSize}}rpx;
          color: {{item.color}};
        "
      >
        {{item.word}}
      </view>
    </view>
  </view>

  <!-- åˆ—è¡¨æ¨¡å¼ -->
  <view class="list-container" wx:elif="{{hasData}}">
    <view 
      class="list-item"
      wx:for="{{processedKeywords}}"
      wx:key="word"
      data-index="{{index}}"
      bindtap="onKeywordTap"
      bindlongpress="onKeywordLongPress"
    >
      <view class="list-left">
        <text class="list-rank">{{index + 1}}</text>
        <text class="list-word">{{item.word}}</text>
        <text class="list-sentiment {{getSentimentClass(item.sentiment)}}">
          {{getSentimentLabel(item.sentiment)}}
        </text>
      </view>
      <view class="list-right">
        <view class="list-bar">
          <view 
            class="list-bar-fill"
            style="width: {{(item.count / processedKeywords[0].count * 100)}}%;"
          ></view>
        </view>
        <text class="list-count" wx:if="{{showCount}}">{{item.count}}</text>
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­å…³é”®è¯è¯¦æƒ… -->
  <view class="selected-overlay" wx:if="{{selectedKeyword}}" bindtap="closeSelected">
    <view class="selected-card" catchtap="closeSelected">
      <view class="selected-header">
        <text class="selected-word">{{selectedKeyword.word}}</text>
        <text class="selected-close">âœ•</text>
      </view>
      <view class="selected-content">
        <view class="selected-row">
          <text class="selected-label">å‡ºç°æ¬¡æ•°</text>
          <text class="selected-value">{{selectedKeyword.count}}æ¬¡</text>
        </view>
        <view class="selected-row">
          <text class="selected-label">æƒ…æ„Ÿå€¾å‘</text>
          <text class="selected-value {{getSentimentClass(selectedKeyword.sentiment)}}">
            {{getSentimentLabel(selectedKeyword.sentiment)}}
          </text>
        </view>
        <view class="selected-row">
          <text class="selected-label">æƒ…æ„Ÿå¾—åˆ†</text>
          <text class="selected-value">{{selectedKeyword.sentiment}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è­¦å‘Šæç¤º -->
  <view class="warning-tip" wx:if="{{warningMessage}}">
    <text class="warning-icon">âš ï¸</text>
    <text class="warning-text">{{warningMessage}}</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{hasData}}">
    <button class="action-btn" bindtap="exportImage">
      <text class="btn-icon">ğŸ“·</text>
      <text class="btn-text">ä¿å­˜å›¾ç‰‡</text>
    </button>
  </view>
</view>
