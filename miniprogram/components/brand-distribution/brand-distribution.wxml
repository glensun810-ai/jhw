<!--
  å“ç‰Œåˆ†å¸ƒç»„ä»¶æ¨¡æ¿

  æ”¯æŒé¥¼å›¾å’ŒæŸ±çŠ¶å›¾ä¸¤ç§å±•ç¤ºæ–¹å¼
  åŒ…å«åŠ è½½çŠ¶æ€ã€ç©ºçŠ¶æ€å’Œé”™è¯¯å¤„ç†
-->

<view class="brand-distribution {{chartType}}">
  <!-- æ ‡é¢˜æ  -->
  <view class="header">
    <text class="title">{{title}}</text>
    <view class="actions">
      <text class="total-count" wx:if="{{hasData && distributionData.total_count}}">
        æ€»è®¡ï¼š{{distributionData.total_count}}æ¡
      </text>
      <text class="toggle-btn" bindtap="onToggleChartType">
        {{chartType === 'pie' ? 'åˆ‡æ¢æŸ±çŠ¶å›¾' : 'åˆ‡æ¢é¥¼å›¾'}}
      </text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{!hasData}}">
    <image class="empty-icon" src="/images/empty-data.png" mode="aspectFit"></image>
    <text class="empty-text">{{errorMessage || 'æš‚æ— æ•°æ®'}}</text>
  </view>

  <!-- å›¾è¡¨å†…å®¹ -->
  <view class="chart-container" wx:else>
    <!-- é¥¼å›¾æ¨¡å¼ -->
    <view class="pie-chart" wx:if="{{chartType === 'pie'}}">
      <!-- ä½¿ç”¨ canvas ç»˜åˆ¶é¥¼å›¾ -->
      <canvas 
        type="2d" 
        class="chart-canvas"
        id="pieChartCanvas"
        style="width: {{chartConfig.width}}px; height: {{chartConfig.height}}px;"
      ></canvas>
      
      <!-- å›¾ä¾‹ -->
      <view class="legend" wx:if="{{showLegend}}">
        <view 
          class="legend-item" 
          wx:for="{{chartData}}" 
          wx:key="name"
          data-index="{{index}}"
          bindtap="onBrandTap"
        >
          <view class="legend-color" style="background-color: {{item.color}};"></view>
          <text class="legend-name">{{item.name}}</text>
          <text class="legend-value" wx:if="{{showLabels}}">{{item.value}}%</text>
        </view>
      </view>
    </view>

    <!-- æŸ±çŠ¶å›¾æ¨¡å¼ -->
    <view class="bar-chart" wx:else>
      <view class="bars-container">
        <view 
          class="bar-item" 
          wx:for="{{chartData}}" 
          wx:key="name"
          data-index="{{index}}"
          bindtap="onBrandTap"
        >
          <view class="bar-label">{{item.name}}</view>
          <view class="bar-wrapper">
            <view 
              class="bar-fill" 
              style="width: {{item.value}}%; background-color: {{item.color}};"
            ></view>
          </view>
          <view class="bar-value" wx:if="{{showLabels}}">{{item.value}}%</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è­¦å‘Šæç¤º -->
  <view class="warning-tip" wx:if="{{distributionData.warning && hasData}}">
    <text class="warning-icon">âš ï¸</text>
    <text class="warning-text">{{distributionData.warning}}</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{hasData}}">
    <button class="action-btn" bindtap="exportImage">
      <text class="btn-icon">ğŸ“·</text>
      <text class="btn-text">ä¿å­˜å›¾ç‰‡</text>
    </button>
  </view>
</view>
