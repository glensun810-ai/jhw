<!--
  æƒ…æ„Ÿåˆ†å¸ƒç»„ä»¶æ¨¡æ¿

  æ”¯æŒé¥¼å›¾å’Œç¯å½¢å›¾ä¸¤ç§å±•ç¤ºæ–¹å¼
  åŒ…å«æƒ…æ„Ÿå¾—åˆ†å’Œè¯¦ç»†ç»Ÿè®¡
-->

<view class="sentiment-chart {{chartType}}">
  <!-- æ ‡é¢˜æ  -->
  <view class="header">
    <text class="title">{{title}}</text>
    <view class="actions">
      <text class="total-count" wx:if="{{hasData && distributionData.total_count}}">
        æ ·æœ¬ï¼š{{distributionData.total_count}}
      </text>
      <text class="toggle-btn" bindtap="onToggleChartType">
        {{chartType === 'pie' ? 'ç¯å½¢å›¾' : 'é¥¼å›¾'}}
      </text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{!hasData}}">
    <image class="empty-icon" src="/images/empty-data.png" mode="aspectFit"></image>
    <text class="empty-text">{{errorMessage || 'æš‚æ— æ•°æ®'}}</text>
  </view>

  <!-- å›¾è¡¨å†…å®¹ -->
  <view class="chart-container" wx:else>
    <!-- æƒ…æ„Ÿæ¦‚è§ˆå¡ç‰‡ -->
    <view class="sentiment-overview">
      <view class="overview-icon">{{sentimentLevel === 'positive' ? 'ğŸ˜Š' : sentimentLevel === 'negative' ? 'ğŸ˜Ÿ' : 'ğŸ˜'}}</view>
      <view class="overview-content">
        <text class="overview-label">æ•´ä½“æƒ…æ„Ÿå€¾å‘</text>
        <text class="overview-value" style="color: {{sentimentLevel === 'positive' ? '#28a745' : sentimentLevel === 'negative' ? '#dc3545' : '#6c757d'}};">
          {{sentimentLevel === 'positive' ? 'ç§¯ææ­£é¢' : sentimentLevel === 'negative' ? 'æ¶ˆæè´Ÿé¢' : 'ä¸­æ€§å¹³å’Œ'}}
        </text>
      </view>
      <view class="overview-score">
        <text class="score-value">{{sentimentScore > 0 ? '+' : ''}}{{sentimentScore}}</text>
        <text class="score-label">æƒ…æ„Ÿå¾—åˆ†</text>
      </view>
    </view>

    <!-- ç¯å½¢å›¾/é¥¼å›¾ -->
    <view class="chart-wrapper">
      <!-- ç¯å½¢å›¾æ¨¡å¼ -->
      <view class="donut-chart" wx:if="{{chartType === 'donut'}}">
        <view class="donut-outer">
          <!-- ä½¿ç”¨ CSS æ¸å˜æ¨¡æ‹Ÿç¯å½¢å›¾ -->
          <view 
            class="donut-ring"
            style="background: conic-gradient(
              {{chartData[0].color}} 0% {{chartData[0].value}}%,
              {{chartData[1].color}} {{chartData[0].value}}% {{chartData[0].value + chartData[1].value}}%,
              {{chartData[2].color}} {{chartData[0].value + chartData[1].value}}% 100%
            );"
          ></view>
          <!-- ä¸­å¿ƒç»Ÿè®¡ -->
          <view class="donut-center" wx:if="{{showCenterStat}}">
            <text class="center-total">{{distributionData.total_count}}</text>
            <text class="center-label">æ€»æ ·æœ¬</text>
          </view>
        </view>
      </view>

      <!-- é¥¼å›¾æ¨¡å¼ -->
      <view class="pie-chart" wx:else>
        <view 
          class="pie-outer"
          style="background: conic-gradient(
            {{chartData[0].color}} 0% {{chartData[0].value}}%,
            {{chartData[1].color}} {{chartData[0].value}}% {{chartData[0].value + chartData[1].value}}%,
            {{chartData[2].color}} {{chartData[0].value + chartData[1].value}}% 100%
          );"
        ></view>
      </view>
    </view>

    <!-- è¯¦ç»†æ•°æ® -->
    <view class="details-section" wx:if="{{showDetails}}">
      <view 
        class="detail-item" 
        wx:for="{{chartData}}" 
        wx:key="key"
        data-index="{{index}}"
        bindtap="onSentimentTap"
      >
        <view class="detail-left">
          <text class="detail-icon">{{item.icon}}</text>
          <text class="detail-name">{{item.name}}</text>
        </view>
        <view class="detail-right">
          <view class="detail-bar">
            <view 
              class="detail-bar-fill" 
              style="width: {{item.value}}%; background-color: {{item.color}};"
            ></view>
          </view>
          <text class="detail-value">{{item.value}}%</text>
        </view>
      </view>
    </view>

    <!-- æƒ…æ„Ÿæè¿° -->
    <view class="description-section">
      <text class="description-text">{{getSentimentDescription()}}</text>
    </view>
  </view>

  <!-- è­¦å‘Šæç¤º -->
  <view class="warning-tip" wx:if="{{distributionData.warning && hasData}}">
    <text class="warning-icon">âš ï¸</text>
    <text class="warning-text">{{distributionData.warning}}</text>
  </view>
</view>
