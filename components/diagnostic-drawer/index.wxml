<!--
  è¯¦æƒ…æŠ½å±‰ç»„ä»¶ - è¯Šæ–­é—®é¢˜è¯¦æƒ…å±•ç¤º
  
  ç‰¹æ€§ï¼š
  - ä»åº•éƒ¨æ»‘å‡ºçš„æŠ½å±‰æ•ˆæœ
  - åˆ†ç‰‡æ¸²æŸ“é•¿æ–‡æœ¬ï¼ˆæ¯ 100ms æ¸²æŸ“ 200 å­—ï¼‰
  - å…³é”®è¯è¯­ä¹‰åŒ–é«˜äº®
  - ä¿¡æºå¼•ç”¨å…³è”
  - å¤šæ¨¡å‹æ¨ªå‘å¯¹æ¯”
  - æ‰‹åŠ¿ä¸‹æ‹‰å…³é—­
  - è§¦æ„Ÿåé¦ˆ
-->

<view class="drawer-mask {{showDrawer ? 'show' : ''}}" catchtouchmove="preventDefault" bindtap="closeDrawer"></view>

<view 
  class="drawer-container {{showDrawer ? 'show' : ''}}" 
  style="transform: translateY({{drawerOffset}}%)"
  catchtouchmove="onDrawerTouchMove"
  bindtouchstart="onDrawerTouchStart"
  bindtouchend="onDrawerTouchEnd"
>
  <!-- ç²˜æ€§å¤´éƒ¨ï¼šæ ¸å¿ƒæŒ‡æ ‡æ‘˜è¦ -->
  <view class="drawer-header sticky-header">
    <view class="header-content">
      <view class="header-metrics">
        <view class="metric-item">
          <text class="metric-label">å¹³å‡æ’å</text>
          <text class="metric-value {{avgRank > 5 ? 'critical' : avgRank > 3 ? 'warning' : 'safe'}}">{{avgRank}}</text>
        </view>
        <view class="metric-item">
          <text class="metric-label">æƒ…æ„ŸæŒ‡æ•°</text>
          <text class="metric-value sentiment-{{sentimentStatus}}">{{sentimentValue}}</text>
        </view>
        <view class="metric-item">
          <text class="metric-label">é£é™©ç­‰çº§</text>
          <text class="metric-value risk-{{riskLevel}}">{{riskLevelText}}</text>
        </view>
      </view>
      
      <!-- å…³é—­æŒ‰é’® -->
      <view class="close-btn" bindtap="closeDrawer" hover-class="close-btn-hover">
        <text class="close-icon">âœ•</text>
      </view>
    </view>
    
    <!-- æ‹–åŠ¨æ‰‹æŸ„ -->
    <view class="drag-handle"></view>
  </view>
  
  <!-- å¤šæ¨¡å‹åˆ‡æ¢ Segmented Control -->
  <view class="model-segmented-control">
    <scroll-view scroll-x class="model-scroll" scroll-into-view="model-{{currentModelId}}">
      <view class="model-list">
        <view 
          wx:for="{{modelList}}" 
          wx:key="id"
          id="model-{{item.id}}"
          class="model-tab {{currentModelId === item.id ? 'active' : ''}} {{item.isAnomaly ? 'anomaly' : ''}}"
          bindtap="switchModel"
          data-model="{{item}}"
          hover-class="model-tab-hover"
        >
          <text class="model-name">{{item.name}}</text>
          <text class="model-rank" wx:if="{{item.rank}}">æ’åï¼š{{item.rank}}</text>
          <view class="anomaly-badge" wx:if="{{item.isAnomaly}}">
            <text class="anomaly-icon">âš ï¸</text>
            <text class="anomaly-text">å¼‚å¸¸</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- å†…å®¹åŒºåŸŸï¼šåˆ†ç‰‡æ¸²æŸ“çš„ AI å›ç­” -->
  <view class="drawer-content">
    <view class="content-scroll">
      <!-- é—®é¢˜æ–‡æœ¬ -->
      <view class="question-section">
        <text class="question-label">è¯Šæ–­é—®é¢˜ï¼š</text>
        <text class="question-text">{{currentQuestionData.question_text}}</text>
      </view>
      
      <!-- AI å›ç­”å†…å®¹ï¼šåˆ†ç‰‡æ¸²æŸ“ -->
      <view class="answer-section">
        <view class="answer-header">
          <text class="answer-model">{{currentModelName}} AI åˆ†æ</text>
          <view class="rendering-indicator {{isRendering ? 'active' : ''}}">
            <text class="cursor-blink">|</text>
            <text class="rendering-text">{{renderingText}}</text>
          </view>
        </view>
        
        <!-- ã€ä»»åŠ¡ 2ã€‘éª¨æ¶å±å ä½ -->
        <view class="skeleton-container {{showSkeleton ? 'show' : 'hide'}}">
          <view class="skeleton-line"></view>
          <view class="skeleton-line"></view>
          <view class="skeleton-line short"></view>
          <view class="skeleton-line"></view>
          <view class="skeleton-line"></view>
          <view class="skeleton-line short"></view>
        </view>
        
        <!-- åˆ†ç‰‡æ¸²æŸ“çš„å†…å®¹èŠ‚ç‚¹ -->
        <view class="answer-content {{showSkeleton ? 'hidden' : ''}}">
          <view wx:for="{{renderedNodes}}" wx:key="index" class="content-chunk">
            <rich-text 
              nodes="{{item.html}}" 
              class="chunk-text"
              bindtap="onContentTap"
            ></rich-text>
          </view>
        </view>
        
        <!-- ä¿¡æºè¯æ®åŒº -->
        <view class="sources-section" wx:if="{{sourceList.length > 0}}">
          <view class="section-title">
            <text class="title-icon">ğŸ“š</text>
            <text class="title-text">ä¿¡æºè¯æ® ({{sourceList.length}})</text>
          </view>
          
          <view class="source-list">
            <view 
              wx:for="{{sourceList}}" 
              wx:key="url"
              class="source-card attitude-{{item.attitude}}"
              bindtap="onSourceTap"
              data-source="{{item}}"
              hover-class="source-card-hover"
            >
              <view class="source-header">
                <text class="source-site">{{item.site_name}}</text>
                <text class="source-badge {{item.attitude}}">{{attitudeTextMap[item.attitude]}}</text>
              </view>
              <text class="source-url">{{item.url}}</text>
              <view class="source-meta" wx:if="{{item.mention_count}}">
                <text class="meta-item">æåŠ {{item.mention_count}} æ¬¡</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å›¾ç‰‡æ‡’åŠ è½½å®¹å™¨ï¼ˆä¼˜é›…é™çº§ï¼‰ -->
        <view class="image-container" wx:if="{{imageList.length > 0}}">
          <image 
            wx:for="{{imageList}}" 
            wx:key="url"
            src="{{item.url}}" 
            mode="widthFix"
            lazy-load="{{true}}"
            class="lazy-image"
            style="height: {{item.height || 200}}px"
            binderror="onImageError"
            bindload="onImageLoad"
          ></image>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="drawer-footer">
    <view class="footer-actions">
      <view class="action-btn" bindtap="onCopyLink" hover-class="action-btn-hover">
        <text class="action-icon">ğŸ“‹</text>
        <text class="action-text">å¤åˆ¶é“¾æ¥</text>
      </view>
      <view class="action-btn" bindtap="onShare" hover-class="action-btn-hover">
        <text class="action-icon">ğŸ“¤</text>
        <text class="action-text">åˆ†äº«</text>
      </view>
      <view class="action-btn" bindtap="onSave" hover-class="action-btn-hover">
        <text class="action-icon">ğŸ’¾</text>
        <text class="action-text">ä¿å­˜</text>
      </view>
    </view>
  </view>
</view>
