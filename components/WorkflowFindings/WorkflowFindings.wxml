<!--components/WorkflowFindings/WorkflowFindings.wxml-->
<!--
  P0 çº§ç©ºç¼ºä¿®å¤ï¼šå·¥ä½œæµå‘ç°åˆ—è¡¨ç»„ä»¶
  P1 ä¿®å¤ï¼šä½¿ç”¨ safeStages æ•°æ®ï¼Œé¿å…å¤æ‚è¡¨è¾¾å¼

  å±•ç¤ºå†…å®¹:
  - 4 é˜¶æ®µå·¥ä½œæµçŠ¶æ€
  - å„é˜¶æ®µå…³é”®å‘ç°
  - é—®é¢˜å’Œå»ºè®®åˆ—è¡¨
-->
<view class="workflow-findings">
  <!-- ç»„ä»¶æ ‡é¢˜ -->
  <view class="workflow-findings__header">
    <view class="workflow-findings__title">
      <text class="workflow-findings__icon">ğŸ”</text>
      <text class="workflow-findings__title-text">{{title}}</text>
    </view>
    <view class="workflow-findings__subtitle" wx:if="{{subtitle}}">{{subtitle}}</view>
  </view>

  <!-- å·¥ä½œæµé˜¶æ®µ -->
  <view class="workflow-findings__stages">
    <!-- é˜¶æ®µ 1: è¯„ä¼° -->
    <view class="workflow-findings__stage {{safeStages.intelligence_evaluating.status === 'completed' ? 'completed' : ''}}">
      <view class="workflow-findings__stage-header">
        <view class="workflow-findings__stage-icon">ğŸ“‹</view>
        <view class="workflow-findings__stage-info">
          <text class="workflow-findings__stage-name">è¯„ä¼°é˜¶æ®µ</text>
          <text class="workflow-findings__stage-status">
            {{safeStages.intelligence_evaluating.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
          </text>
        </view>
      </view>
      <view class="workflow-findings__stage-content" wx:if="{{expandedStage === 'evaluating' || expandAll}}">
        <view class="workflow-findings__metrics">
          <view class="workflow-findings__metric-item">
            <text class="workflow-findings__metric-label">æƒå¨æ€§</text>
            <text class="workflow-findings__metric-value {{getScoreClass(safeStages.intelligence_evaluating.metrics.authority_score)}}">
              {{safeStages.intelligence_evaluating.metrics.authority_score.toFixed(0)}}
            </text>
          </view>
          <view class="workflow-findings__metric-item">
            <text class="workflow-findings__metric-label">å®Œæ•´åº¦</text>
            <text class="workflow-findings__metric-value {{getScoreClass(safeStages.intelligence_evaluating.metrics.completeness_score)}}">
              {{safeStages.intelligence_evaluating.metrics.completeness_score.toFixed(0)}}
            </text>
          </view>
          <view class="workflow-findings__metric-item">
            <text class="workflow-findings__metric-label">æ—¶æ•ˆæ€§</text>
            <text class="workflow-findings__metric-value {{getScoreClass(safeStages.intelligence_evaluating.metrics.timeliness_score)}}">
              {{safeStages.intelligence_evaluating.metrics.timeliness_score.toFixed(0)}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- é˜¶æ®µ 2: åˆ†æ -->
    <view class="workflow-findings__stage {{safeStages.intelligence_analyzing.status === 'completed' ? 'completed' : ''}}">
      <view class="workflow-findings__stage-header">
        <view class="workflow-findings__stage-icon">ğŸ§ </view>
        <view class="workflow-findings__stage-info">
          <text class="workflow-findings__stage-name">åˆ†æé˜¶æ®µ</text>
          <text class="workflow-findings__stage-status">
            {{safeStages.intelligence_analyzing.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
          </text>
        </view>
      </view>
      <view class="workflow-findings__stage-content" wx:if="{{expandedStage === 'analyzing' || expandAll}}">
        <view class="workflow-findings__findings-list" wx:if="{{safeStages.intelligence_analyzing.findings.length > 0}}">
          <view class="workflow-findings__finding" wx:for="{{safeStages.intelligence_analyzing.findings}}" wx:key="index">
            <text class="workflow-findings__finding-icon">â€¢</text>
            <text class="workflow-findings__finding-text">{{item}}</text>
          </view>
        </view>
        <view class="workflow-findings__discoveries" wx:if="{{safeStages.intelligence_analyzing.key_discoveries.length > 0}}">
          <view class="workflow-findings__discoveries-title">å…³é”®å‘ç°</view>
          <view class="workflow-findings__discovery" wx:for="{{safeStages.intelligence_analyzing.key_discoveries}}" wx:key="index">
            <text class="workflow-findings__discovery-icon">ğŸ’¡</text>
            <text class="workflow-findings__discovery-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é˜¶æ®µ 3: ç«äº‰åˆ†æ -->
    <view class="workflow-findings__stage {{safeStages.competition_analyzing.status === 'completed' ? 'completed' : ''}}">
      <view class="workflow-findings__stage-header">
        <view class="workflow-findings__stage-icon">âš”ï¸</view>
        <view class="workflow-findings__stage-info">
          <text class="workflow-findings__stage-name">ç«äº‰åˆ†æ</text>
          <text class="workflow-findings__stage-status">
            {{safeStages.competition_analyzing.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
          </text>
        </view>
      </view>
      <view class="workflow-findings__stage-content" wx:if="{{expandedStage === 'competition' || expandAll}}">
        <view class="workflow-findings__market-position" wx:if="{{safeStages.competition_analyzing.market_position.market_leader || safeStages.competition_analyzing.market_position.challenger}}">
          <view class="workflow-findings__position-item">
            <text class="workflow-findings__position-label">å¸‚åœºé¢†å¯¼è€…</text>
            <text class="workflow-findings__position-value">{{safeStages.competition_analyzing.market_position.market_leader}}</text>
          </view>
          <view class="workflow-findings__position-item">
            <text class="workflow-findings__position-label">æŒ‘æˆ˜è€…</text>
            <text class="workflow-findings__position-value">{{safeStages.competition_analyzing.market_position.challenger}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é˜¶æ®µ 4: ä¿¡æºè¿½æº¯ -->
    <view class="workflow-findings__stage {{safeStages.source_tracing.status === 'completed' ? 'completed' : ''}}">
      <view class="workflow-findings__stage-header">
        <view class="workflow-findings__stage-icon">ğŸ”—</view>
        <view class="workflow-findings__stage-info">
          <text class="workflow-findings__stage-name">ä¿¡æºè¿½æº¯</text>
          <text class="workflow-findings__stage-status">
            {{safeStages.source_tracing.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
          </text>
        </view>
      </view>
      <view class="workflow-findings__stage-content" wx:if="{{expandedStage === 'source' || expandAll}}">
        <view class="workflow-findings__credibility">
          <view class="workflow-findings__credibility-item">
            <text class="workflow-findings__credibility-label">é«˜å¯ä¿¡åº¦</text>
            <text class="workflow-findings__credibility-value workflow-findings__credibility-value--high">
              {{safeStages.source_tracing.credibility_analysis.high_credibility}}
            </text>
          </view>
          <view class="workflow-findings__credibility-item">
            <text class="workflow-findings__credibility-label">ä¸­å¯ä¿¡åº¦</text>
            <text class="workflow-findings__credibility-value workflow-findings__credibility-value--medium">
              {{safeStages.source_tracing.credibility_analysis.medium_credibility}}
            </text>
          </view>
          <view class="workflow-findings__credibility-item">
            <text class="workflow-findings__credibility-label">ä½å¯ä¿¡åº¦</text>
            <text class="workflow-findings__credibility-value workflow-findings__credibility-value--low">
              {{safeStages.source_tracing.credibility_analysis.low_credibility}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ±‡æ€»ç»Ÿè®¡ -->
  <view class="workflow-findings__summary" wx:if="{{summary}}">
    <view class="workflow-findings__summary-item">
      <text class="workflow-findings__summary-value">{{summary.total_findings}}</text>
      <text class="workflow-findings__summary-label">æ€»å‘ç°æ•°</text>
    </view>
    <view class="workflow-findings__summary-item">
      <text class="workflow-findings__summary-value workflow-findings__summary-value--critical">{{summary.critical_issues}}</text>
      <text class="workflow-findings__summary-label">å…³é”®é—®é¢˜</text>
    </view>
    <view class="workflow-findings__summary-item">
      <text class="workflow-findings__summary-value workflow-findings__summary-value--opportunity">{{summary.opportunities}}</text>
      <text class="workflow-findings__summary-label">æœºä¼šç‚¹</text>
    </view>
  </view>
</view>
