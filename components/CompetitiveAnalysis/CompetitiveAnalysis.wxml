<!--
  ç«å“åˆ†æç»„ä»¶
  ç‰ˆæœ¬ï¼šv2.0
-->
<view class="competitive-container {{visible ? 'visible' : ''}}" wx:if="{{visible}}">
  
  <!-- å¤´éƒ¨ -->
  <view class="ca-header">
    <view class="header-title">ç«å“å¯¹æ¯”åˆ†æ</view>
    <view class="header-actions">
      <view class="mode-switcher">
        <view 
          class="mode-option {{compareMode === 'radar' ? 'active' : ''}}"
          data-mode="radar"
          bindtap="onModeChange"
        >é›·è¾¾å›¾</view>
        <view 
          class="mode-option {{compareMode === 'table' ? 'active' : ''}}"
          data-mode="table"
          bindtap="onModeChange"
        >è¡¨æ ¼</view>
      </view>
    </view>
  </view>

  <!-- å¯¹æ¯”æ‘˜è¦ -->
  <view class="comparison-summary" wx:if="{{comparisonSummary}}">
    <view class="summary-card">
      <view class="card-icon">ğŸ†</view>
      <view class="card-content">
        <view class="card-label">å½“å‰æ’å</view>
        <view class="card-value">
          ç¬¬{{comparisonSummary.my_rank}}å
          <text class="rank-desc">{{comparisonSummary.total_competitors + 1}}ä¸ªå“ç‰Œ</text>
        </view>
      </view>
    </view>
    
    <view class="summary-card">
      <view class="card-icon">ğŸ“</view>
      <view class="card-content">
        <view class="card-label">ä¸é¢†å¯¼è€…å·®è·</view>
        <view class="card-value {{comparisonSummary.gap_to_leader <= 5 ? 'good' : 'warning'}}">
          {{comparisonSummary.gap_to_leader}}åˆ†
          <text class="gap-desc">{{comparisonSummary.gap_to_leader <= 5 ? 'å·®è·è¾ƒå°' : 'éœ€åŠªåŠ›è¿½èµ¶'}}</text>
        </view>
      </view>
    </view>
    
    <view class="summary-card">
      <view class="card-icon">ğŸ“Š</view>
      <view class="card-content">
        <view class="card-label">è¡Œä¸šå¹³å‡</view>
        <view class="card-value">
          {{comparisonSummary.average_competitor_score}}åˆ†
          <text class="avg-desc">è¡Œä¸šæ ‡æ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é›·è¾¾å›¾æ¨¡å¼ -->
  <view class="radar-mode" wx:if="{{compareMode === 'radar' && radarData}}">
    <!-- é›·è¾¾å›¾å®¹å™¨ -->
    <view class="radar-chart">
      <view class="radar-placeholder" wx:if="{{!radarData.datasets}}">
        <view class="placeholder-icon">ğŸ“Š</view>
        <view class="placeholder-text">é›·è¾¾å›¾æ•°æ®åŠ è½½ä¸­...</view>
      </view>
      
      <!-- ä½¿ç”¨ canvas ç»˜åˆ¶é›·è¾¾å›¾ -->
      <canvas 
        class="radar-canvas"
        type="2d"
        id="radarChart"
        wx:if="{{radarData.datasets}}"
      ></canvas>
    </view>
    
    <!-- å›¾ä¾‹ -->
    <view class="radar-legend">
      <view 
        class="legend-item"
        wx:for="{{radarData.datasets}}"
        wx:key="label"
      >
        <view 
          class="legend-color" 
          style="background: {{item.borderColor || '#999'}}"
        ></view>
        <view class="legend-label">{{item.label}}</view>
      </view>
    </view>
  </view>

  <!-- è¡¨æ ¼æ¨¡å¼ -->
  <view class="table-mode" wx:if="{{compareMode === 'table'}}">
    <view class="data-table">
      <view class="table-header">
        <view class="th">å“ç‰Œ</view>
        <view class="th">ç»¼åˆ</view>
        <view class="th">æƒå¨æ€§</view>
        <view class="th">å¯è§æ€§</view>
        <view class="th">çº¯å‡€åº¦</view>
        <view class="th">ä¸€è‡´æ€§</view>
      </view>
      
      <!-- æˆ‘æ–¹å“ç‰Œ -->
      <view class="table-row my-brand" wx:if="{{myBrandData}}">
        <view class="td brand">
          <view class="brand-icon">ğŸ </view>
          <view class="brand-name">{{myBrandData.brand_name || 'æˆ‘æ–¹å“ç‰Œ'}}</view>
        </view>
        <view class="td score overall">
          {{myBrandData.overall_score || 0}}
        </view>
        <view class="td score">
          {{myBrandData.dimension_scores?.authority || 0}}
        </view>
        <view class="td score">
          {{myBrandData.dimension_scores?.visibility || 0}}
        </view>
        <view class="td score">
          {{myBrandData.dimension_scores?.purity || 0}}
        </view>
        <view class="td score">
          {{myBrandData.dimension_scores?.consistency || 0}}
        </view>
      </view>
      
      <!-- ç«å“åˆ—è¡¨ -->
      <view 
        class="table-row {{selectedCompetitor?.competitor_name === item.competitor_name ? 'selected' : ''}}"
        wx:for="{{competitors}}"
        wx:key="competitor_name"
        data-competitor="{{item}}"
        bindtap="onSelectCompetitor"
      >
        <view class="td brand">
          <view class="brand-icon">ğŸ¢</view>
          <view class="brand-name">{{item.competitor_name}}</view>
        </view>
        <view class="td score overall">
          {{item.overall_score}}
        </view>
        <view class="td score">
          {{item.authority_score}}
        </view>
        <view class="td score">
          {{item.visibility_score}}
        </view>
        <view class="td score">
          {{item.purity_score}}
        </view>
        <view class="td score">
          {{item.consistency_score}}
        </view>
      </view>
    </view>
  </view>

  <!-- ç«å“è¯¦æƒ…å¡ç‰‡ -->
  <view class="competitor-detail" wx:if="{{selectedCompetitor}}">
    <view class="detail-header">
      <view class="detail-title">{{selectedCompetitor.competitor_name}}</view>
      <view class="detail-grade">{{selectedCompetitor.overall_score}}åˆ†</view>
    </view>
    
    <view class="detail-content">
      <!-- ä¼˜åŠ¿ -->
      <view class="detail-section" wx:if="{{selectedCompetitor.strongest_dimensions && selectedCompetitor.strongest_dimensions.length > 0}}">
        <view class="section-title">ğŸ’ª ä¼˜åŠ¿ç»´åº¦</view>
        <view class="tag-list">
          <view 
            class="tag success"
            wx:for="{{selectedCompetitor.strongest_dimensions}}"
            wx:key="*this"
          >{{item}}</view>
        </view>
      </view>
      
      <!-- åŠ£åŠ¿ -->
      <view class="detail-section" wx:if="{{selectedCompetitor.weakest_dimensions && selectedCompetitor.weakest_dimensions.length > 0}}">
        <view class="section-title">âš ï¸ åŠ£åŠ¿ç»´åº¦</view>
        <view class="tag-list">
          <view 
            class="tag warning"
            wx:for="{{selectedCompetitor.weakest_dimensions}}"
            wx:key="*this"
          >{{item}}</view>
        </view>
      </view>
    </view>
  </view>

</view>
