<!-- é—®é¢˜æ·±åº¦è¯Šæ–­è¯¦æƒ…é¡µ - éº¦è‚¯é”¡å½’å› åˆ†æé£æ ¼ -->
<view class="detail-container" wx:if="{{questionText}}">
  <!-- é¡¶éƒ¨ï¼šé—®é¢˜å±•ç¤ºåŒº -->
  <view class="q-header-section">
    <view class="q-number-badge">Q{{questionIndex + 1}}</view>
    <view class="q-content">
      <text class="q-label">è¯Šæ–­é—®é¢˜ï¼š</text>
      <text class="q-title">{{questionText}}</text>
    </view>
  </view>

  <!-- æ¨¡å‹åˆ‡æ¢æ ‡ç­¾ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰ -->
  <scroll-view scroll-x class="model-tabs" enable-flex>
    <view 
      wx:for="{{modelResults}}" 
      wx:key="model" 
      class="tab-item {{currentModelIndex === index ? 'active' : ''}}"
      bindtap="switchModel" 
      data-index="{{index}}"
    >
      <view class="tab-model-name">{{item.model}}</view>
      <view class="tab-rank {{item.geo_data?.rank > 0 ? 'ranked' : 'unranked'}}">
        {{item.geo_data?.rank > 0 ? '#' + item.geo_data.rank : 'æœªä¸Šæ¦œ'}}
      </view>
    </view>
  </scroll-view>

  <!-- å½’å› è¯Šæ–­å¡ç‰‡ -->
  <view class="diagnosis-card">
    <view class="card-title">
      <text class="title-icon">ğŸ”</text>
      <text class="title-text">å½’å› è¯Šæ–­ï¼šä¸ºä»€ä¹ˆæ’åœ¨è¿™é‡Œï¼Ÿ</text>
    </view>
    
    <!-- æƒ…æ„Ÿå®šæ€§ -->
    <view class="insight-section">
      <view class="insight-item">
        <view class="insight-header">
          <text class="insight-icon">ğŸ“Š</text>
          <text class="insight-label">æƒ…æ„Ÿå®šæ€§</text>
        </view>
        <view class="insight-content">
          <text class="value {{currentModelData?.geo_data?.sentiment > 0.3 ? 'pos' : currentModelData?.geo_data?.sentiment < -0.3 ? 'neg' : 'neu'}}">
            {{currentModelData?.geo_data?.sentiment > 0.3 ? 'æ­£é¢è¯„ä»·' : currentModelData?.geo_data?.sentiment < -0.3 ? 'å­˜åœ¨è´Ÿé¢' : 'ä¸­æ€§è¯„ä»·'}}
          </text>
          <text class="sub-value">å¾—åˆ†ï¼š{{currentModelData?.geo_data?.sentiment}}</text>
        </view>
      </view>

      <!-- æ’åæƒ…å†µ -->
      <view class="insight-item">
        <view class="insight-header">
          <text class="insight-icon">ğŸ†</text>
          <text class="insight-label">æ’åæƒ…å†µ</text>
        </view>
        <view class="insight-content">
          <text class="value {{currentModelData?.geo_data?.rank > 0 && currentModelData?.geo_data?.rank <= 3 ? 'good' : currentModelData?.geo_data?.rank > 5 ? 'bad' : 'normal'}}">
            {{currentModelData?.geo_data?.rank > 0 ? 'ç¬¬' + currentModelData?.geo_data?.rank + 'å' : 'æœªè¿›å…¥æ¦œå•'}}
          </text>
          <text class="sub-value">å…±{{modelResults.length}}ä¸ªæ¨¡å‹å‚ä¸æ’å</text>
        </view>
      </view>

      <!-- å“ç‰ŒæåŠ -->
      <view class="insight-item">
        <view class="insight-header">
          <text class="insight-icon">ğŸ“¢</text>
          <text class="insight-label">å“ç‰ŒæåŠ</text>
        </view>
        <view class="insight-content">
          <text class="value {{currentModelData?.geo_data?.brand_mentioned ? 'pos' : 'neg'}}">
            {{currentModelData?.geo_data?.brand_mentioned ? 'å·²æåŠ' : 'æœªæåŠ'}}
          </text>
          <text class="sub-value">{{currentModelData?.geo_data?.brand_mentioned ? 'AI è®¤çŸ¥ä¸­å­˜åœ¨' : 'AI æœªè¯†åˆ«å“ç‰Œ'}}</text>
        </view>
      </view>
    </view>

    <!-- ä¿¡æºä¾¦æ¢ -->
    <view class="source-detective">
      <view class="detective-header">
        <text class="detective-icon">ğŸ•µï¸</text>
        <text class="detective-label">å½±å“åŠ›çš„ä¿¡æºè¯æ®</text>
        <text class="detective-count">{{(currentModelData?.geo_data?.cited_sources || []).length}} ä¸ªä¿¡æº</text>
      </view>

      <view wx:if="{{(currentModelData?.geo_data?.cited_sources || []).length === 0}}" class="empty-sources">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-text">æœªæ£€æµ‹åˆ°å¼•ç”¨ä¿¡æº</text>
        <text class="empty-sub">AI åŸºäºå†…éƒ¨çŸ¥è¯†ç”Ÿæˆå›ç­”</text>
      </view>

      <view wx:for="{{currentModelData?.geo_data?.cited_sources}}" wx:key="url" class="source-box">
        <view class="source-header">
          <view class="source-info">
            <text class="site-name">{{item.site_name || 'æœªçŸ¥æ¥æº'}}</text>
            <text class="attitude-tag {{item.attitude}}">{{item.attitude === 'positive' ? 'âœ… åŠ åˆ†é¡¹' : item.attitude === 'negative' ? 'âš ï¸ å‡åˆ†é¡¹' : 'â– ä¸­æ€§'}}</text>
          </view>
        </view>
        <text class="source-url">{{item.url}}</text>
        <view class="source-impact">
          <text class="impact-label">å½±å“åŠ›è¯„ä¼°ï¼š</text>
          <text class="impact-value {{item.attitude}}">{{item.attitude === 'positive' ? 'æå‡æ’å' : item.attitude === 'negative' ? 'é™ä½æ’å' : 'æ— æ˜æ˜¾å½±å“'}}</text>
        </view>
      </view>
    </view>

    <!-- ç«å“æ‹¦æˆªåˆ†æ -->
    <view class="interception-analysis" wx:if="{{currentModelData?.geo_data?.interception}}">
      <view class="interception-header">
        <text class="interception-icon">âš ï¸</text>
        <text class="interception-label">ç«å“æ‹¦æˆªé¢„è­¦</text>
      </view>
      <view class="interception-content">
        <text class="interception-text">AI æ¨èäº†ç«å“ <text class="competitor-name">{{currentModelData?.geo_data?.interception}}</text> è€Œéæœ¬å“ç‰Œ</text>
        <view class="interception-suggestion">
          <text class="suggestion-icon">ğŸ’¡</text>
          <text class="suggestion-text">å»ºè®®ï¼šåŠ å¼ºå“ç‰Œä¸ç«å“çš„å·®å¼‚åŒ–å®šä½ï¼Œæå‡ AI è®¤çŸ¥ä¸­çš„ç‹¬ç‰¹æ€§</text>
        </view>
      </view>
    </view>
  </view>

  <!-- AI åŸæ–‡å¯¹è¯ï¼ˆåˆ†ç‰‡æ¸²æŸ“ï¼‰ -->
  <view class="raw-response">
    <view class="card-title">
      <text class="title-icon">ğŸ’¬</text>
      <text class="title-text">AI åŸæ–‡å¯¹è¯</text>
      <text class="title-sub">{{currentModelData?.model}} Â· {{currentModelData?.latency}}s</text>
    </view>
    
    <view class="content-box">
      <view class="rich-content">
        <rich-text nodes="{{renderedText}}"></rich-text>
      </view>
      
      <!-- æ¸²æŸ“ä¸­åŠ è½½æç¤º -->
      <view wx:if="{{isRendering}}" class="rendering-loader">
        <view class="loader-spinner"></view>
        <text class="loader-text">AI æ­£åœ¨æ·±åº¦åˆ†æä¸­...</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <button class="btn-secondary" bindtap="copyContent">å¤åˆ¶å†…å®¹</button>
    <button class="btn-primary" bindtap="shareAnalysis">åˆ†äº«åˆ†æ</button>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{!questionText && !loadError}}">
  <view class="loading-spinner"></view>
  <view class="loading-text">æ­£åœ¨åŠ è½½è¯Šæ–­è¯¦æƒ…...</view>
</view>

<!-- é”™è¯¯çŠ¶æ€ -->
<view class="error-container" wx:if="{{loadError}}">
  <view class="error-icon">âš ï¸</view>
  <view class="error-text">{{loadError}}</view>
  <button class="btn-retry" bindtap="retry">é‡æ–°åŠ è½½</button>
</view>
