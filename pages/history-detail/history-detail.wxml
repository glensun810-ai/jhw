<view class="page-container container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载详情中...</text>
  </view>

  <!-- 数据内容 -->
  <view wx:else class="content-wrapper">
    <!-- 页面头部 -->
    <view class="page-header">
      <text class="page-title">历史记录详情</text>
      <text class="page-subtitle">{{brandName}} · {{formatDate(timestamp)}}</text>
    </view>

    <!-- 总体评分 -->
    <view class="overall-score-section">
      <view class="score-card">
        <view class="score-main">
          <text class="score-number">{{overallScore}}</text>
          <text class="score-grade">{{overallGrade}}</text>
        </view>
        <text class="score-desc">{{overallSummary}}</text>
      </view>
    </view>

    <!-- 评分维度 -->
    <view class="score-dimensions-section">
      <view class="section-title-wrap">
        <text class="section-title">评分维度</text>
      </view>
      <view class="dimension-item">
        <text class="dimension-label">权威度</text>
        <view class="dimension-bar">
          <view class="bar-fill authority" style="width: {{overallAuthority}}%;"></view>
        </view>
        <text class="dimension-value">{{overallAuthority}}分</text>
      </view>
      <view class="dimension-item">
        <text class="dimension-label">可见度</text>
        <view class="dimension-bar">
          <view class="bar-fill visibility" style="width: {{overallVisibility}}%;"></view>
        </view>
        <text class="dimension-value">{{overallVisibility}}分</text>
      </view>
      <view class="dimension-item">
        <text class="dimension-label">纯净度</text>
        <view class="dimension-bar">
          <view class="bar-fill purity" style="width: {{overallPurity}}%;"></view>
        </view>
        <text class="dimension-value">{{overallPurity}}分</text>
      </view>
      <view class="dimension-item">
        <text class="dimension-label">一致性</text>
        <view class="dimension-bar">
          <view class="bar-fill consistency" style="width: {{overallConsistency}}%;"></view>
        </view>
        <text class="dimension-value">{{overallConsistency}}分</text>
      </view>
    </view>

    <!-- 测试信息 -->
    <view class="info-section">
      <view class="section-title-wrap">
        <text class="section-title">测试信息</text>
      </view>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">AI 模型</text>
          <text class="info-value">{{aiModels.length}} 个</text>
        </view>
        <view class="info-item">
          <text class="info-label">问题数</text>
          <text class="info-value">{{questions.length}} 个</text>
        </view>
        <view class="info-item">
          <text class="info-label">竞品数</text>
          <text class="info-value">{{competitors.length}} 个</text>
        </view>
        <view class="info-item">
          <text class="info-label">总测试</text>
          <text class="info-value">{{detailedResults.length}} 次</text>
        </view>
      </view>
    </view>

    <!-- 详细结果列表 -->
    <view class="detailed-results-section">
      <view class="section-title-wrap">
        <text class="section-title">详细测试结果</text>
        <text class="section-subtitle">{{detailedResults.length}} 条记录</text>
      </view>
      
      <view class="result-list">
        <view class="result-item" wx:for="{{detailedResults}}" wx:key="index" wx:for-item="result">
          <view class="result-header">
            <view class="result-brand">{{result.brand || result.brandName}}</view>
            <view class="result-model">{{result.aiModel || result.ai_model}}</view>
          </view>
          <view class="result-question">{{result.question}}</view>
          <view class="result-response">{{result.response || result.answer}}</view>
          <view class="result-scores">
            <view class="result-score-item">
              <text class="score-label">权威</text>
              <text class="score-value">{{result.authority_score || result.authority}}</text>
            </view>
            <view class="result-score-item">
              <text class="score-label">可见</text>
              <text class="score-value">{{result.visibility_score || result.visibility}}</text>
            </view>
            <view class="result-score-item">
              <text class="score-label">纯净</text>
              <text class="score-value">{{result.purity_score || result.purity}}</text>
            </view>
            <view class="result-score-item">
              <text class="score-label">一致</text>
              <text class="score-value">{{result.consistency_score || result.consistency}}</text>
            </view>
          </view>
          <view class="result-total">
            <text class="total-label">总分</text>
            <text class="total-value">{{result.score}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 底部操作栏 -->
    <view class="bottom-actions">
      <button class="action-btn home-btn" bindtap="goHome">返回首页</button>
      <button class="action-btn history-btn" bindtap="viewHistory">查看历史</button>
      <button class="action-btn report-btn" bindtap="generateReport">导出报告</button>
    </view>
  </view>
</view>
