<!--pages/admin/users/users.wxml-->
<!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
<view class="admin-container">
  <view class="admin-header">
    <text class="admin-title">ç”¨æˆ·ç®¡ç†</text>
    <text class="admin-subtitle">ç”¨æˆ·åˆ—è¡¨ä¸æƒé™ç®¡ç†</text>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <input class="search-input" placeholder="æœç´¢æ‰‹æœºå·æˆ–æ˜µç§°" bindinput="onSearchInput" value="{{searchKeyword}}" />
    <button class="search-btn" bindtap="searchUsers">æœç´¢</button>
  </view>

  <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
  <view class="batch-toolbar" wx:if="{{selectedUsers.length > 0}}">
    <view class="toolbar-info">å·²é€‰æ‹© {{selectedUsers.length}} ä¸ªç”¨æˆ·</view>
    <view class="toolbar-actions">
      <button class="action-btn" bindtap="batchGrantAdmin">æˆäºˆç®¡ç†å‘˜</button>
      <button class="action-btn warning" bindtap="batchRevokeAdmin">æ’¤é”€ç®¡ç†å‘˜</button>
      <button class="action-btn secondary" bindtap="batchExport">å¯¼å‡ºæ•°æ®</button>
      <button class="action-btn secondary" bindtap="batchNotify">å‘é€é€šçŸ¥</button>
      <button class="action-btn danger" bindtap="clearSelection">å–æ¶ˆé€‰æ‹©</button>
    </view>
  </view>

  <!-- å…¨é€‰å·¥å…·æ  -->
  <view class="select-all-bar">
    <checkbox-group bindchange="onSelectAll">
      <label class="select-all-label">
        <checkbox checked="{{selectAll}}" />
        <text>å…¨é€‰</text>
      </label>
    </checkbox-group>
    <button class="export-btn" bindtap="exportAllUsers">å¯¼å‡ºå…¨éƒ¨ç”¨æˆ·</button>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list">
    <view class="user-item" wx:for="{{users}}" wx:key="id" wx:for-item="user">
      <view class="user-select">
        <checkbox 
          checked="{{selectedUsers.includes(user.id)}}" 
          bindchange="onSelectUser" 
          data-id="{{user.id}}"
        />
      </view>
      <view class="user-info">
        <text class="user-phone">{{user.phone}}</text>
        <text class="user-nickname">{{user.nickname}}</text>
        <view class="user-tags">
          <text class="tag admin" wx:if="{{user.roles && user.roles.includes('admin')}}">ç®¡ç†å‘˜</text>
          <text class="tag date">{{formatDate(user.created_at)}}</text>
        </view>
      </view>
      <view class="user-actions">
        <button class="action-btn-small" bindtap="viewUserDetail" data-id="{{user.id}}">è¯¦æƒ…</button>
        <button class="action-btn-small {{user.roles && user.roles.includes('admin') ? 'warning' : ''}}" 
                bindtap="toggleUserRole" 
                data-id="{{user.id}}"
                data-action="{{user.roles && user.roles.includes('admin') ? 'revoke' : 'grant'}}">
          {{user.roles && user.roles.includes('admin') ? 'æ’¤é”€' : 'æˆäºˆ'}}
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!loading && users.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åˆ†é¡µ -->
  <view class="pagination" wx:if="{{pagination.total_pages > 1}}">
    <button class="page-btn" bindtap="prevPage" disabled="{{pagination.page <= 1}}">ä¸Šä¸€é¡µ</button>
    <text class="page-info">{{pagination.page}} / {{pagination.total_pages}}</text>
    <button class="page-btn" bindtap="nextPage" disabled="{{pagination.page >= pagination.total_pages}}">ä¸‹ä¸€é¡µ</button>
  </view>
</view>
