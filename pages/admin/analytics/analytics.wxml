<!--pages/admin/analytics/analytics.wxml-->
<!-- ä½¿ç”¨åˆ†æä»ªè¡¨ç›˜ -->
<view class="analytics-container">
  <!-- å¤´éƒ¨ -->
  <view class="analytics-header">
    <text class="analytics-title">ä½¿ç”¨åˆ†æ</text>
    <text class="analytics-subtitle">æ•°æ®ç»Ÿè®¡ä¸ç›‘æ§</text>
  </view>

  <!-- æ—¶é—´é€‰æ‹© -->
  <view class="time-selector">
    <view class="time-btn {{days === 7 ? 'active' : ''}}" bindtap="selectDays" data-days="7">7 å¤©</view>
    <view class="time-btn {{days === 30 ? 'active' : ''}}" bindtap="selectDays" data-days="30">30 å¤©</view>
    <view class="time-btn {{days === 90 ? 'active' : ''}}" bindtap="selectDays" data-days="90">90 å¤©</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ•°æ®å†…å®¹ -->
  <view wx:else class="content-wrapper">
    <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
    <view class="metrics-section">
      <view class="metric-card">
        <view class="metric-icon">ğŸ‘¥</view>
        <view class="metric-content">
          <text class="metric-value">{{userMetrics.dau}}</text>
          <text class="metric-label">æ—¥æ´»ç”¨æˆ·</text>
          <text class="metric-sub">æœˆæ´»ï¼š{{userMetrics.mau}}</text>
        </view>
      </view>

      <view class="metric-card">
        <view class="metric-icon">ğŸ“Š</view>
        <view class="metric-content">
          <text class="metric-value">{{testMetrics.tests_today}}</text>
          <text class="metric-label">ä»Šæ—¥æµ‹è¯•</text>
          <text class="metric-sub">å‘¨æœŸï¼š{{testMetrics.tests_period}}</text>
        </view>
      </view>

      <view class="metric-card">
        <view class="metric-icon">ğŸ¤–</view>
        <view class="metric-content">
          <text class="metric-value">{{platformMetrics.platform_count}}</text>
          <text class="metric-label">AI å¹³å°</text>
          <text class="metric-sub">çƒ­é—¨ï¼š{{platformMetrics.top_platform}}</text>
        </view>
      </view>
    </view>

    <!-- æ´»è·ƒç”¨æˆ·è¶‹åŠ¿å›¾ -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">æ´»è·ƒç”¨æˆ·è¶‹åŠ¿</text>
      </view>
      <view class="chart-container">
        <ec-canvas 
          id="activeTrendChart"
          canvasId="activeTrendChart"
          ec="{{activeTrendChartOption}}"
          height="250"
          bindchartReady="onChartReady"
        ></ec-canvas>
      </view>
    </view>

    <!-- AI å¹³å°ä½¿ç”¨å æ¯” -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">AI å¹³å°ä½¿ç”¨å æ¯”</text>
        <text class="section-subtitle">æ€»è°ƒç”¨ï¼š{{platformOverview.total_calls}}</text>
      </view>
      <view class="chart-container">
        <ec-canvas 
          id="platformPieChart"
          canvasId="platformPieChart"
          ec="{{platformPieChartOption}}"
          height="300"
          bindchartReady="onChartReady"
        ></ec-canvas>
      </view>
    </view>

    <!-- AI å¹³å°è¯¦ç»†ç»Ÿè®¡ -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">AI å¹³å°è¯¦ç»†ç»Ÿè®¡</text>
      </view>
      <view class="platform-list">
        <view class="platform-item" wx:for="{{platformStats}}" wx:key="index" wx:for-item="platform">
          <view class="platform-header">
            <text class="platform-name">{{platform.name}}</text>
            <text class="platform-count">{{platform.count}} æ¬¡</text>
          </view>
          <view class="platform-bar">
            <view class="platform-bar-fill" style="width: {{platform.percentage}}%;"></view>
          </view>
          <view class="platform-stats">
            <text class="stat-item">æˆåŠŸï¼š{{platform.success}}</text>
            <text class="stat-item">æˆåŠŸç‡ï¼š{{platform.success_rate}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é”™è¯¯ç‡è¶‹åŠ¿å›¾ -->
    <view class="chart-section" wx:if="{{errorTrend.length > 0}}">
      <view class="section-header">
        <text class="section-title">é”™è¯¯ç‡è¶‹åŠ¿</text>
        <text class="section-subtitle">å¹³å‡ï¼š{{errorOverview.overall_error_rate}}%</text>
      </view>
      <view class="chart-container">
        <ec-canvas 
          id="errorTrendChart"
          canvasId="errorTrendChart"
          ec="{{errorTrendChartOption}}"
          height="200"
          bindchartReady="onChartReady"
        ></ec-canvas>
      </view>
    </view>

    <!-- åŠŸèƒ½ä½¿ç”¨é¢‘ç‡ -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">åŠŸèƒ½ä½¿ç”¨</text>
      </view>
      <view class="feature-grid">
        <view class="feature-item">
          <text class="feature-value">{{featureStats.brand_test}}</text>
          <text class="feature-label">å“ç‰Œæµ‹è¯•</text>
        </view>
        <view class="feature-item">
          <text class="feature-value">{{featureStats.ai_diagnosis}}</text>
          <text class="feature-label">AI è¯Šæ–­</text>
        </view>
        <view class="feature-item">
          <text class="feature-value">{{featureStats.unique_users}}</text>
          <text class="feature-label">ç‹¬ç«‹ç”¨æˆ·</text>
        </view>
      </view>
    </view>
  </view>
</view>
