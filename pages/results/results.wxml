<view class="page-container container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å“ç‰Œæ´å¯ŸæŠ¥å‘Š</text>
    <text class="page-subtitle">â€œ{{targetBrand}}â€ï¼šAIè®¤çŸ¥ä¸å¸‚åœºæ ¼å±€åˆ†æ</text>
  </view>

  <!-- å“ç‰Œæ¦‚è§ˆåŒº -->
  <view class="brand-overview-section">
    <view class="overview-card">
      <view class="score-display">
        <text class="score-number">{{competitiveAnalysis.brandScores[targetBrand].overallScore || 0}}</text>
        <text class="score-grade">{{competitiveAnalysis.brandScores[targetBrand].overallGrade || 'D'}}</text>
      </view>
      <view class="score-summary">
        <text class="score-desc">{{competitiveAnalysis.brandScores[targetBrand].overallSummary || 'æš‚æ— è¯„ä»·'}}</text>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ´å¯Ÿæ‘˜è¦åŒº -->
  <view class="insights-summary-section">
    <text class="section-title">ğŸ¯ æ ¸å¿ƒæ´å¯Ÿ</text>
    <view class="insights-grid">
      <view class="insight-card advantage-card">
        <view class="card-icon">ğŸ†</view>
        <view class="card-title">ä¼˜åŠ¿é¢†åŸŸ</view>
        <view class="card-content">{{advantageInsight}}</view>
      </view>
      <view class="insight-card risk-card">
        <view class="card-icon">âš ï¸</view>
        <view class="card-title">é£é™©æç¤º</view>
        <view class="card-content">{{riskInsight}}</view>
      </view>
      <view class="insight-card opportunity-card">
        <view class="card-icon">ğŸ’¡</view>
        <view class="card-title">æœºä¼šç‚¹</view>
        <view class="card-content">{{opportunityInsight}}</view>
      </view>
    </view>
  </view>

  <!-- å¤šç»´åº¦åˆ†æåŒº -->
  <view class="multi-dimension-section">
    <text class="section-title">ğŸ“Š å¤šç»´åº¦åˆ†æ</text>
    <view class="dimensions-grid">
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">æƒå¨åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0, 'authority')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">å¯è§åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0, 'visibility')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">çº¯å‡€åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallPurity || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallPurity || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallPurity || 0, 'purity')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">ä¸€è‡´æ€§</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0, 'consistency')}}</view>
      </view>
    </view>
  </view>

  <!-- AIå¹³å°å¯¹æ¯”åŒº -->
  <view class="platform-comparison-section">
    <text class="section-title">ğŸ¤– AIå¹³å°è®¤çŸ¥å¯¹æ¯”</text>
    <view class="platform-tabs">
      <scroll-view scroll-x="true" class="tabs-scroll">
        <view class="tab-item {{currentPlatform === item ? 'active' : ''}}" 
              wx:for="{{platforms}}" wx:key="platform" 
              bindtap="switchPlatform" 
              data-platform="{{item}}">
          {{platformDisplayNames[item]}}
        </view>
      </scroll-view>
    </view>
    <view class="platform-content">
      <view class="radar-chart-container">
        <!-- é›·è¾¾å›¾å ä½ -->
        <view class="radar-placeholder">
          <text>é›·è¾¾å›¾å±•ç¤ºå¹³å°è®¤çŸ¥å¯¹æ¯”</text>
        </view>
      </view>
      <view class="platform-details">
        <view class="detail-item" wx:for="{{pkDataByPlatform[currentPlatform]}}" wx:key="index">
          <text class="detail-brand">{{item.myBrandData.brand}}</text>
          <text class="detail-score">{{item.myBrandData.overallScore}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¿¡æºæƒ…æŠ¥å±•ç¤º -->
  <view class="source-intelligence-section" wx:if="{{showSourceIntelligence}}">
    <text class="section-title">ğŸ” ä¿¡æºæƒ…æŠ¥åˆ†æ</text>
    <view class="intelligence-graph">
      <view class="graph-node" wx:for="{{sourceIntelligenceMap.nodes}}" wx:key="id" bindtap="viewSourceDetails" data-id="{{item.id}}">
        <view class="node-content {{item.category}}">
          <text class="node-name">{{item.name}}</text>
          <text class="node-weight" wx:if="{{item.value}}">æƒé‡: {{item.value}}</text>
          <text class="node-sentiment" wx:if="{{item.sentiment}}">æƒ…æ„Ÿ: {{item.sentiment}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ç»“æœåˆ—è¡¨ -->
  <view class="detailed-results-section">
    <view class="results-controls">
      <text class="section-title">ğŸ“‹ è¯¦ç»†æµ‹è¯•ç»“æœ</text>
      <view class="view-toggle">
        <view class="toggle-btn {{currentViewMode === 'brand' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="brand">å“ç‰Œå¯¹æ¯”</view>
        <view class="toggle-btn {{currentViewMode === 'dimension' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="dimension">ç»´åº¦å¯¹æ¯”</view>
        <view class="toggle-btn {{currentViewMode === 'detailed' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="detailed">è¯¦ç»†è§†å›¾</view>
      </view>
    </view>

    <!-- å“ç‰Œå¯¹æ¯”è§†å›¾ -->
    <view wx:if="{{currentViewMode === 'brand'}}">
      <view class="brand-comparison-card" wx:for="{{groupedResultsByBrand}}" wx:key="brand">
        <view class="brand-header">
          <text class="brand-name {{item.isMainBrand ? 'main-brand' : 'competitor-brand'}}">
            {{item.isMainBrand ? 'ğŸ¢' : 'ğŸš—'}} {{item.brand}}
          </text>
          <text class="brand-score">ğŸ“Š ç»¼åˆ: {{item.overallScore}}åˆ†</text>
        </view>
        <view class="brand-dimensions">
          <view class="dimension-item">
            <text class="dimension-label">ğŸ† æƒå¨åº¦</text>
            <text class="dimension-score">{{item.scores.authority_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">ğŸ‘ï¸ å¯è§åº¦</text>
            <text class="dimension-score">{{item.scores.visibility_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">âœ¨ çº¯å‡€åº¦</text>
            <text class="dimension-score">{{item.scores.purity_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">ğŸ”— ä¸€è‡´æ€§</text>
            <text class="dimension-score">{{item.scores.consistency_score || 0}}</text>
          </view>
        </view>
        <view class="brand-questions" bindtap="toggleBrandQuestions" data-brand="{{item.brand}}">
          <text class="questions-toggle">ğŸ“‹ {{item.questions.length}} ä¸ªé—®é¢˜ ></text>
        </view>
        <view class="brand-question-details" wx:if="{{expandedBrands[item.brand]}}">
          <view class="question-item" wx:for="{{item.questions}}" wx:key="index">
            <text class="question-text">â“ {{item.question}}</text>
            <text class="answer-text">ğŸ’¬ {{item.response}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»´åº¦å¯¹æ¯”è§†å›¾ -->
    <view wx:elif="{{currentViewMode === 'dimension'}}">
      <view class="dimension-comparison-section">
        <view class="dimension-card" wx:for="{{dimensionComparisonData}}" wx:key="dimension">
          <view class="dimension-header">
            <text class="dimension-name">{{item.icon}} {{item.name}}</text>
            <text class="dimension-average">å¹³å‡: {{item.averageScore}}åˆ†</text>
          </view>
          <view class="dimension-bars">
            <view class="bar-item" wx:for="{{item.brands}}" wx:key="brand">
              <text class="bar-label {{item.isMainBrand ? 'main-brand' : 'competitor-brand'}}">{{item.brand}}</text>
              <view class="bar-container">
                <view class="bar-fill" style="width: {{item.score}}%; background-color: {{item.isMainBrand ? '#00F5A0' : '#00A9FF'}};"></view>
                <text class="bar-score">{{item.score}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†è§†å›¾ -->
    <view wx:elif="{{currentViewMode === 'detailed'}}">
      <view class="detailed-result-item" wx:for="{{latestTestResults}}" wx:key="index">
        <view class="detailed-header">
          <text class="detailed-brand {{item.brand === targetBrand ? 'main-brand' : 'competitor-brand'}}">
            {{item.brand === targetBrand ? 'ğŸ¢' : 'ğŸš—'}} {{item.brand}}
          </text>
          <text class="detailed-model">ğŸ¤– {{item.aiModel}}</text>
        </view>
        <view class="detailed-question">â“ {{item.question}}</view>
        <view class="detailed-response">ğŸ’¬ {{item.response}}</view>
        <view class="detailed-scores-grid">
          <view class="score-cell">
            <text class="score-label">ğŸ† æƒå¨åº¦</text>
            <text class="score-value">{{item.authority_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">ğŸ‘ï¸ å¯è§åº¦</text>
            <text class="score-value">{{item.visibility_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">âœ¨ çº¯å‡€åº¦</text>
            <text class="score-value">{{item.purity_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">ğŸ”— ä¸€è‡´æ€§</text>
            <text class="score-value">{{item.consistency_score || 0}}</text>
          </view>
        </view>
        <view class="detailed-total-score">ğŸ“ˆ æ€»åˆ†: {{item.score}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn save-btn" bindtap="saveResult">ğŸ’¾ ä¿å­˜ç»“æœ</button>
    <button class="action-btn home-btn" bindtap="goHome">ğŸ  è¿”å›é¦–é¡µ</button>
    <button class="action-btn history-btn" bindtap="viewHistory">ğŸ“š æŸ¥çœ‹å†å²</button>
    <button class="action-btn report-btn" bindtap="generateReport">ğŸ“Š ç”Ÿæˆæˆ˜æŠ¥</button>
  </view>

  <!-- ä¿å­˜ç»“æœæ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showSaveResultModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>ä¿å­˜æœç´¢ç»“æœ</text>
        <text class="close-btn" bindtap="hideSaveResultModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="label">å“ç‰Œåç§°</text>
          <input class="input" value="{{saveBrandName}}" bindinput="onSaveBrandNameInput" placeholder="è¯·è¾“å…¥å“ç‰Œåç§°" />
        </view>
        <view class="form-group">
          <text class="label">æ ‡ç­¾</text>
          <view class="tags-container">
            <view class="tag-item" wx:for="{{saveTags}}" wx:key="tag" wx:if="{{item}}">
              <text>{{item}}</text>
              <text class="remove-tag" bindtap="removeSaveTag" data-index="{{index}}">Ã—</text>
            </view>
            <view class="add-tag-container">
              <input class="tag-input" value="{{newSaveTag}}" bindinput="onNewSaveTagInput" placeholder="æ·»åŠ æ ‡ç­¾" />
              <button class="add-tag-btn" bindtap="addSaveTag">æ·»åŠ </button>
            </view>
          </view>
        </view>
        <view class="form-group">
          <text class="label">åˆ†ç±»</text>
          <picker class="picker" range="{{saveCategories}}" value="{{saveCategoryIndex}}" bindchange="onSaveCategoryChange">
            <view class="picker-view">{{selectedSaveCategory}}</view>
          </picker>
        </view>
        <view class="form-group">
          <text class="label">å¤‡æ³¨</text>
          <textarea class="textarea" value="{{saveNotes}}" bindinput="onSaveNotesInput" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" />
        </view>
        <view class="form-group">
          <text class="label">æ”¶è—</text>
          <switch class="switch" checked="{{saveAsFavorite}}" bindchange="onSaveFavoriteChange" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-cancel-btn" bindtap="hideSaveResultModal">å–æ¶ˆ</button>
        <button class="modal-confirm-btn" bindtap="confirmSaveResult">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>