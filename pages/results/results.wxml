<!-- é¡µé¢è¿‡æ¸¡åŠ¨ç”»åŒ…è£…å™¨ -->
<view class="page-transition-container {{pageTransitionClass}}">
  <view class="page-container container {{pageLoaded ? 'loaded' : ''}}">
    <!-- é«˜ä¼˜å…ˆçº§ä¿®å¤ 3: åˆ·æ–°æç¤ºæ¡ -->
    <view class="refresh-bar" wx:if="{{isCached || refreshing}}">
    <view class="cache-hint" wx:if="{{isCached && !refreshing}}">
      <text class="hint-icon">ğŸ’¾</text>
      <text class="hint-text">å½“å‰æ˜¾ç¤ºç¼“å­˜æ•°æ®</text>
      <button class="refresh-btn" size="mini" bindtap="refreshData" disabled="{{refreshing}}">åˆ·æ–°</button>
    </view>
    <view class="refreshing" wx:if="{{refreshing}}">
      <text class="refresh-icon">ğŸ”„</text>
      <text class="refresh-text">åˆ·æ–°ä¸­...</text>
    </view>
  </view>

  <!-- P0-006 æ–°å¢ï¼šé”™è¯¯æç¤ºæ¡ -->
  <view class="error-banner" wx:if="{{showErrorBanner}}">
    <view class="error-banner-content">
      <text class="error-icon">âŒ</text>
      <text class="error-message">{{errorMessage || 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•'}}</text>
    </view>
    <button class="error-retry-btn" bindtap="retryLoad">é‡è¯•</button>
  </view>

  <!-- P0-006 æ–°å¢ï¼šé™çº§æç¤ºæ¡ -->
  <view class="fallback-banner" wx:if="{{showFallbackBanner}}">
    <view class="fallback-banner-content">
      <text class="fallback-icon">âš ï¸</text>
      <text class="fallback-message">{{fallbackMessage}}</text>
    </view>
  </view>

  <!-- P1-016 æ–°å¢ï¼šé…é¢æ¢å¤å»ºè®®å¡ç‰‡ -->
  <view class="quota-recovery-section" wx:if="{{quotaRecoverySuggestions && quotaRecoverySuggestions.length > 0}}">
    <text class="subsection-title">ğŸ’° é…é¢æ¢å¤å»ºè®®</text>
    <view class="quota-recovery-cards">
      <view class="quota-recovery-card" wx:for="{{quotaRecoverySuggestions}}" wx:key="model">
        <view class="quota-recovery-header">
          <text class="quota-model-icon">ğŸ¤–</text>
          <text class="quota-model-name">{{item.model}}</text>
        </view>
        <view class="quota-recovery-content">
          <text class="quota-suggestion" wx:for="{{item.suggestions}}" wx:key="index" wx:for-item="suggestion">
            <text class="suggestion-bullet">â€¢</text>
            <text class="suggestion-text">{{suggestion}}</text>
          </text>
        </view>
        <view class="quota-recovery-footer">
          <button class="retry-platform-btn" bindtap="retryWithOtherPlatform" data-model="{{item.model}}">åˆ‡æ¢å…¶ä»–å¹³å°</button>
        </view>
      </view>
    </view>
  </view>

  <!-- P0-006 æ–°å¢ï¼šéƒ¨åˆ†ç»“æœè­¦å‘Šæ¡ -->
  <view class="partial-banner" wx:if="{{hasPartialResults || (quotaWarnings && quotaWarnings.length > 0)}}">
    <view class="partial-banner-content">
      <text class="partial-icon">âš¡</text>
      <view class="partial-messages">
        <text wx:if="{{hasPartialResults}}" class="partial-message">âš ï¸ éƒ¨åˆ† AI å¹³å°è°ƒç”¨å¤±è´¥ï¼Œå½“å‰æ˜¾ç¤ºå¯ç”¨ç»“æœ</text>
        <text wx:if="{{quotaWarnings && quotaWarnings.length > 0}}" class="partial-message">{{quotaWarnings[0]}}</text>
      </view>
    </view>
    <button class="partial-detail-btn" bindtap="showPartialDetails">è¯¦æƒ…</button>
    <!-- P2-022 æ–°å¢ï¼šæŸ¥çœ‹é”™è¯¯è¯¦æƒ…æŒ‰é’® -->
    <button class="error-log-btn" bindtap="showErrorLogDetails" wx:if="{{errorLogList && errorLogList.length > 0}}">é”™è¯¯æ—¥å¿—</button>
  </view>

  <!-- P2-022 æ–°å¢ï¼šé”™è¯¯è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="error-details-modal" wx:if="{{showErrorDetailsModal && errorLogList.length > 0}}">
    <view class="modal-mask" bindtap="closeErrorDetails"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ğŸ“‹ é”™è¯¯è¯¦æƒ…</text>
        <text class="modal-close" bindtap="closeErrorDetails">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="error-summary-section" wx:if="{{errorLogList.length > 0}}">
          <text class="error-summary-title">é”™è¯¯æ‘˜è¦</text>
          <view class="error-summary-grid">
            <view class="summary-item">
              <text class="summary-label">æ€»é”™è¯¯æ•°</text>
              <text class="summary-value error">{{errorLogList.length}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">é…é¢ç”¨å°½</text>
              <text class="summary-value warning">{{quotaExhaustedCount}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">å…¶ä»–é”™è¯¯</text>
              <text class="summary-value info">{{otherErrorCount}}</text>
            </view>
          </view>
        </view>
        
        <!-- æ— é”™è¯¯æ—¶çš„æç¤º -->
        <view class="no-error-hint" wx:else>
          <text class="no-error-icon">âœ…</text>
          <text class="no-error-text">æš‚æ— é”™è¯¯è®°å½•</text>
        </view>

        <view class="error-list-section" wx:if="{{errorLogList.length > 0}}">
          <text class="error-list-title">é”™è¯¯åˆ—è¡¨</text>
          <view class="error-list">
            <view class="error-item" wx:for="{{errorLogList}}" wx:key="index">
              <view class="error-item-header">
                <text class="error-type-badge {{item.errorType}}">{{item.errorTypeName}}</text>
                <text class="error-model">{{item.model}}</text>
              </view>
              <view class="error-item-content">
                <text class="error-message">{{item.message}}</text>
                <text class="error-time">{{item.time}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-confirm-btn" bindtap="closeErrorDetails">çŸ¥é“äº†</button>
      </view>
    </view>
  </view>

  <!-- P0-009 æ–°å¢ï¼šå®Œæˆç‡æç¤ºæ¡ -->
  <view class="completion-banner" wx:if="{{completionRate !== undefined && completionRate < 100}}">
    <view class="completion-banner-content">
      <text class="completion-icon">ğŸ“Š</text>
      <text class="completion-text">æœ¬æ¬¡è¯Šæ–­å®Œæˆç‡ï¼š{{completedTasks || 0}}/{{totalTasks || 0}} ({{completionRate}}%)</text>
    </view>
  </view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å“ç‰Œæ´å¯ŸæŠ¥å‘Š</text>
    <text class="page-subtitle">â€œ{{targetBrand}}â€ï¼šAIè®¤çŸ¥ä¸å¸‚åœºæ ¼å±€åˆ†æ</text>

    <!-- P0-012 æ–°å¢ï¼šè´¨é‡è¯„åˆ†å¾½ç«  -->
    <view class="quality-badge" wx:if="{{qualityScore}}">
      <text class="quality-icon">ğŸ“Š</text>
      <text class="quality-score">æŠ¥å‘Šè´¨é‡ï¼š{{qualityScore}}åˆ†</text>
      <text class="quality-level {{qualityLevel}}">{{qualityLevelText}}</text>
    </view>  </view>

  <!-- å“ç‰Œæ¦‚è§ˆåŒº -->
  <view class="brand-overview-section">
    <view class="overview-card">
      <view class="score-display">
        <text class="score-number">{{competitiveAnalysis.brandScores[targetBrand].overallScore || 0}}</text>
        <text class="score-grade">{{competitiveAnalysis.brandScores[targetBrand].overallGrade || 'D'}}</text>
      </view>
      <view class="score-summary">
        <text class="score-desc">{{competitiveAnalysis.brandScores[targetBrand].overallSummary || 'æš‚æ— è¯„ä»·'}}</text>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ´å¯Ÿæ‘˜è¦åŒº -->
  <view class="insights-summary-section">
    <text class="section-title">ğŸ¯ æ ¸å¿ƒæ´å¯Ÿ</text>
    <view class="insights-grid">
      <view class="insight-card advantage-card">
        <view class="card-icon">ğŸ†</view>
        <view class="card-title">ä¼˜åŠ¿é¢†åŸŸ</view>
        <view class="card-content">{{advantageInsight}}</view>
      </view>
      <view class="insight-card risk-card">
        <view class="card-icon">âš ï¸</view>
        <view class="card-title">é£é™©æç¤º</view>
        <view class="card-content">{{riskInsight}}</view>
      </view>
      <view class="insight-card opportunity-card">
        <view class="card-icon">ğŸ’¡</view>
        <view class="card-title">æœºä¼šç‚¹</view>
        <view class="card-content">{{opportunityInsight}}</view>
      </view>
    </view>
  </view>

  <!-- å¤šç»´åº¦åˆ†æåŒº -->
  <view class="multi-dimension-section">
    <text class="section-title">ğŸ“Š å¤šç»´åº¦åˆ†æ</text>
    <view class="dimensions-grid">
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">æƒå¨åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallAuthority || 0, 'authority')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">å¯è§åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallVisibility || 0, 'visibility')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">çº¯å‡€åº¦</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallPurity || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallPurity || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallPurity || 0, 'purity')}}</view>
      </view>
      <view class="dimension-card">
        <view class="dimension-header">
          <text class="dimension-name">ä¸€è‡´æ€§</text>
          <text class="dimension-score">{{competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0}}åˆ†</text>
        </view>
        <view class="dimension-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0}}%;"></view>
          </view>
        </view>
        <view class="dimension-status">{{getDimensionStatus(competitiveAnalysis.brandScores[targetBrand].overallConsistency || 0, 'consistency')}}</view>
      </view>
    </view>
  </view>

  <!-- AIå¹³å°å¯¹æ¯”åŒº -->
  <view class="platform-comparison-section">
    <text class="section-title">ğŸ¤– AIå¹³å°è®¤çŸ¥å¯¹æ¯”</text>
    <view class="platform-tabs">
      <scroll-view scroll-x="true" class="tabs-scroll">
        <view class="tab-item {{currentPlatform === item ? 'active' : ''}}" 
              wx:for="{{platforms}}" wx:key="platform" 
              bindtap="switchPlatform" 
              data-platform="{{item}}">
          {{platformDisplayNames[item]}}
        </view>
      </scroll-view>
    </view>
    <view class="platform-content">
      <view class="radar-chart-container">
        <!-- P2-2 é›·è¾¾å›¾ç»„ä»¶ -->
        <!-- ã€å…³é”®ä¿®å¤ã€‘ä½¿ç”¨ hidden æ›¿ä»£ wx:ifï¼Œç¡®ä¿ DOM èŠ‚ç‚¹å­˜åœ¨åå†æ¸²æŸ“ ECharts -->
        <view class="radar-canvas-wrapper" hidden="{{!(radarChartData && radarChartData.length > 0)}}">
          <canvas
            type="2d"
            id="radarChartCanvas"
            class="radar-chart-canvas"
            style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
          ></canvas>
        </view>
        <view class="radar-placeholder" hidden="{{radarChartData && radarChartData.length > 0}}">
          <text>æš‚æ— é›·è¾¾å›¾æ•°æ®</text>
        </view>
      </view>

      <!-- ç»´åº¦è¯´æ˜ -->
      <view class="radar-legend" hidden="{{!(radarChartData && radarChartData.length > 0)}}">
        <view class="legend-item">
          <view class="legend-color my-brand"></view>
          <text class="legend-text">{{targetBrand}}</text>
        </view>
        <view class="legend-item">
          <view class="legend-color competitor"></view>
          <text class="legend-text">ç«å“å¹³å‡</text>
        </view>
      </view>
      <view class="platform-details">
        <view class="detail-item" wx:for="{{pkDataByPlatform[currentPlatform]}}" wx:key="index">
          <text class="detail-brand">{{item.myBrandData.brand}}</text>
          <view class="detail-score-wrapper">
            <text class="detail-score {{item.myBrandData.hasError ? 'error-score' : ''}}">{{item.myBrandData.overallScore}}</text>
            <!-- P0-008 æ–°å¢ï¼šé”™è¯¯æ ‡è®° -->
            <text class="error-badge" wx:if="{{item.myBrandData.hasError}}" title="{{item.myBrandData.errorMessage}}">âš ï¸</text>
            <text class="error-badge" wx:if="{{item.myBrandData.isQuotaExhausted}}" title="é…é¢ç”¨å°½">ğŸ’°</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- P0-3 ç«äº‰åˆ†æåŒº -->
  <view class="competitive-analysis-section">
    <text class="section-title">ğŸ” ç«äº‰åˆ†æ</text>
    
    <!-- å“ç‰Œæ’å -->
    <view class="brand-ranking-section" wx:if="{{brandRankingList && brandRankingList.length > 0}}">
      <text class="subsection-title">å“ç‰Œæ›å…‰æ’å</text>
      <view class="ranking-list">
        <view class="ranking-item" wx:for="{{brandRankingList}}" wx:key="index" wx:for-item="brand">
          <text class="ranking-position">{{index + 1}}</text>
          <text class="ranking-brand {{brand === targetBrand ? 'main-brand' : ''}}">{{brand}}</text>
        </view>
      </view>
    </view>

    <!-- é¦–æ¬¡æåŠç‡ -->
    <view class="first-mention-section" wx:if="{{firstMentionByPlatform && firstMentionByPlatform.length > 0}}">
      <text class="subsection-title">AI å¹³å°é¦–æ¬¡æåŠç‡</text>
      <view class="mention-list">
        <view class="mention-item" wx:for="{{firstMentionByPlatform}}" wx:key="platform">
          <text class="mention-platform">{{item.platform}}</text>
          <text class="mention-rate">{{item.rate}}%</text>
        </view>
      </view>
    </view>

    <!-- æ‹¦æˆªé£é™© -->
    <view class="interception-risk-section" wx:if="{{interceptionRisks && interceptionRisks.length > 0}}">
      <text class="subsection-title">æµé‡æ‹¦æˆªé£é™©</text>
      <view class="risk-list">
        <view class="risk-item" wx:for="{{interceptionRisks}}" wx:key="type">
          <text class="risk-type">{{item.type}}</text>
          <text class="risk-level {{item.level}}">{{item.description}}</text>
        </view>
      </view>
    </view>

    <!-- ç«å“å¯¹æ¯”è¯¦æƒ… -->
    <view class="competitor-comparison-section" wx:if="{{competitorComparisonData && competitorComparisonData.length > 0}}">
      <text class="subsection-title">ç«å“å¯¹æ¯”è¯¦æƒ…</text>
      <view class="comparison-list">
        <view class="comparison-item" wx:for="{{competitorComparisonData}}" wx:key="competitor">
          <view class="comparison-header">
            <text class="comparison-competitor">ğŸ†š {{item.competitor}}</text>
            <text class="comparison-score">å·®å¼‚åŒ–è¯„åˆ†ï¼š{{item.differentiationScore}}/100</text>
          </view>
          <view class="comparison-content">
            <view class="comparison-section" wx:if="{{item.commonKeywords && item.commonKeywords.length > 0}}">
              <text class="comparison-label">å…±åŒå…³é”®è¯:</text>
              <text class="comparison-value">{{item.commonKeywords.join(', ')}}</text>
            </view>
            <view class="comparison-section" wx:if="{{item.uniqueToBrand && item.uniqueToBrand.length > 0}}">
              <text class="comparison-label">æˆ‘æ–¹ä¼˜åŠ¿:</text>
              <text class="comparison-value">{{item.uniqueToBrand.join(', ')}}</text>
            </view>
            <view class="comparison-section" wx:if="{{item.uniqueToCompetitor && item.uniqueToCompetitor.length > 0}}">
              <text class="comparison-label">å¯¹æ–¹ä¼˜åŠ¿:</text>
              <text class="comparison-value">{{item.uniqueToCompetitor.join(', ')}}</text>
            </view>
            <view class="comparison-section" wx:if="{{item.differentiationGap}}">
              <text class="comparison-label">å·®å¼‚åŒ–å»ºè®®:</text>
              <text class="comparison-value">{{item.differentiationGap}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- P1-1 è¯­ä¹‰åç§»å¯è§†åŒ– -->
  <view class="semantic-drift-section">
    <text class="section-title">ğŸ”€ è¯­ä¹‰åç§»åˆ†æ</text>
    
    <!-- è¯­ä¹‰åç§»æ¦‚è§ˆ -->
    <view class="drift-overview-section" wx:if="{{semanticDriftData}}">
      <view class="drift-score-card">
        <view class="score-circle {{semanticDriftData.driftSeverity}}">
          <text class="score-number">{{semanticDriftData.driftScore}}</text>
          <text class="score-label">åç§»åˆ†æ•°</text>
        </view>
        <view class="drift-info">
          <text class="drift-severity {{semanticDriftData.driftSeverity}}">{{semanticDriftData.driftSeverityText}}</text>
          <text class="drift-similarity">è¯­ä¹‰ç›¸ä¼¼åº¦ï¼š{{semanticDriftData.similarityScore}}%</text>
        </view>
      </view>
    </view>

    <!-- å…³é”®è¯å¯¹æ¯” -->
    <view class="keyword-comparison-section" wx:if="{{semanticContrastData && semanticContrastData.official_words}}">
      <text class="subsection-title">ğŸ“ å…³é”®è¯å¯¹æ¯”</text>
      
      <!-- å®˜æ–¹å…³é”®è¯ -->
      <view class="keyword-group">
        <text class="keyword-group-title">ğŸ¢ å®˜æ–¹å…³é”®è¯</text>
        <view class="keyword-cloud">
          <view class="keyword-tag official" wx:for="{{semanticContrastData.official_words}}" wx:key="index">
            <text class="keyword-name">{{item.name}}</text>
            <text class="keyword-value">{{item.value}}</text>
          </view>
        </view>
      </view>

      <!-- AI ç”Ÿæˆå…³é”®è¯ -->
      <view class="keyword-group">
        <text class="keyword-group-title">ğŸ¤– AI ç”Ÿæˆå…³é”®è¯</text>
        <view class="keyword-cloud">
          <view class="keyword-tag {{item.category}}" wx:for="{{semanticContrastData.ai_generated_words}}" wx:key="index">
            <text class="keyword-name">{{item.name}}</text>
            <text class="keyword-value">{{item.value}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åç§»è¯¦æƒ… -->
    <view class="drift-details-section" wx:if="{{semanticDriftData && (semanticDriftData.missingKeywords || semanticDriftData.unexpectedKeywords)}}">
      <text class="subsection-title">âš ï¸ åç§»è¯¦æƒ…</text>
      
      <!-- ç¼ºå¤±å…³é”®è¯ -->
      <view class="drift-detail-item" wx:if="{{semanticDriftData.missingKeywords && semanticDriftData.missingKeywords.length > 0}}">
        <text class="drift-detail-label">âŒ ç¼ºå¤±å…³é”®è¯ï¼ˆå®˜æ–¹æœ‰ä½† AI æœªæåŠï¼‰</text>
        <view class="keyword-list">
          <text class="keyword-item" wx:for="{{semanticDriftData.missingKeywords}}" wx:key="*this">{{item}}</text>
        </view>
      </view>

      <!-- æ„å¤–å…³é”®è¯ -->
      <view class="drift-detail-item" wx:if="{{semanticDriftData.unexpectedKeywords && semanticDriftData.unexpectedKeywords.length > 0}}">
        <text class="drift-detail-label">âš ï¸ æ„å¤–å…³é”®è¯ï¼ˆAI æåŠä½†å®˜æ–¹æ²¡æœ‰ï¼‰</text>
        <view class="keyword-list">
          <text class="keyword-item" wx:for="{{semanticDriftData.unexpectedKeywords}}" wx:key="*this">{{item}}</text>
        </view>
      </view>

      <!-- è´Ÿé¢æœ¯è¯­ -->
      <view class="drift-detail-item" wx:if="{{semanticDriftData.negativeTerms && semanticDriftData.negativeTerms.length > 0}}">
        <text class="drift-detail-label">ğŸš« è´Ÿé¢æœ¯è¯­</text>
        <view class="keyword-list negative">
          <text class="keyword-item" wx:for="{{semanticDriftData.negativeTerms}}" wx:key="*this">{{item}}</text>
        </view>
      </view>

      <!-- æ­£é¢æœ¯è¯­ -->
      <view class="drift-detail-item" wx:if="{{semanticDriftData.positiveTerms && semanticDriftData.positiveTerms.length > 0}}">
        <text class="drift-detail-label">âœ… æ­£é¢æœ¯è¯­</text>
        <view class="keyword-list positive">
          <text class="keyword-item" wx:for="{{semanticDriftData.positiveTerms}}" wx:key="*this">{{item}}</text>
        </view>
      </view>
    </view>
  </view>
    <!-- P1-3 ä¼˜åŒ–å»ºè®®åˆ—è¡¨ -->
  <view class="recommendation-section" wx:if="{{recommendationData && recommendationData.recommendations && recommendationData.recommendations.length > 0}}">
    <text class="section-title">ğŸ’¡ ä¼˜åŒ–å»ºè®®</text>
    
    <!-- å»ºè®®æ¦‚è§ˆ -->
    <view class="recommendation-overview">
      <view class="overview-item">
        <text class="overview-number">{{recommendationData.totalCount}}</text>
        <text class="overview-label">å»ºè®®æ€»æ•°</text>
      </view>
      <view class="overview-item">
        <text class="overview-number high">{{recommendationData.highPriorityCount}}</text>
        <text class="overview-label">é«˜ä¼˜å…ˆçº§</text>
      </view>
      <view class="overview-item">
        <text class="overview-number medium">{{recommendationData.mediumPriorityCount}}</text>
        <text class="overview-label">ä¸­ä¼˜å…ˆçº§</text>
      </view>
      <view class="overview-item">
        <text class="overview-number low">{{recommendationData.lowPriorityCount}}</text>
        <text class="overview-label">ä½ä¼˜å…ˆçº§</text>
      </view>
    </view>

    <!-- å»ºè®®åˆ—è¡¨ -->
    <view class="recommendation-list">
      <view class="recommendation-card" wx:for="{{recommendationData.recommendations}}" wx:key="index">
        <view class="card-header {{item.priority}}">
          <text class="priority-tag {{item.priority}}">{{item.priorityText}}</text>
          <text class="type-tag {{item.type}}">{{item.typeText}}</text>
          <text class="urgency-score">ç´§æ€¥åº¦ï¼š{{item.urgency}}/10</text>
        </view>
        <view class="card-body">
          <text class="card-title">{{item.title}}</text>
          <text class="card-description">{{item.description}}</text>
          
          <!-- è¡ŒåŠ¨æ­¥éª¤ -->
          <view class="action-steps" wx:if="{{item.actionSteps && item.actionSteps.length > 0}}">
            <text class="steps-title">ğŸ“‹ è¡ŒåŠ¨æ­¥éª¤ï¼š</text>
            <view class="step-item" wx:for="{{item.actionSteps}}" wx:key="index">
              <text class="step-number">{{index + 1}}</text>
              <text class="step-text">{{item}}</text>
            </view>
          </view>
          
          <!-- ç›®æ ‡å¯¹è±¡ -->
          <view class="target-info" wx:if="{{item.target}}">
            <text class="target-label">ğŸ¯ ç›®æ ‡å¯¹è±¡ï¼š</text>
            <text class="target-value">{{item.target}}</text>
          </view>
          
          <!-- é¢„ä¼°å½±å“ -->
          <view class="impact-info">
            <text class="impact-label">ğŸ“Š é¢„ä¼°å½±å“ï¼š</text>
            <text class="impact-value {{item.estimatedImpact}}">{{item.estimatedImpactText}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- P2-3 å…³é”®è¯äº‘ -->
  <view class="keyword-cloud-section" wx:if="{{keywordCloudData && keywordCloudData.length > 0}}">
    <text class="section-title">â˜ï¸ å“ç‰Œå…³é”®è¯äº‘</text>

    <!-- è¯äº‘å±•ç¤ºåŒº -->
    <!-- ã€å…³é”®ä¿®å¤ã€‘ä½¿ç”¨ hidden æ›¿ä»£ wx:ifï¼Œç¡®ä¿ DOM èŠ‚ç‚¹å­˜åœ¨åå†æ¸²æŸ“ ECharts -->
    <view class="word-cloud-container">
      <view class="word-cloud-wrapper" hidden="{{!wordCloudRendered}}">
        <canvas
          type="2d"
          id="wordCloudCanvas"
          class="word-cloud-canvas"
          style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
        ></canvas>
      </view>
      <view class="word-cloud-placeholder" hidden="{{wordCloudRendered}}">
        <text>æ­£åœ¨ç”Ÿæˆè¯äº‘...</text>
      </view>
    </view>
    
    <!-- å…³é”®è¯ç»Ÿè®¡ -->
    <view class="keyword-stats">
      <view class="stat-item">
        <text class="stat-number">{{keywordCloudData.length}}</text>
        <text class="stat-label">å…³é”®è¯æ•°é‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number positive">{{keywordStats.positiveCount}}</text>
        <text class="stat-label">æ­£é¢è¯</text>
      </view>
      <view class="stat-item">
        <text class="stat-number neutral">{{keywordStats.neutralCount}}</text>
        <text class="stat-label">ä¸­æ€§è¯</text>
      </view>
      <view class="stat-item">
        <text class="stat-number negative">{{keywordStats.negativeCount}}</text>
        <text class="stat-label">è´Ÿé¢è¯</text>
      </view>
    </view>
    
    <!-- é«˜é¢‘è¯åˆ—è¡¨ -->
    <view class="top-keywords-section" wx:if="{{topKeywords && topKeywords.length > 0}}">
      <text class="subsection-title">ğŸ”¥ é«˜é¢‘å…³é”®è¯</text>
      <view class="top-keywords-list">
        <view class="top-keyword-item" wx:for="{{topKeywords}}" wx:key="word">
          <text class="keyword-word {{item.sentiment}}">{{item.word}}</text>
          <text class="keyword-count">{{item.count}}</text>
        </view>
      </view>
    </view>
  </view>

<!-- P1-2 ä¿¡æºçº¯å‡€åº¦å±•ç¤º -->
  <view class="source-purity-section">
    <text class="section-title">ğŸ“Š ä¿¡æºçº¯å‡€åº¦åˆ†æ</text>

    <!-- æœ‰æ•°æ®æ—¶å±•ç¤º -->
    <block wx:if="{{sourcePurityData}}">
      <!-- ä¿¡æºçº¯å‡€åº¦æ¦‚è§ˆ -->
      <view class="purity-overview-section">
        <view class="purity-score-card">
          <view class="purity-circle {{sourcePurityData.purityLevel}}">
            <text class="purity-number">{{sourcePurityData.purityScore}}</text>
            <text class="purity-label">çº¯å‡€åº¦</text>
          </view>
          <view class="purity-info">
            <text class="purity-level {{sourcePurityData.purityLevel}}">{{sourcePurityData.purityLevelText}}</text>
            <text class="purity-high-weight">é«˜æƒé‡ä¿¡æºå æ¯”ï¼š{{sourcePurityData.highWeightRatio}}%</text>
            <text class="purity-pollution">æ±¡æŸ“æºæ•°é‡ï¼š{{sourcePurityData.pollutionCount}}</text>
          </view>
        </view>
      </view>

      <!-- ä¿¡æºç±»åˆ«åˆ†å¸ƒ -->
      <view class="source-category-section" wx:if="{{sourcePurityData.categoryDistribution}}">
        <text class="subsection-title">ğŸ—‚ï¸ ä¿¡æºç±»åˆ«åˆ†å¸ƒ</text>
        <view class="category-chart">
          <view class="category-item" wx:for="{{sourcePurityData.categoryDistribution}}" wx:key="category">
            <view class="category-bar {{item.category}}">
              <view class="bar-fill" style="width: {{item.percentage}}%;"></view>
            </view>
            <text class="category-name">{{item.categoryName}}</text>
            <text class="category-count">{{item.count}} ({{item.percentage}}%)</text>
          </view>
        </view>
      </view>

      <!-- ä¿¡æºæƒé‡æ’å -->
      <view class="source-weight-section" wx:if="{{sourcePurityData.topSources && sourcePurityData.topSources.length > 0}}">
        <text class="subsection-title">ğŸ† ä¿¡æºæƒé‡æ’å</text>
        <view class="weight-list">
          <view class="weight-item" wx:for="{{sourcePurityData.topSources}}" wx:key="index">
            <text class="weight-rank">{{index + 1}}</text>
            <text class="weight-name {{item.isHighWeight ? 'high-weight' : ''}}">{{item.name}}</text>
            <text class="weight-value">{{item.weight}}</text>
          </view>
        </view>
      </view>

      <!-- æ±¡æŸ“æºè­¦ç¤º -->
      <view class="pollution-warning-section" wx:if="{{sourcePurityData.pollutionSources && sourcePurityData.pollutionSources.length > 0}}">
        <text class="subsection-title">âš ï¸ æ±¡æŸ“æºè­¦ç¤º</text>
        <view class="pollution-list">
          <view class="pollution-item" wx:for="{{sourcePurityData.pollutionSources}}" wx:key="index">
            <text class="pollution-name">{{item.name}}</text>
            <text class="pollution-reason">{{item.reason}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- æ— æ•°æ®æ—¶å±•ç¤ºç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">ä¿¡æºçº¯å‡€åº¦åˆ†ææ•°æ®ç”Ÿæˆä¸­</text>
      <text class="empty-hint">åç«¯æ­£åœ¨åˆ†æä¿¡æºæ•°æ®ï¼Œè¯·ç¨åæŸ¥çœ‹</text>
    </view>
  </view>


  <!-- ä¿¡æºæƒ…æŠ¥å±•ç¤º -->
  <view class="source-intelligence-section">
    <text class="section-title">ğŸ” ä¿¡æºæƒ…æŠ¥åˆ†æ</text>
    
    <!-- æœ‰æ•°æ®æ—¶å±•ç¤º -->
    <block wx:if="{{sourceIntelligenceMap && sourceIntelligenceMap.nodes && sourceIntelligenceMap.nodes.length > 0}}">
      <view class="intelligence-graph">
        <view class="graph-node" wx:for="{{sourceIntelligenceMap.nodes}}" wx:key="id" bindtap="viewSourceDetails" data-id="{{item.id}}">
          <view class="node-content {{item.category}}">
            <text class="node-name">{{item.name}}</text>
            <text class="node-weight" wx:if="{{item.value}}">æƒé‡ï¼š{{item.value}}</text>
            <text class="node-sentiment" wx:if="{{item.sentiment}}">æƒ…æ„Ÿï¼š{{item.sentiment}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- æ— æ•°æ®æ—¶å±•ç¤ºç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-text">ä¿¡æºæƒ…æŠ¥å›¾è°±æ•°æ®ç”Ÿæˆä¸­</text>
      <text class="empty-hint">åç«¯æ­£åœ¨æ„å»ºä¿¡æºå…³ç³»å›¾è°±ï¼Œè¯·ç¨åæŸ¥çœ‹</text>
    </view>
  </view>

  <!-- åˆ é™¤çº¿ -->
  <!--
    <text class="section-title">ğŸ” ä¿¡æºæƒ…æŠ¥åˆ†æ</text>
    <view class="intelligence-graph">
      <view class="graph-node" wx:for="{{sourceIntelligenceMap.nodes}}" wx:key="id" bindtap="viewSourceDetails" data-id="{{item.id}}">
        <view class="node-content {{item.category}}">
          <text class="node-name">{{item.name}}</text>
          <text class="node-weight" wx:if="{{item.value}}">æƒé‡: {{item.value}}</text>
          <text class="node-sentiment" wx:if="{{item.sentiment}}">æƒ…æ„Ÿ: {{item.sentiment}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ç»“æœåˆ—è¡¨ -->
  <view class="detailed-results-section">
    <view class="results-controls">
      <text class="section-title">ğŸ“‹ è¯¦ç»†æµ‹è¯•ç»“æœ</text>
      <view class="view-toggle">
        <view class="toggle-btn {{currentViewMode === 'brand' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="brand">å“ç‰Œå¯¹æ¯”</view>
        <view class="toggle-btn {{currentViewMode === 'dimension' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="dimension">ç»´åº¦å¯¹æ¯”</view>
        <view class="toggle-btn {{currentViewMode === 'detailed' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="detailed">è¯¦ç»†è§†å›¾</view>
      </view>
    </view>

    <!-- å“ç‰Œå¯¹æ¯”è§†å›¾ -->
    <view wx:if="{{currentViewMode === 'brand'}}">
      <view class="brand-comparison-card" wx:for="{{groupedResultsByBrand}}" wx:key="brand">
        <view class="brand-header">
          <text class="brand-name {{item.isMainBrand ? 'main-brand' : 'competitor-brand'}}">
            {{item.isMainBrand ? 'ğŸ¢' : 'ğŸš—'}} {{item.brand}}
          </text>
          <text class="brand-score">ğŸ“Š ç»¼åˆ: {{item.overallScore}}åˆ†</text>
        </view>
        <view class="brand-dimensions">
          <view class="dimension-item">
            <text class="dimension-label">ğŸ† æƒå¨åº¦</text>
            <text class="dimension-score">{{item.scores.authority_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">ğŸ‘ï¸ å¯è§åº¦</text>
            <text class="dimension-score">{{item.scores.visibility_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">âœ¨ çº¯å‡€åº¦</text>
            <text class="dimension-score">{{item.scores.purity_score || 0}}</text>
          </view>
          <view class="dimension-item">
            <text class="dimension-label">ğŸ”— ä¸€è‡´æ€§</text>
            <text class="dimension-score">{{item.scores.consistency_score || 0}}</text>
          </view>
        </view>
        <view class="brand-questions" bindtap="toggleBrandQuestions" data-brand="{{item.brand}}">
          <text class="questions-toggle">ğŸ“‹ {{item.questions.length}} ä¸ªé—®é¢˜ ></text>
        </view>
        <view class="brand-question-details" wx:if="{{expandedBrands[item.brand]}}">
          <view class="question-item" wx:for="{{item.questions}}" wx:key="index">
            <text class="question-text">â“ {{item.question}}</text>
            <text class="answer-text">ğŸ’¬ {{item.response}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»´åº¦å¯¹æ¯”è§†å›¾ -->
    <view wx:elif="{{currentViewMode === 'dimension'}}">
      <view class="dimension-comparison-section">
        <view class="dimension-card" wx:for="{{dimensionComparisonData}}" wx:key="dimension">
          <view class="dimension-header">
            <text class="dimension-name">{{item.icon}} {{item.name}}</text>
            <text class="dimension-average">å¹³å‡: {{item.averageScore}}åˆ†</text>
          </view>
          <view class="dimension-bars">
            <view class="bar-item" wx:for="{{item.brands}}" wx:key="brand">
              <text class="bar-label {{item.isMainBrand ? 'main-brand' : 'competitor-brand'}}">{{item.brand}}</text>
              <view class="bar-container">
                <view class="bar-fill" style="width: {{item.score}}%; background-color: {{item.isMainBrand ? '#00F5A0' : '#00A9FF'}};"></view>
                <text class="bar-score">{{item.score}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†è§†å›¾ -->
    <view wx:elif="{{currentViewMode === 'detailed'}}">
      <view class="detailed-result-item" wx:for="{{latestTestResults}}" wx:key="index">
        <view class="detailed-header">
          <text class="detailed-brand {{item.brand === targetBrand ? 'main-brand' : 'competitor-brand'}}">
            {{item.brand === targetBrand ? 'ğŸ¢' : 'ğŸš—'}} {{item.brand}}
          </text>
          <text class="detailed-model">ğŸ¤– {{item.aiModel}}</text>
        </view>
        <view class="detailed-question">â“ {{item.question}}</view>
        <view class="detailed-response">ğŸ’¬ {{item.response}}</view>
        <view class="detailed-scores-grid">
          <view class="score-cell">
            <text class="score-label">ğŸ† æƒå¨åº¦</text>
            <text class="score-value">{{item.authority_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">ğŸ‘ï¸ å¯è§åº¦</text>
            <text class="score-value">{{item.visibility_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">âœ¨ çº¯å‡€åº¦</text>
            <text class="score-value">{{item.purity_score || 0}}</text>
          </view>
          <view class="score-cell">
            <text class="score-label">ğŸ”— ä¸€è‡´æ€§</text>
            <text class="score-value">{{item.consistency_score || 0}}</text>
          </view>
        </view>
        <view class="detailed-total-score">ğŸ“ˆ æ€»åˆ†: {{item.score}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn save-btn" bindtap="saveResult">ğŸ’¾ ä¿å­˜ç»“æœ</button>
    <button class="action-btn home-btn" bindtap="goHome">ğŸ  è¿”å›é¦–é¡µ</button>
    <button class="action-btn history-btn" bindtap="viewHistory">ğŸ“š æŸ¥çœ‹å†å²</button>
    <button class="action-btn report-btn" bindtap="generateReport">ğŸ“Š ç”Ÿæˆæˆ˜æŠ¥</button>
  </view>

  <!-- ä¿å­˜ç»“æœæ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showSaveResultModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>ä¿å­˜æœç´¢ç»“æœ</text>
        <text class="close-btn" bindtap="hideSaveResultModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="label">å“ç‰Œåç§°</text>
          <input class="input" value="{{saveBrandName}}" bindinput="onSaveBrandNameInput" placeholder="è¯·è¾“å…¥å“ç‰Œåç§°" />
        </view>
        <view class="form-group">
          <text class="label">æ ‡ç­¾</text>
          <view class="tags-container">
            <view class="tag-item" wx:for="{{saveTags}}" wx:key="tag" wx:if="{{item}}">
              <text>{{item}}</text>
              <text class="remove-tag" bindtap="removeSaveTag" data-index="{{index}}">Ã—</text>
            </view>
            <view class="add-tag-container">
              <input class="tag-input" value="{{newSaveTag}}" bindinput="onNewSaveTagInput" placeholder="æ·»åŠ æ ‡ç­¾" />
              <button class="add-tag-btn" bindtap="addSaveTag">æ·»åŠ </button>
            </view>
          </view>
        </view>
        <view class="form-group">
          <text class="label">åˆ†ç±»</text>
          <picker class="picker" range="{{saveCategories}}" value="{{saveCategoryIndex}}" bindchange="onSaveCategoryChange">
            <view class="picker-view">{{selectedSaveCategory}}</view>
          </picker>
        </view>
        <view class="form-group">
          <text class="label">å¤‡æ³¨</text>
          <textarea class="textarea" value="{{saveNotes}}" bindinput="onSaveNotesInput" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" />
        </view>
        <view class="form-group">
          <text class="label">æ”¶è—</text>
          <switch class="switch" checked="{{saveAsFavorite}}" bindchange="onSaveFavoriteChange" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-cancel-btn" bindtap="hideSaveResultModal">å–æ¶ˆ</button>
        <button class="modal-confirm-btn" bindtap="confirmSaveResult">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- éšè—çš„ Canvas ç”¨äºç”ŸæˆæŠ¥å‘Šå›¾ç‰‡ -->
  <canvas type="2d" id="report-canvas" class="report-canvas-hidden"></canvas>
</view>
</view>
