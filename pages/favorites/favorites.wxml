<!-- pages/favorites/favorites.wxml -->
<!--
  æ”¶è—åˆ—è¡¨é¡µ
  åŠŸèƒ½:
  - å±•ç¤ºç”¨æˆ·æ”¶è—çš„æ‰€æœ‰æŠ¥å‘Š
  - æ”¯æŒå–æ¶ˆæ”¶è—
  - æ”¯æŒè·³è½¬åˆ°æŠ¥å‘Šè¯¦æƒ…
  - æ”¯æŒä¸‹æ‹‰åˆ·æ–°
-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <skeleton type="list"></skeleton>
  </view>

  <!-- æ•°æ®å†…å®¹ -->
  <view wx:else-if="{{!loading && favorites.length > 0}}" class="content-wrapper">
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-bar">
      <text class="stats-text">å·²æ”¶è— {{favorites.length}} ä»½æŠ¥å‘Š</text>
      <text class="stats-hint">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
    </view>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <view class="favorites-list">
      <view
        class="favorite-card"
        wx:for="{{favorites}}"
        wx:key="executionId"
        bindtap="viewDetail"
        data-item="{{item}}"
      >
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="brand-info">
            <text class="brand-name">{{item.brandName || item.brand || 'å“ç‰Œè¯Šæ–­'}}</text>
            <view class="favorite-badge">
              <text class="favorite-icon">â¤ï¸</text>
              <text class="favorite-text">å·²æ”¶è—</text>
            </view>
          </view>
          <view class="card-actions">
            <view
              class="action-btn"
              catchtap="removeFavorite"
              data-item="{{item}}"
              hover-class="action-btn-hover"
            >
              <text class="action-icon">ğŸ—‘ï¸</text>
              <text class="action-text">å–æ¶ˆæ”¶è—</text>
            </view>
          </view>
        </view>

        <!-- å¡ç‰‡å†…å®¹ -->
        <view class="card-body">
          <!-- è¯„åˆ† -->
          <view class="score-row">
            <view class="score-item">
              <text class="score-label">å¥åº·åº¦</text>
              <text class="score-value {{item.healthScore >= 80 ? 'excellent' : item.healthScore >= 60 ? 'good' : 'normal'}}">
                {{item.healthScore || 0}}
              </text>
            </view>
            <view class="score-divider"></view>
            <view class="score-item">
              <text class="score-label">AI å£°é‡</text>
              <text class="score-value">{{item.sov || 0}}%</text>
            </view>
            <view class="score-divider"></view>
            <view class="score-item">
              <text class="score-label">æƒ…æ„Ÿ</text>
              <text class="score-value {{item.avgSentiment >= 0.3 ? 'positive' : item.avgSentiment <= -0.3 ? 'negative' : 'normal'}}">
                {{item.avgSentiment || 0}}
              </text>
            </view>
          </view>

          <!-- è¯Šæ–­æ—¶é—´ -->
          <view class="meta-row">
            <text class="meta-icon">ğŸ“…</text>
            <text class="meta-text">{{item.diagnoseTime || item.createdAt || 'æœªçŸ¥æ—¶é—´'}}</text>
          </view>

          <!-- é—®é¢˜æ•°é‡ -->
          <view class="meta-row" wx:if="{{item.questionCount || item.questions}}">
            <text class="meta-icon">ğŸ“Š</text>
            <text class="meta-text">å…± {{item.questionCount || (item.questions ? item.questions.length : 0)}} ä¸ªè¯Šæ–­é—®é¢˜</text>
          </view>
        </view>

        <!-- å¡ç‰‡åº•éƒ¨ -->
        <view class="card-footer">
          <view class="view-detail-btn">
            <text>æŸ¥çœ‹è¯¦æƒ…</text>
            <text class="arrow-icon">â€º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€æç¤ºï¼ˆæœ‰æ•°æ®ä½†åˆ—è¡¨ä¸ºç©ºæ—¶ä¸æ˜¾ç¤ºï¼‰ -->
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else-if="{{!loading && favorites.length === 0}}" class="empty-state">
    <view class="empty-icon">ğŸ“š</view>
    <view class="empty-title">æš‚æ— æ”¶è—</view>
    <view class="empty-subtitle">åœ¨æŠ¥å‘Šè¯¦æƒ…é¡µç‚¹å‡»â¤ï¸æ”¶è—æŒ‰é’®ï¼Œå³å¯åœ¨æ­¤æŸ¥çœ‹</view>
    <button class="go-home-btn" bindtap="goHome">å»è¯Šæ–­</button>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:else-if="{{error}}" class="error-state">
    <view class="error-icon">âš ï¸</view>
    <view class="error-text">{{error}}</view>
    <button class="retry-btn" bindtap="retry">é‡æ–°åŠ è½½</button>
  </view>
</view>
