<view class="page-container container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å†å²è¯Šæ–­æŠ¥å‘Š</text>
    <text class="page-subtitle">å›é¡¾å¹¶è¿½è¸ªæ‚¨çš„å“ç‰ŒAIè®¤çŸ¥æ¼”å˜</text>
  </view>

  <!-- P2-1 å†å²è¶‹åŠ¿å›¾ -->
  <view class="trend-chart-section" wx:if="{{trendChartData && trendChartData.length > 0}}">
    <text class="section-title">ğŸ“ˆ åˆ†æ•°è¶‹åŠ¿</text>
    <view class="trend-chart-container">
      <!-- Y è½´æ ‡ç­¾ -->
      <view class="y-axis">
        <text class="y-label">100</text>
        <text class="y-label">80</text>
        <text class="y-label">60</text>
        <text class="y-label">40</text>
        <text class="y-label">20</text>
        <text class="y-label">0</text>
      </view>
      
      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-area">
        <!-- ç½‘æ ¼çº¿ -->
        <view class="grid-line" wx:for="{{5}}" wx:key="index"></view>
        
        <!-- æ•°æ®ç‚¹å’Œè¿çº¿ -->
        <view class="data-points-container">
          <view class="data-point" wx:for="{{trendChartData}}" wx:key="index" style="left: {{item.leftPercent}}%;">
            <view class="point {{item.score >= 80 ? 'good' : (item.score >= 60 ? 'medium' : 'bad')}}" style="top: {{item.topPercent}}%;"></view>
            <text class="point-score">{{item.score}}</text>
            <text class="point-date">{{item.shortDate}}</text>
          </view>
          
          <!-- è¿çº¿ï¼ˆä½¿ç”¨ SVG æˆ–ç®€å• divï¼‰ -->
          <svg class="trend-line" wx:if="{{trendChartData.length > 1}}">
            <polyline points="{{trendLinePoints}}" stroke="#00F5A0" stroke-width="3" fill="none"></polyline>
          </svg>
        </view>
      </view>
    </view>
    
    <!-- è¶‹åŠ¿ç»Ÿè®¡ -->
    <view class="trend-stats">
      <view class="stat-item">
        <text class="stat-label">å¹³å‡åˆ†</text>
        <text class="stat-value">{{trendStats.averageScore}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æœ€é«˜åˆ†</text>
        <text class="stat-value high">{{trendStats.maxScore}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æœ€ä½åˆ†</text>
        <text class="stat-value low">{{trendStats.minScore}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">è¶‹åŠ¿</text>
        <text class="stat-value {{trendStats.trend === 'up' ? 'trend-up' : (trendStats.trend === 'down' ? 'trend-down' : 'trend-flat')}}">{{trendStats.trendText}}</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-card" wx:for="{{historyList}}" wx:key="id" bindtap="viewDetail" data-id="{{item.id}}">
      <view class="card-left">
        <text class="brand-name">{{item.brand_name}}</text>
        <text class="test-time">{{item.created_at}}</text>
      </view>
      <view class="card-right">
        <view class="score-display">
          <text class="score-num {{item.overall_score >= 80 ? 'text-green' : (item.overall_score >= 60 ? 'text-orange' : 'text-red')}}">{{item.overall_score}}</text>
          <text class="score-label">åˆ†</text>
        </view>
        <view class="arrow-right">â€º</view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿè®¿é—®æœ€è¿‘ç»“æœ -->
  <view class="quick-access-section" wx:if="{{historyList.length === 0 && !isLoading}}">
    <view class="recent-result-card" bindtap="viewLatestResult">
      <view class="card-content">
        <text class="card-title">æœ€è¿‘çš„è¯Šæ–­ç»“æœ</text>
        <text class="card-desc">å¿«é€Ÿè®¿é—®æ‚¨æœ€è¿‘çš„ä¸€æ¬¡å“ç‰ŒAIè®¤çŸ¥è¯Šæ–­</text>
      </view>
      <view class="arrow-right">â€º</view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{historyList.length === 0 && !isLoading}}">
    <text class="empty-icon">ğŸ—‚ï¸</text>
    <text class="empty-text">æš‚æ— å†å²æŠ¥å‘Š</text>
    <button class="empty-btn" bindtap="goHome">ç«‹å³è¿›è¡Œä¸€æ¬¡è¯Šæ–­</button>
    <button class="empty-btn secondary-btn" bindtap="viewSavedResults">æŸ¥çœ‹å·²ä¿å­˜ç»“æœ</button>
    <button class="empty-btn secondary-btn" bindtap="viewPublicHistory">æŸ¥çœ‹å…¬å…±å†å²</button>
    <button class="empty-btn secondary-btn" bindtap="viewPersonalHistory">æŸ¥çœ‹ä¸ªäººå†å²</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text>æ­£åœ¨åŠ è½½...</text>
  </view>
</view>